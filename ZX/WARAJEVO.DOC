…ÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕª
∫                                                                            ∫
∫                                                                            ∫
∫                €   € ‹ﬂﬂ‹ €ﬂﬂ‹ ‹ﬂﬂ‹    € €ﬂﬂﬂ €   € ‹ﬂﬂ‹                   ∫
∫                € ‹ € €ﬂﬂ€ €ﬂﬂ‹ €ﬂﬂ€ ‹  € €ﬂﬂ   € €  €  €                   ∫
∫                 ﬂ ﬂ  ﬂ  ﬂ ﬂ  ﬂ ﬂ  ﬂ  ﬂﬂ  ﬂﬂﬂﬂ   ﬂ    ﬂﬂ                    ∫
∫                                                                            ∫
∫       ﬂﬂﬂ€ﬂ ﬂ‹ ‹ﬂ     ‹ﬂﬂﬂ €ﬂﬂ‹ €ﬂﬂﬂ ‹ﬂﬂ‹ ﬂﬂ€ﬂﬂ €ﬂﬂ‹ €  € €‹ ‹€            ∫
∫        ‹ﬂ    ‹ﬂ‹       ﬂﬂ‹ €ﬂﬂ  €ﬂﬂ  €  ‹   €   €ﬂﬂ‹ €  € € ﬂ €            ∫
∫       ﬂﬂﬂﬂﬂ ﬂ   ﬂ     ﬂﬂﬂ  ﬂ    ﬂﬂﬂﬂ  ﬂﬂ    ﬂ   ﬂ  ﬂ  ﬂﬂ  ﬂ   ﬂ            ∫
∫                                                                            ∫
∫                €ﬂﬂﬂ €‹ ‹€ €  € €    ‹ﬂﬂ‹ ﬂﬂ€ﬂﬂ ‹ﬂﬂ‹ €ﬂﬂ‹                   ∫
∫                €ﬂﬂ  € ﬂ € €  € €    €ﬂﬂ€   €   €  € €ﬂﬂ‹                   ∫
∫                ﬂﬂﬂﬂ ﬂ   ﬂ  ﬂﬂ  ﬂﬂﬂﬂ ﬂ  ﬂ   ﬂ    ﬂﬂ  ﬂ  ﬂ                   ∫
∫                                                                            ∫
∫                                                                            ∫
∫                                                                            ∫
∫                                                                            ∫
∫         €ﬂﬂ‹ €ﬂﬂﬂ €    €ﬂﬂﬂ ‹ﬂﬂ‹ ‹ﬂﬂﬂ €ﬂﬂﬂ       ‹ﬂﬂ‹   €ﬂﬂﬂ  ‹€           ∫
∫         €ﬂﬂ‹ €ﬂﬂ  €    €ﬂﬂ  €ﬂﬂ€  ﬂﬂ‹ €ﬂﬂ         ‹ﬂ    ﬂﬂﬂ‹ ﬂ €           ∫
∫         ﬂ  ﬂ ﬂﬂﬂﬂ ﬂﬂﬂﬂ ﬂﬂﬂﬂ ﬂ  ﬂ ﬂﬂﬂ  ﬂﬂﬂﬂ       ﬂﬂﬂﬂ ﬂ ﬂﬂﬂ    ﬂ ﬂ         ∫
∫                                                                            ∫
∫      OFFICIAL HOME PAGE: http://www.void.demon.nl/warajevo/index.html      ∫
»ÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕÕº


       CONTENTS
       ========

1.     PREFACE
1.1.    What is this and how we developed it
1.2.    Contents of the package
1.3.    How to HELP AUTHORS (!)
1.4.    Acknowledgements

2.     BASIC INTRODUCTIONS
2.1     The command line parameters
2.2.    The function keys
2.3.    The keyboard and the keypad
2.4.    The emulation of the tape recorder
2.5.    The emulation of the microdrive
2.6.    The emulation of Sinclair Network
2.7.    The emulation of the MIDI interface
2.8.    The emulation of Timex Sinclair 2068 particularities
2.9.    The syntax of ZX BASIC
2.10.   Emulator error messages

3.     THE ENVIRONMENT OF THE WARAJEVO EMULATOR
3.1.    Basic elements of the environment
3.2.    Menu 'TapeFiles'
3.2.1.   Submenu 'Tapes'
          Option 'Select'
          Option 'Unselect'
          Option 'Parameters'
          Option 'View'
          Submenu 'Print'
           Option 'Screen'
           Option 'Printer'
           Option 'File'
          Option 'Copy to New'
3.2.2.   Submenu 'Blocks'
          Option 'Reorder'
          Option 'Extract'
          Option 'Delete'
          Option 'Add block'
          Option 'Edit block'
          Option 'Exclude'
          Option 'Change position'
3.2.3.   Submenu 'Implode'
          Submenu 'Compress'
           Option 'Compress all'
           Option 'Linearize'
           Option 'Compress selected'
          Option 'Decompress'
          Option 'Efficiency'
3.2.4.   Submenu 'Communications'
          Submenu 'RS232'
           Option 'Send to Spectrum'
           Option 'Receive from Spectrum'
           Option 'Send communication program'
           Option 'Configure RS232'
          Submenu 'Cassette'
           Option 'Receive from cassette'
           Option 'Sample from cassette'
           Option 'Advanced setup'
3.2.5.   Submenu 'Convert'
          Submenu 'ASCII <-> Basic'
           Option 'ASCII -> Basic'
           Option 'Basic -> ASCII'
          Submenu 'ASCII <-> Hisoft'
           Option 'ASCII -> Gens'
           Option 'ASCII -> C'
           Option 'ASCII -> Pascal'
           Option 'Gens -> ASCII'
           Option 'C -> ASCII'
           Option 'Pascal -> ASCII'
          Submenu 'ASCII <-> Tassword'
           Option 'Tassword 2 -> ASCII'
           Option 'Tassword 3 -> ASCII'
           Option 'ASCII -> Tassword 2'
           Option 'ASCII -> Tassword 3'
          Submenu 'ASCII <-> The Last Word'
           Option 'ASCII -> The Last Word'
           Option 'The Last Word -> ASCII'
          Submenu 'ASCII <-> Machine Lightning'
           Option 'ASCII -> Machine Lightning'
           Option 'Machine Lightning -> ASCII'
          Submenu 'ASCII <-> Forth'
           Option 'ASCII -> Forth'
           Option 'Forth -> ASCII'
          Submenu 'ASCII <-> Logo'
           Option 'ASCII -> Logo'
           Option 'Logo -> ASCII'
          Submenu 'SCREEN$ -> Tiff'
           Option 'Color TIFF picture'
           Option 'Black and white TIFF picture'
          Submenu 'Other emulators'
           Submenu 'Warajevo <-> Roman & Easy'
            Option 'Roman & Easy inc -> Warajevo'
            Option 'Warajevo -> Roman & Easy inc'
           Submenu 'Warajevo <-> Lunter Z80'
            Option 'Lunter TAP -> Warajevo TAP'
            Option 'Warajevo TAP -> Lunter TAP'
           Submenu 'Warajevo <-> Irish SpecEm'
            Option 'Irish SpecEm -> Warajevo TAP'
            Option 'Warajevo TAP -> Irish SpecEm'
           Submenu 'Warajevo <-> Polish SP'
            Option 'Polish SP SPC -> Warajevo TAP'
            Option 'Warajevo TAP -> Polish SP SPC'
           Submenu 'Warajevo <-> Spectrum 2.00'
            Option 'BLK -> Warajevo TAP'
            Option 'Warajevo TAP -> BLK'
           Submenu 'Warajevo <-> ZX Garabik'
            Option 'LTP -> Warajevo TAP'
            Option 'Warajevo TAP -> LTP'
           Submenu 'Warajevo <-> ZX Brukner'
            Option 'ZX Brukner -> Warajevo TAP'
            Option 'Warajevo TAP -> ZX Brukner'
           Submenu 'Warajevo <-> TZX'
            Option 'TZX -> Warajevo TAP'
            Option 'Warajevo TAP -> TZX'
            Option 'TZX conversion setup'
           Submenu 'Warajevo <-> ZX Museum'
            Option 'Museum ZXS -> Warajevo'
            Option 'Warajevo TAP -> Museum ZXS'
           Submenu 'Warajevo <-> Spectrum + TRDOS'
            Option 'TRD -> Warajevo TAP'
            Option 'Warajevo TAP -> TRD'
           Submenu 'Warajevo <-> ZX32'
            Option 'ZX32 ZXT -> Warajevo TAP'
            Option 'Warajevo TAP -> ZX32 ZXT'
           Submenu 'Warajevo <-> JPP'
            Option 'VOC -> Warajevo TAP'
            Option 'Warajevo TAP -> VOC'
3.3.ˇˇˇ Menu 'Z80Snaps'
3.3.1    Submenu 'Snaps'
          Option 'Select'
          Option 'Unselect'
          Option 'Rename'
          Option 'Info'
3.3.2    Submenu 'Edit'
          Option 'Registers'
          Option 'Hardware'
          Option 'Memory'
3.3.3.   Submenu 'Convert'
          Submenu 'Spanish Spectrum -> Warajevo'
           Option 'SP -> Z80'
           Option 'Z80 -> SP'
          Submenu 'VgaSpec <-> Warajevo'
           Option 'Old SP -> Z80'
           Option 'Z80 -> Old SP'
          Submenu 'Irish SpecEm <-> Warajevo'
           Option 'PRG -> Z80'
           Option 'Z80 -> PRG'
          Submenu 'JPP <-> Warajevo'
           Option 'SNA -> Z80'
           Option 'Z80 -> SNA'
          Submenu 'SpecEmu G <-> Warajevo'
           Option 'SEM -> Z80'
           Option 'Z80 -> SEM'
          Submenu 'SP UKV <-> Warajevo'
           Option 'SNA 128 -> Z80'
           Option 'Z80 -> SNA 128'
          Submenu 'Nuclear ZX <-> Warajevo'
           Option 'SNP -> Z80'
           Option 'Z80 -> SNP'
          Submenu 'X128 <-> Warajevo'
           Option 'SLT -> Z80 + TAP'
           Option 'Z80 + SLT -> Z80'
          Submenu 'Spectrum 2.00 <-> Warajevo'
           Option 'SIT -> Z80'
           Option 'Z80 -> SIT'
          Submenu 'ZX32 <-> Warajevo'
           Option 'ZXS RIFF -> Z80'
           Option 'Z80 -> ZXS RIFF'
          Submenu 'Z80 (48K) <-> Z80 (128K)'
           Option 'Any Z80 -> 48K without interface 1'
           Option 'Any Z80 -> 128K without interface 1'
          Option 'Z80 snapshot -> TAP'
3.4.ˇˇˇ Menu 'MdriveFiles'
3.4.1.   Submenu 'Microdrive'
          Option 'Select'
          Option 'Unselect'
          Option 'Default'
          Option 'Catalog'
          Option 'Format'
          Option 'Optimize'
          Option 'View'
          Option 'Rename'
          Option 'Write protect'
          Option 'Write unprotect'
3.4.2.   Submenu 'Sectors'
          Option 'Verify'
          Option 'Edit'
3.4.3.   Submenu 'Files'
          Option 'Delete'
          Option 'Rename'
          Option 'Hide'
          Option 'Unhide'
          Option 'Copy'
3.4.4.   Submenu 'Convert'
          Option 'Enlarge MDR to 254 sectors'
3.5.    Menu 'DockFiles'
3.5.1.   Submenu 'Docks'
          Option 'Select'
          Option 'Unselect'
          Option 'View'
          Option 'Merge'
3.5.2.   Submenu 'Convert'
          Option 'ROM to DCK'
          Option 'Binary to LROS'
          Option 'Binary to AROS'
3.6.    Menu 'DataBase'
3.6.1.   Submenu 'DBF Directory'
          Option 'Select directory'
          Option 'Unselect'
3.6.2.   Creating and editing the data base (option 'Edit')
          Description and meaning of the fields
          Dialog for data base browsing
          Entering and changing records
          Dialog for explaining of problems
3.6.3.   Running programs from the data base (option 'Run')
3.6.4.   Sorting the data base (option 'Sort')
3.6.5.   Submenu 'Mark sort priority'
          Option 'Conditional'
          Option 'Swap marker'
          Option 'Unmark all'
3.6.6.   Creating of the report (Option 'Report')
3.6.7.   Submenu 'Convert'
          Option 'Warajevo -> SpecPic'
          Option 'Warajevo -> SGD'
          Option 'Warajevo -> ZX Rainbow'
          Option 'Warajevo -> SpecBase'
          Option 'SGD -> Warajevo'
          Option 'SpecPic -> Warajevo'
          Option 'ZX Rainbow -> Warajevo'
          Option 'SpecBase -> Warajevo'
3.7.    Menu 'Setup'
         Option 'Emulator'
         Option 'Video'
         Option 'Speed'
         Option 'Test'
         Option 'Network'
         Option 'Sound'
         Option 'Interface 1'
         Option 'Joystick'
         Option 'Printer'
         Option 'ROM'
         Option 'MS Windows'
3.8.    Menu 'DOS'
         Option 'About'
         Option 'Directory'
         Option 'Change directory'
         Option 'OS Shell'
         Option 'Exit'
3.9.    The 'Start' button
3.10.   The function keys in the environment
3.11.   The command line parameters in the environment
3.12.   The communication program

4.     BUILT IN MONITOR
4.1.    The front panel
4.2.    Arguments of commands
4.3.    Monitor commands
4.4.    Monitor error messages

5.     EXPANDING THE EMULATOR FROM THE USER
5.1.    Adding emulation of a new peripheral device
5.2.    Using 'Escape' sequences
5.3.    Emulation of the parallel printer interface

6.     PROGRAM 'ZXCOMP'
6.1.    Compiling
6.2.    Supporting of saving and loading blocks
6.3.    Automatization of save & load supporting

7.     TECHNICAL INFORMATIONS
7.1.    Z80 processor emulation
7.2.    The ROMs and RAMs
7.3.    Emulation of I/O ports
7.3.1.   'ULA' ports
7.3.2.   'ZX printer' ports
7.3.3.   'Kempston joystick' ports
7.3.4.   'ZX Interface 1' ports
7.3.5.   'ZX Spectrum 128' ports
7.3.6.   'Timex Sinclair 2068' ports
7.3.7.   'Bus idle' port
7.4.    The emulation of the accurate timing
7.5.    The emulation of the video memory
7.6.    The emulation of the beeper and the AY chip
7.7.    The emulation of the keyboard and the keypad
7.8.    The emulation of Sinclair Network
7.9.    The formats of the files
7.9.1.   Tape files
7.9.2.   Snapshot files
7.9.3.   MDR files
7.9.4.   DCK files
7.9.5.   Net files
7.9.6.   Palette files
7.9.7.   Database files
7.10.   'Wrapping' problem
7.11.   Communication protocols
7.12.   Informations for users of newer operating systems (MS Windows etc.)
7.13.   Assignment of the net drive
7.14.   Time constants for loading
7.15.   Edge recognizer
7.16.   Protected programs

8.     REMARKED PROBLEMS, AND HINTS FOR PROBLEMS SOLVING


1.     PREFACE
       =======


1.1.   WHAT IS THIS AND HOW WE DEVELOPED IT
       ====================================

       We want to tell users of earlier releases of Warajevo ZX Spectrum
emulator that although war in our country finished two years ago, the
political and economical situation is still very bad. At the moment, our
material status is much better than 2 years ago, but unfortunately this is
not true for most of the inhabitants. However, we hope that these problems
will be solved in due course. If this is your first contact with this
program, a short story about the development of this program follows.

       Maybe this program is not too interesting in itself, but it is a fact
that this program comes from Bosnia and Herzegovina, from the city of
Sarajevo which has been surrounded for more than three years. Our names are
Zeljko Juric and Samir Ribic. We are engineers of electronic and computer
sciences (the emulator was originally Samir's graduate thesis). Even in
our secondary school days, about ten years before, we began to build an
interest in computers thanks to the ZX Spectrum. For this reason, we are a
bit sentimentally tied with this computer. This computer reminds us of all of
the times when, in our neighbourhoods, the life was nice and normal.

       However, when we bought AT 286 computers at the end of 1990, we did
not forget our Spectrums. We had great interest when, in June 1991, we got a
Spectrum emulator, which, without underestimating anybody's work, had very
bad characteristics (it was slow, quite incompatible with the original
machine, with unpractical emulation of the tape recorder etc.). It's origin
is unknown to us (we suppose that the program is from the Slovenia Republic,
and that the author is Peter KroÁelj), and when starting it displays the
copyright message '(C) 1991. Roman & easy inc.'. When the war started in our
country, we wanted to remove the dark thoughts from our heads as much as
possible. So, in April 1993, we started the development of our Spectrum
emulator, symbolically called 'Warajevo Spectrum emulator' which should have
much better characteristics. We should mention that we were known as quite
good programmers, especially in assembly language.

       The program was developed in horrible conditions. The grenades fell
everywhere, there was little electrical power (at one time even the
hospitals didn't have power for two months!).  When we had electricity it was
only for 2-3 hours during the night. However, we did not quit and caught
every moment when the electricity was on to develop the program. It was often
in an Army's camp, with an improvised generator, and a voltage that varied
from 150 V to 300 V! The greatest part of ZXTOOLS (which was presented in the
package until release 1.2, and later on was integrated into the environment)
was developed without even a hard disc, because such a 'stable' voltage
destroyed it. We progressed very well, and in November 1993, reading some
newspapers that came from the enemy's territory, we got some information about
the emulator 'Z80', written by Gerton Lunter. In even worse winter conditions
we continued the development (in the rooms where we slept the water was
frozen), hoping to get this emulator to compare our program and his program.

       In April 1994, the foundation Sorosh opened the first electronic mail
in Sarajevo. We sent a general request and in June 1994, we got Lunter's
emulator. From documentation we got information about many Spectrum emulators
around Europe, but we thought that our program was surely better than all the
others, except maybe Lunter's program. We think that it is a great success,
considering the conditions where the program was developed and the quality of
Gerton's program. When we contacted Gerton, he had the same opinion about it.

       Recently, a number of new emulators have appeared. Some of them are
very good, especially X128 by James McKay, and there are a number of
emulators for the Windows platform (We want to point out ZX32 by Vaggelis
Kapartzianis and MultiMachine by Paul Hodgson). However, we think that
Warajevo is the best emulator for pure DOS. We want to tell you that the
Warajevo emulator still does not have a good emulation of the video system
like in the ZX32 emulator (although it is much better than in release 2.0.
which was a considerable improvment itself over release 1.5.), perfect
emulation of the bits 3 and 5 in the F register, emulation of the disc
interfaces, Multiface 128, AMX mouse, full emulation of the RS232 socket or
emulation of the Spectrum +3, which are supported in some other emulators.
However, we want to emphasize that Warajevo is a Real-Time emulator
(starting from release 2.0. - execution speed is equal to speed of the real
Spectrum, independent of PC computer speed), and Warajevo still has a lot of
features which make it unique, like:

- Warajevo (starting from release 2.5) emulates the American version of the
  Spectrum, the Timex Sinclair 2068, with practically all the features of this
  computer (extra video modes, sound, memory expansions etc.). Timex emulation
  is also implemented in the MultiMachine emulator by Paul Hodgson, but the
  Warajevo emulator needs much lower hardware requirements to work correctly.

- Warajevo (like Lunter's emulator) allows loading of programs from a real
  tape recorder directly into the emulator, but unlike Lunter's emulator,
  Warajevo allows picture generation during loading!

- Warajevo supports multicolor effects and digital sound with much reduced
  hardware requirements on the computer compared to some other emulators, like
  X128.

- At this moment, the Warajevo emulator is the only emulator which emulates
  the MIDI interface (on Spectrum 128) and the Sinclair Network!

- The tape emulation, using TAP files, is realized using a very flexible
  method.  Our emulator can load from TAP files (even from Lunter TAP files)
  a lot of programs that load themselves using non-standard methods (e.g. the
  running screen, quick loading, etc.). The advantage is that games that
  load the levels from the tape using non-standard routines work.

- The environment of Warajevo has an option for sampling a tone record from a
  real tape into a TAP file, regardless of the structure of the tone record
  and loading routine. In other words, you can transfer any program from real
  tape to a TAP file!

- The tapes (TAP files) can be in a compressed format, and then occupy about
  40-70% less space on disc. The emulator supports the automatic loading and
  running of programs which are located in an arbitrary place on the TAP
  file. No other emulators support such features.

- Warajevo can optionally load TZX files much faster (by a factor of 4 or
  more) than loading into a real Spectrum, without any degradation in loading
  compatibility.

- Warajevo is still the only emulator which supports extended keyboard
  (KEYPAD) emulation on ZX Spectrum 128.

- The Warajevo emulator has a very clean emulation of the beeper, even under
  MS Windows. Out of all the emulators, only the Warajevo emulator achieves
  pseudo-3-channel AY sound on a PC beeper. Starting from release 2.5.
  Warajevo goes one step further, it tries to emulate nearly all AY features
  including noise generation and digital sound using only a PC beeper! Of
  course, AY chip emulation using AdLib and Sound Blaster cards is supported
  too.

- A very high quality machine-code monitor is included, which is fully
  transparent.  The monitor also has some other things, designed for those
  who don't know about machine code programming (for example the screen
  dumping to the printer in different sizes) and some of them are very
  useful for making maps of games.

- Warajevo is the only emulator for DOS which implements correct operation of
  programs which need the old ZX Interface 1 ROM, like Trans Express, Easyuse
  Microdrive Utility, etc. (XZX emulator for Unix also has the same feature).
  Of course, programs which need the new ROM work too!

- The very powerful Windows-like environment of the emulator allows
  manipulation of TAP and snapshot files (reorganization, compression etc.),
  fully bi-directional communication with Spectrum, conversion of ASCII files
  to and from other formats (BASIC, GENS, etc.), the conversion of SCREEN$
  files to TIFF, the conversion of TAP and snapshot formats from 'Warajevo'
  to the format of many other emulators and vice versa and more. The user can
  manage their database of Spectrum programs (the name, the producer, the
  type, etc.). To every program you can add data about the tape where the
  program is located (or snapshot file when it's a program image), the
  position on the tape, the disc drive where the tape is placed, the programs
  parameters, etc. This allows very easy starting of Spectrum programs, using
  some simple commands.

- Using the additional program ZXCOMP the Z80 snapshot files can, with some
  conditions, be converted to EXE programs which can be executed totally
  independently from the emulator, and they are not too much larger than the
  snapshot files themselves. This is also a unique feature of the Warajevo
  emulator!

- This emulator is freeware software, and all users will have all options
  available in the emulator!!!

       It is important to emphasize that the Warajevo emulator uses Lunter's
'Z80' format for snapshot files, which is probably the most popular format.
Native formats of 'TAP' files are different in these two emulators, but
starting from release 2.0. Warajevo uses an extended 'TAP' format which
includes Lunter TAP format as a special case. So, Warajevo can work with
Lunter TAP files without conversions. A lot of snapshot files in 'Z80' format
(and tape files in Lunter 'Z80' format) can be found on FTP servers like:

ftp.nvg.unit.no         directory     /pub/sinclair/snaps
ftp.gns.getronics.nl    directory     /pub/os/sinclair

       If you only have E-MAIL, not FTP access, on the Internet there are
servers (like BITFTP) which can send you files from FTP servers as UU-encoded
E-MAIL messages.

       Between April 1995 and December 1997 we received E-MAIL messages
from 28 countries, from all 6 continents (Argentina, Australia, Austria,
Canada, Czech, Croatia, Danish, France, Germany, Great Britain, Latvia,
Netherlands, Hungary, India, Italy, Macedonia, Norway, Portugal, Romania,
Russia, Slovakia, Slovenia, South Africa, Spain, Sweden, USA, Uruguay,
Yugoslavia), with greetings, questions, new ideas and bug remarks. We
apologise if any message remain unanswered because E-MAIL in Sarajevo is not
very stable so it doesn't work from time to time.

       And lastly, one important thing. If you have an extremely slow
computer, don't use releases 2.0 or newer. Instead, search for Warajevo
release 1.5. Releases 2.0. and newer are Real-Time emulators, but the price of
this is the fact that the clock speed of the computer must be about 33 MHz or
more for correct operation, otherwise the emulator will work much slower than
release 1.5. Newer releases are not yet optimized to adapt themselves to the
slowest computers. However, we hope that the time of slow computers has
passed, so this will probably not be a problem. To make a rough test as to
whether your machine is fast enough for normal execution of the emulator,
after starting the emulator type this command in BASIC :

BEEP 10,0

If the produced sound has a duration of exactly 10 seconds, everything will
be OK.  But, if you got a sound which had duration of 20 seconds, your
computer is twice as slow as is necessary for correct emulation.

       Also, by keeping the older versions, you can solve the problem that
should your favourite game not work in release 2.51. due to some new-made bug
which wasn't present in earlier versions you can still use it.


1.2.   CONTENTS OF THE PACKAGE
       =======================

       In the package, there are these files:

WARAJEVO.EXE  Full environment of the emulator
WARAJEVO.HLP  Help file for the environment
WARAJEVO.ICO  MS Windows icon
WARAJEVO.PAL  Palette file, may be customized to change palette colors
WARAJEVO.DOC  Documentation in English
SPEC48.EXE    Kernel of the 48K version of the emulator (without environment)
SPEC128.EXE   Kernel of the 128K version of the emulator (without environment)
TS2068.EXE    Kernel of the TS2068 version of the emulator (without env)
NEWS.DOC      What's new in release 2.51, English text
FAQ.DOC       Frequently asked questions, English text
TRANSHLP.DOC  Flowchart diagram which helps the user to transfer Spectrum
              programs to the PC
ZX48.ROM      ROM file for 48K version of the emulator
ZXI1.ROM      ROM file for emulation of Interface 1 (new and old ROM version
              in same file)
ZX128_0.ROM   ROM file for 128K version of the emulator (Derby ROM)
ZX128_1.ROM   ROM file for 128K version of the emulator (Standard ROM)
ZXP2_0.ROM    ROM file for the emulation of Spectrum +2 (Derby ROM)
ZXP2_1.ROM    ROM file for the emulation of Spectrum +2 (Standard ROM)
TS2068_H.ROM  ROM file for the TS2068 version of the emulator (HOME ROM)
TS2068_X.ROM  ROM file for the TS2068 version of the emulator (EXROM ROM)
COMM128.BZX   Communication program for ZX Spectrum 128
PARALLEL.COM  External driver for parallel printer interface emulation
PARALLEL.ASM  Source file for the driver PARALLEL.COM (as an example to show
              how users can make external drivers for emulator expansion)
ZXCOMP.EXE    Compiler for converting snapshot files to EXE programs
MAKEREG.EXE   Utility for registering Spectrum file types for use in Win95
ICO&PIFS.ZIP  Archive with icons for various Spectrum file types, and PIF
              files for easier working on Windows 95

As you can see, the documentation in Bosnian language is not more the part of
the Warajevo package. It can be downloaded separately from the Warajevo home
page:

http://www.void.demon.nl/warajevo/index.html

       The programs in this package use, or create, the following files:

*.TAP         The files for emulation of the tape
*.Z80         Snapshot files
*.MDR         The files for emulation of the microdrive cartridge
*.DCK         The files for emulation of Timex memory expansions
*.BAK         BACKUP files created by environment using some commands
*.nnn         The files created by environment as a result of extractions
DEFAULT.CFG   Global emulator configuration file
SPECSIM.CFG   Local configuration file used by emulator for communication with
              the environment
MONITOR.OUT   The file created by the monitor
SOFTWARE.DBF  The program database
SOFTWARE.DBT  The file with descriptions joined to file SOFTWARE.DBF
ADDITION.DBF  The file with additional data
ZXSHREP.TXT   Report file created using environment
WARAJEVO.REG  Registration entry update file for updating Windows 95 registry
              base, created by utility MAKEREG


1.3.   HOW TO HELP AUTHORS (!)
       =======================

       This program is freeware, and you can give it to anybody if you don't
change or remove anything from the package. However, we still don't have very
good sources of money (although much better than 2 years ago), so every
donation is welcomed. If you like this program, and if you want to help the
authors, pay the desired value to one of the following banks:

Bank:                                       Currency:      Account number:

ABANKA LJUBLJANA (Slovenia)                   DEM          7010-070-280-8753
CREDITANSTALT BANKVEREIN WIEN (Austria)       ATS          0101-66536/00
DEUTCHE BANK AG FRANKFURT/M (Germany)         DEM          9362617
DEUTCHE BANK AG FRANKFURT/M (Germany)         USD          9362617
SWISS BANK CO ZUERICH (Swiss)                 CHF          163973-0
SWISS BANK CO ZUERICH (Swiss)                 USD          147547-0
ABN-AMRO-BANK AMSTERDAM (Netherlands)         NLG          54.04.28.213
ABN-AMRO-BANK AMSTERDAM (Netherlands)         USD          54.04.93.929
DEN DANSKE BANK COPENHAGEN (Denmark)          DKK          512392
DEN NORSKE BANK OSLO (Norway)                 NOK          7001-02-25335
SKANDINAVISKA ENSKILDA B.STOCKHOLM (Sweden)   SEK          5201-85 507 48

       The payment is possible in any bank and in any country, to one of
these account numbers of 'Central banka DD Sarajevo' (former 'Kreditna
banka DD Sarajevo').

       When paying, it is necessary to include the following:

- The receiver's name and surname;
- The address of the receiver;
- The number of the receiver's personal card;
- Telephone number of the receiver.

The necessary data about us is:

Zeljko Juric                            Samir Ribic
Brcanska 10, 71000 Sarajevo, BiH        Trg ZAVNOBiH-a 14, 71000 Sarajevo, BiH
LK 5013/91                              LK 11899/88
telephone 387 71 526-726                telephone 387 71 543-174

       If you want to contact us, these addresses are not very useful,
because the letters to Sarajevo are delayed quite a lot. Also, a telephone
call is not recommended because it is expensive for you.  It is best to use
E-MAIL. Our Internet E-MAIL addresses are:

ZJURIC@UTIC.NET.BA
MEGARIBI@HSL-SARAJEVO.COM
MEGARIBI@HERMES.SI

       Thank you in advance. From release 2.0. if you donate 80 DM or more
you will get the source code of the emulator. To other donators, we cannot
unfortunately promise anything special, except that we will include, in all
new releases of the emulator, the list of donators with values of donations.
Be aware of the fact that some donation may be good motivation for us to
make a new release of the emulator soon!


1.4.   ACKNOWLEDGEMENTS
       ================

       Of course, many people helped us to realize this project. We want to
thank:

- Martijn Van Der Heidne from Netherlands, for giving us about 15 MB of space
  on his site for Warajevo home page support;
- George Hills from United Kingdom, for a donation of 30 pounds and the
  pointing out of some errors;
- Jahn Claus from Germany, for a donation of 100 DM and supporting of the
  Warajevo emulator in his program ZX Rainbow;
- Klaus (surname is unfortunately lost) from Austria, for donation of 50 DM;
- Per Christensen from Sweden, for donation of 200 SK;
- Lee J. Dowling from United Kingdom, for correcting grammatical errors in
  the English documentation;
- Prof. Dr. Sc. Ahmet Mandzic from Sarajevo, for accepting the emulator as
  Samir's graduate thesis;
- Vatroslav Sobot from Croatia, for his program Mastercopy 128 which is used
  as a base for the communication program;
- Gerton Lunter from Netherlands, for sending us his program for comparison,
  sending our program to the world, and for the information about the
  Warajevo emulator in his documentation;
- Alvin Albrecht from Canada, Keith Watson from USA, and Paul Hodgson from
  Great Britain, for great help with technical data, documentation,
  suggestions and test programs related to Timex Sinclair emulation;
- Rui Fernando Ferreira Ribeiro from Portugal, for fixing a bug with keyboard
  hanging on some boards, and for a routine for loading programs from tape
  recorder directly to PC;
- Tomaz Kac from Slovenia, for his program PLAYTZX, which is used as base for
  implementing TZX support in the Warajevo emulator;
- Belan Josip and Cvetkovic Dalibor from Sarajevo, for helping us with the
  solution of some hardware problems;
- Almir Osmanovic from Sarajevo, for giving us many Spectrum programs for
  testing;
- Martijn Van Der Heidne from Netherlands, for supporting the Warajevo
  emulator in his program SGD, and maintaining a fascinating Internet site
  with ZX Spectrum software;
- Paul Hodgson from Great Britain, for support of the Warajevo TAP format in
  his MultiMachine emulator;
- Miodrag Stancevic from Yugoslavia, for pointing out problems during the
  execution of some Spectrum programs and for sending test software;
- Vaggelis Kapartzianis from Greece, for help in solving some bugs related
  to conversions to and from the ZXT and ZXS formats supported in his
  emulator ZX32, bugs in the 'Start' button, etc.
- Eduard Schmidt from Germany, for finding a bug in ZXCOMP;
- Damien Burke and Philip Kendall from Great Britain, for maintaining the
  COMP.SYS.SINCLAIR FAQ list, in which the Warajevo emulator is described in
  detail;
- Philip Pogosov from Russia, for finding a bug in the /?86 switch;
- Lee Tonks from Great Britain, for noticing a bug in the AY emulation code
  with Sound Blaster card;
- Uros Zupan from Slovenia, for noticing some bugs in TZX loading;
- Rodolfo Edison Guerra from Uruguay, for sending his program SPECBASE,
  with suggestions on how to convert between his and Warajevo's database
  formats;
- Hynek Med from Czech, for uploading release 1.2 on the Internet;
- Milan Pikula from Slovakia, for some useful suggestions about problematic
  VGA cards;
- Daniel Herak from Croatia, for information about hosts for Spectrum
  software and sending release 1.1. of our program to the world;
- Dragan Ivanovic and Aleksandar Zelenovic from Sarajevo, for some useful
  suggestions about the emulator.

       The organizations we want to thank are:

- UNHCR and many relief organizations, because we did not die of hunger;
- Bosnian Army, because it defends our city;
- SOROSH foundation, for installing and financing E-MAIL;
- Electrodistribution in Sarajevo, for minimal amount of electrical power;
- SFOR, because they don't permit starting the war in our country again.


2.     BASIC INTRODUCTIONS
       ===================

       You can start the emulator from DOS by typing WARAJEVO, and you will
enter the environment of the emulator, which will be described in detail in
chapter 3. From the environment you can start the emulator by pressing F10,
and pressing F10 again (or right mouse click) will go back to the environment.
Also, you can directly call the emulator kernel from DOS by typing SPEC48
(48 version), SPEC128 (128 version) or TS2068 (Timex version), and you can
call the environment using F10 from those programs too.

       The ZX Spectrum 128 is not 100% compatible with the Spectrum 48K, so
it is not recommended to run programs designed solely for the Spectrum 48K
using SPEC128, except if you have some special reason for do it (for example,
if the 48K program supports AY sound). Starting from release 2.5. snapshot
files from 48K versions of the emulator may be loaded into the 128K version
without any conversion, which was not true in earlier releases. Also, snapshot
files from the 48K version can be loaded into the Timex version (the chances
of their working are slim, though, due to changed ROMs), but snapshot files
saved from one Timex version cannot be loaded in any other version, due to
Timex specificity.


2.1.   THE COMMAND LINE PARAMETERS
       ===========================

       The programs SPEC48, SPEC128 and TS2068 accept a lot of command line
parameters. Almost all options may be set using the environment (so the user
need not worry about command line parameters), but describing command line
parameters is very important because then the describing of the many options
in the environment will be much easier. Square brackets mean that that
particular parameter argument may be omitted.

       WARAJEVO accepts some command parameters too, but they will be
described in chapter 3. which is dedicated to environment.

/V<code>
--------

       Normally, the emulator automatically detects graphic cards. If it is
necessary to change the graphics mode it uses due to incorrect detection,
you can use option /V<code> :

/VC - Force CGA card, in the monochrome mode;
/VW - Force CGA card, in the color mode which is suitable for windowed running
      under MS Windows;
/VH - Force Hercules card;
/VX - Activate non-standard resolution on Hercules card to establish a full
      screen picture;
/VE - Force EGA card;
/VM - Force EGA Mono card.
/VV - Force VGA card.

There are a few reasons for using these options:

- Under MS Windows the emulator can be run in windowed mode using the options
  /VC and /VW (/VW is recommended).
- On Hercules card systems the option /VX displays a nicer picture. However,
  this mode requires synchronization adjusting on some monitors.
- On VGA cards using /VE gives a smaller picture on the screen (due to a
  changed number of scan lines) if the resolution looks too ugly for you
  (but this will not work on all VGA cards), or /VM if you want shaded
  graphics (without attributes). On VGA and EGA cards you can use the /VC or
  /VW switches too, but these are not very useful on these cards.
- If you have a non-standard card compatible with one of those listed, but
  the emulator doesn't automatically recognize it or recognizes it
  incorrectly you can use these options to change the mode Warajevo uses.

       On CGA, Hercules and EGA Mono cards, the attributes are emulated by
shading (BRIGHT is not implemented). On the CGA card the FLASH attribute will
be replaced with inverse character, and all other cards emulate FLASH
correctly.  VGA and EGA display all of the Spectrum colors including BRIGHT.
We were critizied due to a bit of an odd color palette, so starting from
release 2.0. the VGA dark yellow is really yellow (in earlier releases it was
more like brown). However, EGA still uses the old color palette, because EGA
doesn't have two intensities of yellow color. Some color combinations
emulated by shadings on mono cards are unreadable. This fixes option the /VX.

       On Warajevo 2.51 with VGA card the color palette may be customized. The
WARAJEVO.PAL file which is supported with the Warajevo 2.51 contains
informations about actual color palette which will be used (the organization
of this file is described in chapter 7.9.6.). The default WARAJEVO.PAL file
has settings which is very close to the colors on the real ZX Spectrum. If the
WARAJEVO.PAL file is not present, the emulator will use the default VGA
palette, like in earlier releases (some users didn't like this palette, so we
introduced user-definable palette). The WARAJEVO.PAL file is optimized for
color monitors, so if you have a monochrome VGA monitor, removing of
WARAJEVO.PAL file is strongly recommended.

       Parameter /V may be set from the environment using the menu 'Setup'
and the dialog 'Video'. The shortcut for this dialog is pressing F5 in the
environment.

/M<mode>
--------

       Emulation of attributes using shades sometimes results in unreadable
combinations. Also, the color CGA mode emulates only four colors, and the
other four colors are combinations of the first four. Using this option you
can disable the emulation of attributes (or change the four base colors in
color CGA mode).

       On Hercules, EGA Mono and CGA cards in mono mode the command /M has
the following meaning:

/M0 - Attributes are emulated by shading (default);
/M1 - Attributes are not emulated, background is black and pixels are white;
/M2 - Attributes are not emulated, background is white, pixels are black.

       On a CGA card in color mode the command /M has the following meaning:

/M0 - Base colors are black, magenta, cyan and white (default);
/M1 - Base colors are black, red, green and yellow;
/M2 - Base colors are blue, red, green and yellow.

       This option may be set from the environment using the menu 'Setup'
and the 'Video' dialog (shortcut F5), or from the emulator itself, also by
pressing F5. On EGA and VGA cards the option /M is ignored. However, some
pictures look blocky when you turn off attributes. Also, some programs set
the same ink and paper color to hide strange data on the screen, so in
such programs switching attributes off is not recommended.

/K
--

       FLASH is implemented as normal (on CGA it is shown as inverse
characters). However, FLASH is not used if the emulation of attributes is
switched off. Consequently, the cursor becomes an ordinary letter, hard to
distinguish from other letters. Option /K changes the ROM, and the cursor is
displayed inverse. As a negative effect, programs that contain a check of the
ROM will not work (this is very rare, though). From release 1.5, the command
/K is less useful, because from this release FLASH on CGA will be converted
to INVERSE, which was not case in earlier releases of the emulator. Now, this
option is useless, because nearly all users use only VGA compatible graphic
cards.

       This option may be set from the environment using the 'ROM' dialog in
the 'Setup' menu.

/U<mode>
--------

       The emulator does implement the border (on CGA, Hercules and EGA Mono
cards as a thin frame around the screen, and on EGA and VGA on full screen).
Starting from release 2.0, the border implementation on a VGA card is
considerably improved, so many programs which change the border in
synchronization with the picture generation (e.g. Aquaplane, Vectron,
Treasure Island, 4D Terror Daktil, GU! etc.) now work correctly (synchronous
emulation). However, emulation is still not perfect (only the ZX32 emulator
for Windows 95 has a better emulation), so a small number of programs still
don't emulate all border effects correctly (look at the program MDA DEMO on
the ZX32 emulator). The emulator also emulates sound; it is not always
welcomed (e.g. during the night). This is the reason for the existence of
option /U:

/U0 - Border and sound are not emulated;
/U1 - Border is emulated asynchronously (like in release 1.5.), and sound is
      not emulated;
/U2 - Only sound is emulated;
/U3 - Border and sound are emulated, with asynchronous border emulation;
/U4 - Border is emulated synchronously, and sound is not emulated;
/U5 - Border and sound are emulated, with synchronous border emulation.

       If no parameter is given, /U3 is assumed, as in earlier releases of
the emulator. Options /U4 and /U5 on non-VGA cards have no effect, and the
emulator will substitute them with /U0 and /U2 respectively. During
asynchronous border emulation hires border effects will not work, so programs
like Aquaplane will cause ugly border flickering. In such cases synchronous
emulation is recommended. Also, asynchronous emulation may cause "snow" on
screen when the border is changing too fast (this is especially visible
during emulation of tape loading, see chapter 2.4.). However, synchronous
emulation needs more computer resources, and it is not recommended on very
slow machines.

       The same things can be done from the emulator itself, by pressing F4
(sound off/on) and F6 (border off/on, and on VGA performs triple switching
asynchronous/synchronous/none border emulation). Options /M1 and /M2 switch
off border emulation too (except in color CGA mode). From the environment
these options may be set using the 'Video' and 'Sound' dialogs in the
'Setup' menu. These dialogs have shortcuts F5 and F4 respectively in the
environment.

/S<mask>
--------

       By default, the 128 and Timex versions of the emulator emulate
three-channel sound generated by the AY chip using the PC beeper by
interlacing the channels. This often sounds very good (but sometimes is
terrible, like in 'Elevator action'). However, sometimes it is better to
emulate only one channel (playing the main melody) or two of three channels.
For this purpose you use the option /S:

/S0 - All 3 channels are emulated (default).
/S1 - Channels B and C are emulated.
/S2 - Channels A and C are emulated.
/S3 - Only channel C is emulated.
/S4 - Channels A and B are emulated.
/S5 - Only channel B is emulated.
/S6 - Only channel A is emulated.
/S7 - The AY chip is not emulated.

       Generally, the emulation of the AY chip on the PC beeper is better
than in other emulators (see also the description of the next option). Only
by experimenting can you decide which parameter using /S is best for you
because it varies from program to program. On the 48 version of the emulator,
this option is ignored.

       This option may be set from the environment using the 'Sound' dialog
in the 'Setup' menu (shortcut for this dialog is F4 in the environment).

/SX
---

       Something totally new: starting from release 2.5. we tried to emulate
the exact behaviour of the AY chip, including the noise generator, digital
sound effects, speech generation and so on. Option /SX tries to reproduce
exact AY sound using only the PC beeper using a method of adaptive
thresholding of emulated real AY output. In some programs it will sound
perfect (but not always). So, you will often get perfect 3-channel AY sound
through the beeper with speech and noise effects! Working under Windows is not
recommended with this option, because very precise timing is needed. Try it...

       This option may be set from the environment using the 'Sound' dialog
in the 'Setup' menu (shortcut for this dialog is F4 in the environment).

/SA
---

       Using this option, AY chip emulation will not be performed using the
beeper, but by using an AdLib compatible sound card (which includes Sound
Blaster) using FM synthesis. The sound is quite good, but the FM method does
not allow exact emulation of all AY chip features, including speech
generation, digital sound effects, exact emulation of noise generator etc.
This is recommended if you have a sound card and a not-very-fast machine (on
fast computers /SB is often better), or with programs where /SB gives harsh
sound. This option is ignored on the 48 version of the emulator.

       This option may be set from the environment using the 'Sound' dialog
in the 'Setup' menu (shortcut for this dialog is F4 in the environment).

/SO
---

       Acts like /SA, but provides compatibility with very old sound cards
with an OPL2 chip, which needs a very time-consuming protocol to communicate
with the sound card.

       This option may be set from the environment using the 'Sound' dialog
in the 'Setup' menu (shortcut for this dialog is F4 in the environment).

/SB[<address>[;<dma>]]
----------------------

       This option is similar to /SA, but uses features of the Sound Blaster
compatible cards, which allows exact emulation of the AY chip (which was not
present in release 2.0.), emulation of the MIDI interface on Spectrum 128,
and reading real tapes from a real tape recorder directly into the emulator
kernel. Sound is often as good as the X128 emulator by James McKay or even
better, with considerably lower hardware requirements.  Working under Windows
is not recommended with this option because very precise timing is needed.
Unfortunately, everything is not as perfect as it sounds: in certain programs
there is some interaction between our methods of sound generation and memory
paging on the Spectrum 128, which causes very ugly sound distortion. In such
cases, use option /SA. For an explanation, see chapter 7.6. We discovered a
way to solve this problem, but the solution requires total reorganization of
the whole emulator and usage of the 386 instruction set, and it is too late
to build such a solution into release 2.51. We promise that you will soon have
release 2.6. with perfect sound, better than in emulator X128 and that it
will be usable even on a 50 MHz machine!

       Parameter <address> is the decimal base address of Sound Blaster card,
but if you omit it, the emulator tries to determine this address for itself
(this is typically 544, that is 220h). Also, you can set the number of DMA
channels which the sound card uses for 8-bit transfer (range 0-3, default is
1).

       On the 48 version of the emulator, this option may be used only for
activating the Sound Blaster card as an input for loading programs from real
tape using a real tape recorder directly into the emulator through a Sound
Blaster input.

       This option may be set from the environment using the 'Sound' dialog
in the 'Setup' menu (shortcut for this dialog is F4 in the environment).

/N
--

       This option disables drawing of the title picture when you run the
emulator. This only affects the program when you start the emulator kernel
directly from DOS using SPEC48, SPEC128 or TS2068. Calling the emulator from
the environment will never display the title screen.

/E[X]
-----

       Normally, the ZX Interface 1 is not emulated. If you specify the
option /E, the ZX Interface 1 is emulated. In that case, the file ZXI1.ROM
must be present. The ROM switching is done only in the lower 8K, while the
real ZX Interface 1 switches all 16K. If you want to emulate this, use the
option /EX, but the switching will be slower. Using the option /# will
activate option /E too.

       With the emulator, the new version of the 8K ZX Interface ROM is
supported (there were two different versions of the ROMs). Some ill-based
programs will not work with the new version, but there are also programs
which work only with the new version. Some programs (for example, Beta Basic
3.0.) have two versions, one for the old and one for the new ROM. If you have
a program which works only with the old ROM, add the letter O after the
letter E in this option (e.g. use /EO or /EOX), and the emulator will use
the old Interface 1 ROM.

       For Timex Sinclair 2068 computers, the ZX Interface 1 officially does
not exist (although some projects made by independent authors do), so it is
not emulated on the Timex version of the emulator. Instead, option /E on the
Timex version of the emulator has a totally different meaning, which will be
described later in this chapter.

       From the environment the option /E may be set using the 'Interface I'
dialog in the 'Setup' menu. Also, the option /E will be set after using
the command 'Select' from the submenu 'Microdrive' of the 'MdriveFiles' menu
(shortcut F8 in the environment), using the command 'Network' in the 'Setup'
menu, or using some commands from the 'DataBase' menu.

/D[<drive>:][<path>]
--------------------

       This sets the active disc and directory for TAP files (which emulate
tapes) and the default disc and directory for snapshot, microdrive and DCK
files. If the directory does not contain any tapes (i.e. a TAP file), and if
/T option is not present the emulator creates an empty tape file called E.TAP.

       The option 'Select' in the submenu 'Tapes' of the 'TapeFiles' menu in
the environment (shortcut F2 in the environment) sets this parameter based on
the disc and directory which contains the selected TAP file. Some other
options (for example from the 'DataBase' menu) may set this parameter.

/R[<drive>:][<path>][<filename>]
--------------------------------

       This loads the snapshot file. The assumed extension is '.Z80'. The
snapshot files are compatible with the emulator called 'Z80', written by
Gerton Lunter up to and including release 3.03 so you can load the snapshot
files created with this emulator. If the name is omitted, the assumed name is
SNAP.Z80. If the names of drive and directory are omitted, the assumed names
are those given by the option /D, or the active drive and directory if the
option /D is omitted. The directory name must not contain the character '.'.

       The option 'Select' in the submenu 'Snaps' of the 'Z80Snaps' menu in
the environment (shortcut Shift+F7), and some other options (for example from
the 'DataBase' menu) will set this parameter.

/E[<drive>:][<path>][<filename>]
--------------------------------

       This loads the DCK files which are used for emulation of memory
expansions on the Timex 2068 computer (only on Timex version of the
emulator). More about DCK files can be found in chapters 2.8. and 7.9.4. The
assumed extension is '.DCK'. If the names of the drive and directory are
omitted, the assumed names are those given by the option /D, or the active
drive and directory if the option /D is omitted. The directory name must not
contain the character '.'.

       The option 'Select' in the submenu 'Docks' of the 'DockFiles' menu in
the environment will automatically set this parameter.

/T<filename>
------------

       This option sets up the active tape. The tape will be ready for work
when you start the emulator. It is not necessary to write the extension, but
if it is written it must be '.TAP'. Omit the names of the drive and
directory, and use the option /D. If a tape with the defined name does not
exist, an empty tape with this name will be created. The active tape may be
changed from the emulator itself by pressing F2. More about tapes and
emulation of the tape recorder will be written in the chapter 2.4. In the
name of the tape you may use wildcards '*' and '?', but it is not very useful
except with option /O. Starting from release 2.0, the emulator now recognizes
tape files in Lunter TAP format, with equal placing with native Warajevo TAP
files.

       The option 'Select' in the submenu 'Tapes' of the 'TapeFiles' menu in
the environment (shortcut is pressing F2 too, but in the environment), and
some other options (for example from the menu 'DataBase') will set this
parameter.

/F<filepos>
-----------

       This option seeks to the desired block in the active tape. It is used
almost exclusively with option /A. Of course, the seeking may be done from
the emulator itself (F2). This will be discussed more later.

       This option may be set from the environment by selecting the desired
file using the 'Parameters' dialog in the submenu 'Tapes' of the 'TapeFiles'
menu.  Before this, you must first select the active tape. The shortcut for
calling the 'Parameters' dialog is Shift+F2 in the environment.

/A[-]
-----

       After you choose the desired drive, directory, tape and position of
the block on the tape using /D, /T and /F, using the option /A you could
establish automated starting of the program on the tape. This option makes
small changes to the emulator's ROM, so that after the emulator starts,
LOAD "" is performed automatically. Also, the writing of the message
'Program....' is removed, and the initial attribute is changed from 56 to 7
(white on black), with the idea that the loading of the program causes the
least possible side-effects on the screen. After loading the program (more
precisely, after loading the first header), all ROM changes are cancelled, so
there is no problems with ROM checking. On the 128 version, the option /A
loads and automatically starts the program in '128' mode. On the Timex
version of the emulator, option /A works either with the Timex Sinclair ROM,
or with the ZX Spectrum ROM (but will not work in presence of LROS or AROS
programs like OS_64). The option /A is very powerful, but also complex to
use. The database which is built-in to the environment automates use of the
options /D, /T, /F and /A and makes working with the emulator very simple.
The option /A is ignored if the option /R is given too.

       Giving the option /A with a tape file on which no BASIC loader exists
may cause a loop such that the RESET key (F9) will not help. In such cases,
calling the environment using F10 will help. Also, sometimes changing the
initial attribute from 56 to 7 may cause incorrect operation of some
programs. This problem can be solved using the /Y switch, which is described
later in this chapter.

       The option /A- cancels a previously used /A option. This is
implemented if you want (for any reason) to cancel autostart of a program
from the database, because using the database automatically sets option /A.

       This option may be set from the environment using the 'Parameters'
dialog in the submenu 'Tapes' of the 'TapeFiles' menu. This dialog has
the shortcut Shift+F2.

/Y<attr>
--------

       Using this option, it is possible to change the initial attribute
which the option /A sets. The default value is 7. If you use option /Y
correctly, and use BORDER, PAPER and INK instructions with the corresponding
values in the BASIC loader (i.e. the loader which is started using /A),
the program loading and its start should be performed invisibly, without any
additional effects on the screen (if you are too pedantic and this disturbs
you). Most of the users will not use this option. We must say that some
program exists (but they are rare) which will not load correctly (or will not
work after loading) if the initial attribute is not black on white (56), so
if you are afraid about such problems, put the switch /Y56 into the
configuration file DEFAULT.CFG.

       This option may be set from the environment using the 'Parameters'
dialog in the submenu 'Tapes' of the 'TapeFiles' menu. This dialog has the
shortcut Shift+F2.

/L<mode>
--------

       The option /L selects algorithm for tape emulation:

/L0 - Algorithm is AUTO, no stopping between blocks (default);
/L1 - Algorithm is SLOW, no stopping between blocks;
/L2 - Algorithm is FAST, no stopping between blocks;
/L3 - Algorithm is AUTO, with stopping between blocks;
/L4 - Algorithm is SLOW, with stopping between blocks;
/L5 - Algorithm is FAST, with stopping between blocks;
/L6 - Algorithm is LPT1 (loading from and saving to a real tape recorder,
      using BG Services' interface on LPT1 port);
/L7 - Algorithm is SBST (loading from a real tape recorder using Sound
      Blaster card; option /SB must also be presented in this case).

       The selection of the algorithm can be done from the emulator itself
(by the F2 key). For more about algorithms for emulation of the tape recorder
see chapter 2.4.

       Options /L0-5 may be set from the environment using the 'Parameters'
dialog in the submenu 'Tapes' of the 'TapeFiles' menu (shortcut Shift+F2).
Options /L6 and /L7 may be set using the 'Sound' dialog in the 'Setup' menu
(shortcut F4).

/O
--

       Use this option with /T. It establishes the 'filter' for the tapes.
For example, after the options /TARC* /O, the emulator will recognize only
the tapes with the names starting with ARC. Another example is that /TSHOOT
sets up the tape SHOOT.TAP for the active tape, but the other tapes may be
used too. If you type /TSHOOT /O the emulator will recognize only the tape
SHOOT.TAP. Sometimes it may be useful. This option can not be set from the
environment.

/#<mdvnum>;[<drive>:][<path>]<filename>
---------------------------------------

       This selects the file <filename> for emulation of the microdrive.
<mdvnum> is the microdrive number, and it may be from 1 to 8. The drive and
directory name may be given, but if you omit it, default drive and directory
will be assumed in accordance with the option /D. The directory name must not
contain the character '.'. If you omit the extension from <filename>, .MDR
will be assumed. Our emulator will accept MDR files created using Lunter's
emulator too. The option /# will automatically activate option /E. More about
microdrive emulation is in chapter 2.5. This option does not work on the
Timex version of the emulator.

       The option 'Select' in the submenu 'Microdrive' of the 'MdriveFiles'
menu in the environment (shortcut F8), and some other options (for example
from the 'DataBase' menu) will set this parameter.

/#N;[<drive>:][<path>]<filename>[;<block_delay>[;<free_len>[;<busy_len>]]]
--------------------------------------------------------------------------

       Selects the file <filename> as the interface file for the emulation of
the Sinclair Network. This file must be located on some shared drive and
directory, so it must be accessible simultaneously by all running emulators
which want to communicate mutually using the network (for example, if G: is a
shared drive, and SHARED is a shared directory, use a command option like
/#N;G:\SHARED\TRANSFER.NET). Any file with 260 or more bytes may be interface
file, but if such a file doesn't exist in the given path, it will be
automatically created.

       Besides the file name, this option may also set 3 parameters which
affect network emulation: <block_delay>, <free_len> and <busy_len>. If you
omit these parameters, 30, 5 and 5 will be assumed, so
/#N;G:\SHARED\TRANSFER.NET means /#N;G:\SHARED\TRANSFER.NET;30;5;5. For an
explanation of these parameters, see the chapters about network emulation
(2.6. and 7.8.). This option does not work on the Timex version of the
emulator.

       All these parameters may be set from the environment using the
'Network' dialog in the 'Setup' menu.

/2
--

       On the 128 version of the emulator this activates the emulation of
the ZX Spectrum +2. On the 48 version, this option is ignored. On the Timex
version, this option does not exist. The main difference is the usage of the
ROM files ZXP2_0.ROM and ZXP2_1.ROM instead ZX128_0.ROM and ZX128_1.ROM. Some ill-based
programs request the +2 ROM's. This option enables operation of such programs.

       This option may be set from the environment using the 'ROM' dialog
in the  'Setup' menu.

/B
--

       This option accelerates BASIC programs by about 10% (in '128 Basic'
on the 128 version of the emulator it could be as much as 50%). This has
almost no negative effects. For details, see the technical part of the manual
(chapter 7.).

       This option may be set from the environment using the 'ROM' dialog
in the 'Setup' menu.

/P<code>
--------

       The emulator emulates the ZX printer and TS2040 printer (Timex version)
at I/O level on the Epson (or IBM) compatible printer or on the HP Laser Jet
printer. Initially, the ZX or TS2040 printer will not be emulated, because
sometimes printer emulation may cause problems with some pirate game loaders.
Using the option /P you will activate ZX or TS2040 printer emulation:

/PE - Emulation using Epson printer with resolution 72 dots per inch. Picture
      will be the same size as on an original ZX or TS2040 printer;
/PB - Emulation using Epson printer, but one ZX or TS2040 printer pixel will
      be converted to a 2x2 pixel matrix on the Epson printer, so a picture
      produced using the COPY command will have full A4 paper width, instead
      of about half of it;
/PL - Emulation using HP Laser Jet printer in the low resolution;
/PP - Emulation using HP Laser Jet printer in the high resolution;

       This option may be set from the environment using the 'Printer' dialog
in the 'Setup' menu.

/J<code>[<calibration>]
-----------------------

       The emulator supports emulation of many joystick interfaces using
different methods. By default, the grey cursor keys and cursor keys on the
numerical keyboard behave like pressing the keys CAPS SHIFT + 5, 6, 7 and 8.
Using the option /J this may be changed:

/JC - Emulates the cursor joystick with the cursor keys: the cursor keys
      on the numeric keyboard generate 5, 6, 7 and 8, and grey cursor keys
      generate CAPS SHIFT and 5, 6, 7 and 8.  The key '+' on the numerical
      keyboard, like the key '~' (more precisely, the key with scan code 41)
      generates '0' (fire).
/JS - Emulates the Sinclair joystick 1 with the cursor keys: the cursor keys
      on the numerical keyboard and the grey cursor keys generate 1, 2, 3 and
      4, and the key '+' on the numerical keyboard and the key '~' generate 5
      (fire).
/JB - Emulates the Sinclair joystick 2 with the cursor keys: the same as /JS,
      but replace 1, 2, 3, 4 and 5 with 6, 7, 8, 9 and 0 respectively.
/JK - Emulates the Kempston joystick or the Timex joystick (Timex version)
      with the cursor keys: the cursor keys on the numerical keypad and the
      grey cursor keys emulate the moving of the joystick using port 31
      (Kempston) or register 14 of the sound chip (Timex), and the key '+' on
      the numeric keyboard and '~' emulate the fire button.

All these options are are disabled if KEYPAD emulation on the 128 version is
active (the KEYPAD is activated or deactivated by pressing the 'NumLock' key).
More about this in the chapters 2.3. and 7.7. The following options do not
affect the behaviour of the cursor keys:

/JA - The Kempston or Timex joysticks are emulated with the PC analogue
      joystick. This option is a bit slow because it calls the BIOS, and the
      principle of analogue joystick reading is a bit awkward. The emulator
      automatically performs joystick calibration, but if you are not happy
      with it, you can use the manual calibration with /JAlllrrruuuddd where
      lll, rrr, uuu and ddd represent 3-digit decimal threshold values for
      left, right, up and down joystick moving (for example /JA090210100200).
      You can read these values using the following QBASIC or GWBASIC
      program:

      10 LOCATE 1,1
      20 PRINT "X=";STICK(0);" Y=";STICK(1)
      30 GOTO 10

      Most analogue joysticks have variable resistors to adjust settings.

/JM - The Kempston or Timex joysticks are emulated with the mouse (the driver
      MOUSE.SYS or similar must be present). This unusual emulation works
      very well in some programs. This option is hard to describe, so try it
      to see. Mouse moving is buffered and, for example, if you make a large
      move to the left, the emulator will return values for the joystick
      moving left for longer.

Some of these options may exist together, for example, you can use /JC and
/JM simultaneously.

       On the Timex version of the emulator, these options are a bit more
specific, because the Timex Sinclair 2068 has two joystick connections (left
and right). So, if you simultaneously give two options which act on Timex
joystick emulation (these options are /JK, /JM or /JA), the first will act
on the left joystick emulation, and the second will act on the right joystick
emulation. For example, if you give /JK /JM the left joystick will be
emulated using the cursor keys, and the right joystick will be emulated using
the mouse, and if you give /JA /JA both joysticks will be emulated using the
PC analogue joystick. If you want only right joystick emulation (for example
using the mouse) without left joystick emulation, use the switch /JN (N=none)
for the left joystick, e.g. /JN /JM. The Timex version of the emulator does
not emulate the Kempston joystick interface.

       You can set all of these options from the environment, using the
'Joystick' dialog in the 'Setup' menu.

/Q<line>
--------

       A new feature in Warajevo 2.5. is the much better emulation of the
video system than in release 2.0. (the only one better than this is the one
implemented in the ZX32 emulator), which can be activated using the /QX
switch, which will be described later in this chapter. However, such
emulation needs more computer resources, so it is not suitable for slow
computers. That's why in the absence of the /QX switch the emulator uses
the older and not so perfect method for emulation of video system. Using such
a method, it is possible that some programs which did not cause flickering on
the original Spectrum will flicker on the emulator. The reason for this is
following: the real Spectrum draws the picture sequentially (line by line,
from the top to the bottom of the screen). The emulator (without the /QX
switch) draws the whole picture at once after some delay from the beginning
of the Z80 interrupt. Programs that rely on the very precise timing used in
picture drawing may cause problems. These problems can usually be removed by
changing time delay between the beginning of the interrupt and the moment of
picture drawing. This delay is determined using the parameter <line> which
may lay in range 0 to 311, or in range 0 to 261 on the Timex version of the
emulator (this number means the number of the scan line on the real Spectrum
which corresponds to the moment when the emulator generates the picture).
The default value when /Q is not given is 150. If you have problems with
flickering in some programs, try increasing or decreasing this value, and the
problems will probably disappear. The parameter /Q is machine independent,
e.g. if some game on one computer works fine with /Q30, it will work fine on
any other computer. However, with this method of picture generation, programs
which use multicolor effects will never work correctly, so on faster
computers the switch /QX is recommended.

       This parameter may be set from the environment using the 'Video'
dialog in the 'Setup' menu (shortcut key F5).

/QX[<delay>[;<extra>]]
----------------------

       When the option /QX is present (introduced in release 2.5.), the
emulator draws the picture like the real Spectrum, so any possibility of
flickering in programs which don't cause flickering on a real Spectrum is
removed and emulation of various multicolor effects are possible. This option
requires a bit of a faster computer, synchronous border emulation enabled
(options /U4 or /U5), and a VGA graphics card. This is the recommended option
on faster computers. In all other cases, the option /QX will be ignored.
However, correct working of all of the multicolor effects needs exact
emulation of the delay introduced by interaction between the Z80 processor
and the Spectrum ULA chip, which is a very hard task. The Warajevo emulator
does not emulate this delay exactly, instead this delay is estimated using
some heuristic rules. So, some multicolor effects will not work correctly.
To allow correct working of such programs, we have introduced the optional
parameters <delay> and <extra>. Parameter <delay> introduces an additional
delay per one scan line, and may be in range -128 to 128. Parameter
<extra> introduces an additional delay per one frame cycle, and may be in
range 0 to 255. In most cases, the user need not change these parameters
because the Warajevo emulator recognizes characteristic multicolor routines
and automatically adapts itself to them, so many well-known multicolor
programs work perfectly (Overscan demo, Echologia, MDA demo) or nearly
perfectly (Shock Megademo) without having to set these parameters. We have
introduce the possibility of changing these parameters directly from the
emulator itself, due to the purely heuristic nature of them. So, pressing F5
or Shift+F5 (alternatively you may use Ctrl+F5 or Alt+F5 instead of Shift+F5)
increases or decreases the parameter <delay>, and pressing F11 or F12
decreases or increases the parameter <extra> assuming that multicolor
emulation is enabled. We know only two programs in which we can not achieve
satisfactory results no matter what settings these parameters have (Hercules
demo and No More Intelligence 3). It should be said that at this moment only
one emulator exists which has a better emulation of multicolor effects (seems
perfect to us): emulator ZX32 for Windows 95 by Vaggelis Kapartzianis.

       The option /QX is not yet implemented on the Timex version of the
emulator but this is not a great pity because Timex has a native multicolor
mode which is implemented, so there is no need to make multicolor effects on
the Timex range of computers.

       These parameters may be set from the environment using the 'Video'
dialog in the 'Setup' menu (shortcut key F5).

/%<num>
-------

       Warajevo 2.51. is a real-time emulator, so all Spectrum programs will
work at the same speed as on a real Spectrum, if the speed of your computer
allows it (this is true on majority of today computers; the minimum required
speed is about 33 MHz!). But if you want to run at, for example, 60% of the
original Spectrum speed, run the emulator with the option /%60. Similarly,
if you want to run three times faster than the real Spectrum (of course, if
your computer can handle it), use the option /%300 (if your computer does not
allow the requested speed, nothing bad will happen, just that the requested
speed will not be attained).

       Changing the emulator speed has the following drawbacks:

- Time (more precisely, system variable FRAMES) will not be updated at
  regular intervals.
- Scanning of the keyboard, if based on the interrupts (like in BASIC) will
  become slower or faster, including autorepeat too.

       This parameter may be adjusted from the environment using the 'Speed'
dialog in the 'Setup' menu. We should say that if you want to put the switch
/% in a batch file, you must double the '%' sign (for example, you must put
/%%150 instead of /%150), because the percent is a reserved character in
batch files. The same is also true for the options /%MAX and /%LMAX.

/%MAX
-----

       If you have a slow computer on which you cannot achieve the emulator
speed which you want, try the switch /%MAX. This option enables additional
optimizations which allow maximum possible speed of the emulator (hires
border effects, multicolor effects and sampled sound using Sound Blaster in
this mode will not work). However, such a maximum working speed is
considerably slower (about 60%) than the maximum speed of release 1.5, so if
you have an extremely slow computer, search for Warajevo 1.5.

       The option /%MAX can be used on faster computers too, if you have some
Spectrum program which is not fast enough, but you want fast execution (for
example, some calculations in BASIC). In such cases, key autorepeat may
become intolerably fast due to the increasing of the execution speed, so
decrease the autorepeat speed using, for example, POKE 23561,100:
POKE 23562,100 (from BASIC, or from the built-in machine monitor).

       This parameter may be set from the environment using the 'Speed'
dialog in the 'Setup' menu.

/%LMAX
------

       Using this option will automatically switch the emulator to it's
maximum working speed during loading programs from TAP or TZX files using
non-standard loaders. When loading is finished, the original speed (that
set before loading) will be restored. This extremely useful option
significantly speeds up loading using non-standard loaders (the speed up is
greater under DOS than under Windows).

       This parameter may be set from the environment using the 'Speed'
dialog in the 'Setup' menu.

/?128
-----

       Using this option (which works only with the 48 version of the
emulator) you can test whether a 48K program supports some Spectrum 128K
options (for example, 3-channel sound). If you give the /?128 option, any
attempt to write to any Spectrum 128K port will cause the emulator to stop
with an error message.  So, you can (if you want) try to load this program in
the 128 version of the emulator.

       This option may be set from the environment using the 'Test' dialog in
the 'Setup' menu.

/?86
----

       This option is included for security reasons. Release 1.5. of the
Warajevo emulator, and newer releases, allow mixing of 80x86 machine code
with Z80 machine code, using so-called 'Escape' sequences (see chapter 5.2.).
Unfortunately, this allows the patching of 8086 'Trojan horses' into Z80
snapshots which can cause some damage. Using the option /?86 removes the
possibility of patching 80x86 code into Z80 code (in such cases, any presence
of patched 80x86 code will cause an error message). Include the option /?86
if you want to be 100% secure when running a snapshot file with unknown
content and source.

       This option may be set from the environment using the 'Test' dialog
in the 'Setup' menu.

/![<opt>]
---------

       The Warajevo emulator installs a handler for the processor interrupt
0DH, because this increases compatibility with Spectrum software. However,
this may cause interaction with some resident programs on 386 (and newer)
machines which use 'virtual 8086' mode, usually EMS drivers like EMM386,
QEMM or MS Windows 386. So, the emulator displays a warning message if the
processor is working in 'virtual 8086' mode (this doesn't mean that a
problem will occur). The option /! prevents the displaying of this warning
message so that you can use this with some program (typically as a initial
option in a database) if you are sure that this program works fine in
'virtual 8086' mode. See 'WRAPPING PROBLEM' in the technical part of the
manual.

       Starting from release 2.5, the optional extra parameter after /! is
introduced which works better under MS Windows. At the moment, this parameter
may have the following values:

/!1 - When using this parameter, the emulator installs a handler which tries
      to repaint the screen when in a multitasking environment and a task
      switch (using Alt+Tab) from some other program to the emulator is
      performed. In earlier releases of the emulator, such task switching
      caused trashing of screen content, and the only solution would be
      to exit the emulator. Unfortunately, we noticed that in some cases and
      on some systems this handler fools Windows (more precise, Windows stops
      generating the picture, we don't know why). Also, repainting sometimes
      will not be performed as well (in such cases double pressing on F1 will
      help). That's why the installation of this handler is optional (the
      user must force it using /!1).

/!2 - When using this parameter, the emulator forbids any access to the
      printer. Namely, any access to the printer when it is not ready will
      cause an error message under MS Windows, and this may fool the
      emulator. Using the option /!2 will much such unwanted occurrences
      forbidden (we have noticed that some programs try to access the printer
      when the user doesn't except it, so introducing this option seems to be
      useful).

/!3 - Acts like /!1 and /!2 together.

If you work under MS Windows, it is good idea to put these options into the
configuration file DEFAULT.CFG. These options may be set from the environment
using the 'MS Windows' dailog in the 'Setup' menu.

/@[@]<time>
-----------

        The options /@ and /@@ are introduced for internal purposes, but
you may make some use of them. Using the option /@<time>, the emulator
automatically stops working after <time>/50 seconds and exits to DOS.
The option /@@<time> is similar, but after the given time limit the emulator
saves the snapshot file TEMP.Z80 and configuration file SPECSIM.CFG as
described in later chapters, then enters the environment if it is present.
These options may be used for various kinds of batch testing, etc.

       These options may be set from the environment using the 'Test' dialog
in the 'Setup' menu.

/&<extra_codes>
---------------

       Command parameters which start with /& affect only the environment,
not the emulator kernel. The emulator itself does not parse them. These
parameters will simply be redirected to the environment, so syntax errors
will be acknowledged only after calling the environment. There are 6 subtypes
of /& parameters:

/&D[<drive:>][<dir>]    Determines the drive and directory which contains
                        the current database for use in the environment.

/&C<code>               Determines the communication port for RS232
                        communication in the environment (/&C1 - COM1,
                        /&C2 - COM2). Default is COM2.

/&S<speed>              Determines the RS232 communication baud rate in the
                        environment (/&S1 - 110 Bd, &&S2 - 150 Bd, /&S3 - 300
                        Bd, /&S4 - 600 Bd, /&S5 -1200 Bd, /&S6 -2400 Bd, /&S7
                        - 4800 Bd, /&S8 - 9600 Bd). Default is 9600 Bd.

/&O<sorting_order>      Determines the sorting criteria for the database (see
                        chapter 3.6.4.).

/&E<code>               Determines whether the environment will call the 48K,
                        128K or Timex emulator (/&E0 - 48K, /&E1 - 128K,
                        /&E2 - Timex) in cases when it cannot be determined
                        using other criteria (e.g. using the type of the
                        snapshot file). Typically, this parameter makes sense
                        only as a parameter in the DEFAULT.CFG configuration
                        file.

/&T<options>            Determines details related to the treatment of
                        various particularities during loading from TZX files
                        (see chapter 3.2.5, option 'TZX conversion setup').

       All of these parameters are rarely used as command parameters.
Instead, the user will prefer setting them using the environment. However, it
is often useful to put some of these in the configuration file DEFAULT.CFG
(see chapter 3.) to avoid their setting every time when you run program.

/C
--

       This option is used mostly for linking the emulator with the
environment, although it can be used independently. Giving the option /C
means that all command parameters will be loaded from the file SPECSIM.CFG.
With the option /C usage of other command options is possible, but any option
written after /C will be ignored.

       The emulator and the environment use this file for bi-directional
communications, so every time the emulator is called from the environment and
vice versa it will create this file in which all parameters setting will be
stored.

       The file SPECSIM.CFG is a simple ASCII file which lists the parameter
settings separated by spaces or by a new line. It must be located in the
directory in which the emulator is located, if users don't specify otherwise
by changing the DOS environment variable WARAJEVO (look chapter 3.).


2.2.   THE FUNCTION KEYS
       =================

       The explanation of the function keys used in the emulator follows:

 F1 - Displays the HELP screen, that shows the meaning of all function keys
      and the layout of the Spectrum keyboard. Unlike earlier releases, the
      HELP screen is now more aesthetically pleasing.

 F2 - Calls the subroutine for selecting the active tape and the active
      block, selecting the algorithm for tape emulation etc. Information
      about this and emulation of the tape recorder is in chapter 2.4.

 F3 - Calls the embedded machine-code monitor, which contains some options
      interesting even to those who have no interest in machine code
      programming (for example, hard-copy of the screen to the printer.) The
      monitor is explained in detail in chapter 4.

 F4 - Activates and deactivates emulation of the sound (beeper and AY).

 F5 - This key has different functions, depending on the graphic mode in
      which the emulator is started.

      In monochromatic modes (CGA mono, Hercules, EGA mono), F5 performs
      cyclic switching of the mode used for attribute emulation (like the
      option /M) in the order /M0, /M1, /M2. See the description of the
      switch /M for more details.

      In color CGA mode, F5 performs default palette switching between three
      possible combinations. For more details, see the option /M.

      In VGA mode, pressing F5 will be ignored if synchronous border
      emulation is not active. When synchronous border emulation is active,
      pressing F5 will activate multicolor emulation. Otherwise F5 increases
      the additional delay per one scan line caused by ULA chip on Spectrum,
      and pressing on Shift+F5, Ctrl+F5 or Alt+F5 decreases this delay. For
      more details see description of the switch /QX. Multicolor emulation
      will be automatically switched off if you disable synchronous border
      emulation using F6.

 F6 - On non-VGA graphic cards activates and deactivates border emulation.
      After deactivating, the border color remains like it was at the moment
      of deactivating. On VGA cards this performs cyclic switching between
      asynchronous, synchronous and no border emulation (see option /U).

      Pressing Shift+F6 will disable picture generation, which is sometimes
      useful during loading from real tape recorder (see chapter 2.4.).
      Pressing Shift+F6 again will enable picture generating.

 F7 - Saves the snapshot file in a format compatible with Lunter's Z80
      emulator (as in version 2.0.). The loading of the snapshot file can be
      done (using option /R) from a file of any name, but saving using F7 is
      always in the file 'SNAP.Z80', on the disc and the directory determined
      using command /D (so changing of the name can be done only by exiting
      to DOS or by calling the environment). If for any reason the saving of
      the snapshot file was unsuccessful, it is reported with a warning
      sound. A more powerful way of saving a snapshot file is calling the
      environment and then using the option 'Rename snapshot' (Shortcut F7).

 F8 - Generate NMI. This is useful only if you have changed ROM's.

 F9 - Generate RESET signal.

F10 - Calls the environment. The current state of the emulator will be saved
      in two files in the emulator directory: SPECSIM.CFG which saves
      emulator parameters, and TEMP.Z80 which is a temporary snapshot file
      (the Timex version sometimes saves a third file TEMP.DCK). Returning to
      the emulator can be done again by pressing F10 (or a double mouse click
      on the screen window, if you set the environment to work in graphic
      mode). If you do not make any changes in the environment, the emulator
      will continue working normally. All this is very fast (about 1-2
      second), so whole process is transparent to the user. The files
      TEMP.Z80, SPECSIM.CFG and TEMP.DCK (Timex) will stay on the disc, so
      you can use them later for any other purposes. They will not be stored
      in the directory determined with /D, but in the directory in which
      the emulator itself is located. Starting from release 2.0, it is
      possible to change the directory in which these two files will be saved
      by changing the variable WARAJEVO in the DOS environment (usually using
      the DOS command SET WARAJEVO=<swapdir>), and this allows you to run the
      emulator directly from a CD ROM. For more details, see chapter 3.
      Pressing the right mouse button has the same effect as pressing F10
      key.

      Pressing Shift+F10, Ctrl+F10 or Alt+F4 (like Windows) leaves the
      emulator and quits directly to DOS, without calling the environment.
      The files SPECSIM.CFG, TEMP.Z80 and TEMP.DCK (Timex) will not be saved
      in this case.

F11 - When multicolor emulation mode is active (using F5), pressing F11
      decreases the additional delay per one frame cycle caused by the ULA.
      For more details, see the description of the switch /QX.

F12 - When multicolor emulation mode is active (using F5), pressing F11
      increases the additional delay per one frame cycle caused by the ULA.
      For more details, see the description of the switch /QX.

The meaning of the function keys in the environment will be described in
chapter 3.10.


2.3.   THE KEYBOARD AND KEYPAD
       =======================

       The keyboard is mostly mapped as the standard Spectrum's keyboard
(F1 displays the keyboard layout on the original keyboard). For CAPS SHIFT
you can use keys 'Shift' or 'Ctrl', and for SYMBOL SHIFT you can use 'Alt'.
Some keys on the PC keyboard have a special meaning:

CapsLock:   CAPS SHIFT + 2                         (CAPS LOCK)
Tab:        CAPS SHIFT + SYMBOL SHIFT              (EXTENDED MODE)
Esc:        CAPS SHIFT + SPACE                     (BREAK)
Backspace:  CAPS SHIFT + 0                         (DELETE)

The cursor keys on the numerical keyboard, like the grey cursor keys,
normally generate CAPS SHIFT + 5, 6, 7 and 8, but this can be changed using
the previously described option /J. The key '+' on the numerical keyboard and
the key '~' (depending on the option /J) behave like a fire button on the
joystick.

       We can not say anything more about the keyboard in the 48 version of
the emulator. However, the 128 version of the emulator also emulates the
KEYPAD. This is the addition to the keyboard delivered with the first
versions of the Spectrum 128K, and later it was bought as an optional. The
KEYPAD emulation activates or deactivates by pressing the key 'NumLock', and
the corresponding LED diode determines whether the emulation is active. When
emulating the KEYPAD, the keys on the numerical keyboard and some grey keys
receive special meaning. Because most of the users had no opportunity to see
a real KEYPAD, we will describe it in more detail.

       The KEYPAD has 18 keys (one key more than is on most PC numeric
keyboards). Its keys have the same labels as the PC, except that 'NumLock'
doesn't exist, and left and right brackets are present. The keyboard layout
is almost identical, with small differences. The keys '*' and '/' are above
the keys '7' and '8'. The keys '(' and ')' are above '9' and '+'. Instead of
a big '+' key, on the KEYPAD there are the keys '-' (up) and '+' (down), one
key above another. The layout of the other keys is the same. But on the
KEYPAD keys there are also the labels showing different enhanced editor
functions. The ROM routine which reads from the KEYPAD interprets the
pressing of these keys differently depending on whether the computer is in
'128 Basic' or in 'Calculator' mode. In 'Calculator' mode the KEYPAD works as
a numerical keyboard. This is implemented in the emulator too, and the keys
are mapped on the PC keyboard as normal (only the brackets are missing), and
there is nothing more to say. However, in '128 Basic' mode, the KEYPAD keys
have additional functions. Unfortunately, the way they are mapped must be
remembered because these labels are not written on the PC's numerical
keyboard. The keys are mapped in this way:

7 - Cursor left for one character                  (LEFT)
9 - Cursor right for one character                 (RIGHT)
* - Cursor up for one character                    (UP)
8 - Cursor down for one character                  (DOWN)
4 - Cursor left for one word                       (WORD LEFT)
5 - Cursor right for one word                      (WORD RIGHT)
6 - Cursor up for 10 rows                          (PAGE UP)
+ - Cursor down for 10 rows                        (PAGE DOWN)
1 - Cursor to the start of BASIC line              (HOME)
2 - Cursor to the end of BASIC line                (END)
3 - Cursor to the top of the program               (TOP)
. - Cursor to the end of program                   (BOTTOM)
/ - Delete characters left from cursor             (DELETE LEFT)
- - Open command menu                              (CMND)
0 - SHIFT for destructive functions                (DEL SHIFT)

Some destructive functions are activated if you simultaneously press '0' on
the numerical keyboard, and one of the following keys on the numerical
keyboard too:

1 - Delete from cursor to start of line            (DELETE FROM START)
2 - Delete from cursor to end of line              (DELETE TO END)
4 - Delete word left from the cursor               (DELETE WORD LEFT)
5 - Delete word right from the cursor              (DELETE WORD RIGHT)

There are two functions on the keypad (on the brackets) which delete the
character at the cursor position (DELETE RIGHT) and switch the editor's
window to the bottom part of the screen (TOGGLE).  These are mapped to the
keys 'Delete' (grey) and 'Scroll lock'.

       This key mapping is a bit unusual, at first sight. Of course the
keys could be mapped to be like some labels on the PC's numerical keyboard,
but because the KEYPAD is emulated on an I/O level, and the routine in ROM
interprets the keys differently depending on '128 Basic' or 'Calculator'
mode (more precisely, depending on bit 0 of the system variable FLAGS3
(23398) ) any other keyboard mapping (without ROM changing) will ruin the
correct behaviour of the KEYPAD keys in the 'Calculator' mode.

       To simplify the use of some extended editor's functions when KEYPAD
emulation is active the grey keys have the following meanings:

Page Up:    Cursor up for 10 rows                  (PAGE UP)
Page Down:  Cursor down for 10 rows                (PAGE DOWN)
Home:       Cursor to the start of the BASIC line  (HOME)
End:        Cursor to the end of the BASIC line    (END)

The side effect is that pressing of these keys in the 'Calculator' mode
generates the signs '6', '+', '1' and '2' respectively. The key 'Insert' also
works like SHIFT for destructive operations (in the calculator it generates a
sign '0'). The keys 'Delete' (grey) and 'Scroll lock' in '128 BASIC' mode
work as already described. In our calculator mode they generate missing
brackets.

       To reduce confusion, while the KEYPAD is active, the grey cursor keys
always generate the moving of the cursor (CAPS SHIFT + 5, 6, 7 and 8), no
matter what option /J is active.

       We should mention that, because the scanning of the KEYPAD in ROM
executes quite an ugly routine program execution, especially on slower
machines, is slower when KEYPAD emulation is active.


2.4.   THE EMULATION OF THE TAPE RECORDER
       ==================================

       Starting from release 2.5, Warajevo allows loading of Spectrum programs
from real tapes using a real tape recorder, either indirectly in the
environment, or directly into the emulator kernel (more about transferring
programs from the tape will be written later in the manual). However, tape is
a very inflexible device, so it is good idea to transfer Spectrum programs
permanently onto disc. For this purpose, the emulator uses files with the
extension .TAP (we will call them simply tapes).

       The tapes are organized in a flexible way that allows saving of a
block to any place (more about tape organization see below) and can be
compressed. Tapes created using the Warajevo emulator are NOT compatible with
Lunter's emulator, but starting with release 2.0, Warajevo can work with
tapes in Lunter format (in other words, one-directional compatibility is
introduced). So, the format of the TAP files starting from release 2.0.
merges Warajevo 1.5. format and Lunter's format into a practically unique
format. Also, easy conversion from one format to another is possible (and to
and from formats of many other emulators) using various options in the
environment.

       The loading and saving are realized by the classic LOAD and SAVE
commands, as on a real Spectrum (automatic loading is possible, see the
option /A). If LOAD fails, for any reason, the consequences are the same as
on an original Spectrum, which in conventional cases results with 'R Tape
loading error', but which with headerless files need not be the case. If SAVE
failed for any reason (for example if the disc was write protected) the
computer will produce a warning sound.

       Pressing F2 activates a subroutine that selects the active tape and
seeks to any block in the tape (further detail in: Tape Manager). On the top
part of the screen is written the name of the active tape which can be
changed by pressing TAB or F2 (in the directory defined with /D, and
eventually, in accordance with 'filters' set by the option /O), and the
current algorithm for tape emulation (displayed inverted). Below the tape
name, will be displayed a warning message "Non-Warajevo tape!!!" if the
active tape is not in Warajevo format (the emulator assumes Lunter's format
in this case).

       In the middle of the screen data about the current block on the tape
is written. If the block represents any header, the name of the block is
displayed. In this case, also shown are: the type (it can be 'Basic',
'Bytes', 'Number array' or 'Character array'), the size of the block of data
following the header (or, more precisely, the block which should follow the
header according to the header information), and then data dependent on
the header type. For the 'Basic' type the line at which automatic start will
occur is written along with the pure BASIC program size, without variables.
For the type 'Bytes' the address where the block will be loaded is written.
For the types 'Number array' and 'Character array', the array name is
displayed. If the block represents data, instead of the name, the flag byte
is written, and the type is 'Headerless' or 'Compressed' if the block is
compressed (the compression may be executed using the environment). For the
case of compressed blocks, the compressed size is also written, and the
compression efficiency (according to ARJ convention). The header blocks are
never compressed. Also, special blocks exist which contain tone record
samples, which we will describe later in the manual. Such blocks can also be
compressed, so they will be shown in a similar way to compressed blocks, but
the type will be 'EAR Sample', and instead of the flag byte, the sampling
frequency will be displayed. Since such blocks may have unused bits in the
last byte, their length (as shown in the emulator) is not always an integer.
In the case of uncompressed sample blocks, the length is rounded up and the
packed length will be equal to the normal length. Regardless of the current
block type, the current block position in the tape will be displayed after
the mark 'F:' (this is useful for using the /F option).

       On the bottom of the screen there is a brief list of the meanings of
some keys. The active block (i.e. the next block to be loaded, or the block
before the block who will be saved next) is changed with the up and down
arrows. Using the 'PageUp' and 'PageDown' keys you can move to the previous
and to the next block of the BASIC header (typically the loader of any
multi-part program). The 'Home' and 'End' keys seek to the beginning and the
end of the tape, respectively. You can leave the Tape Manager by pressing
either ENTER or ESC. If the active tape is in Lunter's format, moving using
the up arrow and 'PageUp' is not possible, because this format does not
support a fast and effective way of moving backward through the tape, unlike
the native Warajevo format.

       The native Warajevo TAP format allows easy block saving at an
arbitrary place on the tape (all you need to do is seek to the desired point
before saving), but organization of the Lunter TAP format does not allow such
flexibility, so saving is possible only at the end of the tape. For these
reasons, if the active tape is in Lunter's format, saving will be performed
always on the end of the tape, regardless of the position which is set using
the Tape Manager.

       'Backspace' chooses whether the emulator pauses after every loaded
block ('STOP' mode) or not ('CONT' mode). In 'STOP' mode, after every loaded
block the emulator automatically calls Tape Manager, enabling you to change
the tape and position before loading the next block. This is necessary, for
example, if any program after its start expects loading of any block (for
example some data) which is somewhere else. This mode can be very efficiently
used with the option /O. However, in most situations, 'CONT' mode is the
best.

       Release 2.51. has five algorithms for the tape emulation, called AUTO,
SLOW, FAST, LPT1 and SBST which may be changed by pressing SPACE (the default
value is AUTO). The first three algorithms are related to loading and saving
using emulated tapes, and last two are related to loading and saving using a
real tape recorder.

       When AUTO is selected, the emulator traps execution of Z80
instructions on addresses 1388 and 1232 in the LD_BYTES and SA_BYTES routines
(the Timex version also traps addresses 118 and 274) and then executes the
subroutine that loads (or saves) from '.TAP' files from the disc rather than
from the real tape. This works well for the programs that use standard load
routines, whether they have a header or not. However, many programs use
non-standard load routines (for example the running screens, faster loading,
changed border effects, loading with the counter etc.). For example, see
'Spy vs. Spy', 'Fairlight', 'Trap door', 'The halls of the things' and many
pirated programs (which were very popular in former Yugoslavia). Probably the
best loader was published in one computer magazine 'Svet kompjutera': The
loader that contains one primitive game which you can play while loading the
main game! The emulator usually succeeds (by analyzing Z80 machine code) in
recognizing non-standard loading routines and loads such programs! This
sounds incredible, but it is true. We tested many programs with non-standard
routines and we very rarely had problems. There were problems with routines
that modify themselves while loading, routines that use more than one
LD_EDGE subroutine, and with totally non-standard routines. This complex
algorithm for recognizing of non-standard load routines we called EDGE
RECOGNIZER and we explain it in more details in technical part of the manual.
The loading of the program with a non-standard routine is much slower than in
normal situations (but faster than using a real tape) and looks very like
loading on the original Spectrum including sound and border effects (use F4
if sound disturbs you). It is recommended that you switch on full,
synchronous border emulation with the F6 key and by using the same key you
will disable the border if this disturbs you, or if you think that border
effects slow down working too much. Most of the other effects are implemented
too, so now you can see on your PC a long time forgotten 'Running screen'.
However, the emulator does not recognize non-standard saving routines, which
are more rare, and in these cases you must use the monitor.

       If you selected the algorithm SLOW, the emulator does not trap at the
address 1388 (274 in Timex version) in LD_BYTES, and emulation of the tape
recorder is always as with non-standard routines, i.e. slow. This algorithm
can be used if you want the slow loading, for example to read some
instructions that the program keeps on the screen while the next block is
loading. There is another time when you need to use the SLOW algorithm.
The trap routine that loads a block returns most of the registers like the
original load routine, but not all (for example A, B and C registers). During
the SLOW algorithm, the loading will be just as dictated in the loading
routine, including correct updating of all registers. In some very rare cases
some programs are sensitive to values of all registers after loading (for
example some COPY programs), and then we recommend the use of the SLOW
algorithm.

       When the FAST algorithm is selected the EDGE RECOGNIZER is switched
off, i.e. the recognizing of non-standard load routines. In very rare cases
the emulator can recognize the sequence of instructions which are not part of
the load routine as part of the loading routine (we have had no such cases,
but it is possible if you want to torture the emulator). In these cases it is
necessary to use the FAST algorithm. You need to use this algorithm if you do
not want recognition of non-standard load routines, which is very often the
case with protection cracking.

       Algorithm LPT1 does not use emulated tapes. Instead, loading (and
saving too) will be performed using a real tape recorder, with the help of a
very simple interface (which is made of some resistors and capacitors)
connected to the LPT1 port. You can buy this tape interface from the company
 'B G Services' in Great Britain using Giro account 324.82.16. The price is
ú11.50. Or, you can build this interface by yourself. The address of
'B G Services' is:

B G Services              Tel: (0181) 287 4180
64 Roebuck Road           Fax: (0181) 391 0744
Chessington
Surrey KT9 1JX

One schematic of this interface may be found in the file DIAGRAM.Z80 given
with Lunter's Z80 emulator (even with the non-registered version), or it can
be downloaded from the Internet URL address:

ftp.nvg.unit.no/pub/sinclair/snaps/games/by-letter/d/diagram.zip

So, connect the tape recorder to the interface, type LOAD "" in the emulator,
and play the tape. Feels like a real Spectrum! You can load nearly all
programs which are loadable on a real Spectrum, including speedlock protected
programs. However, such loading has two small restrictions. One potentially
problematic thing is screen loading and loaders which change video memory
content during loading (for example, loaders with counters). Namely, updating
of the whole screen content may take a lot of time, which may cause loading
errors. We mainly solve this problem by using various methods. If you have a
fast enough computer (100 MHz and faster), turn on synchronous border
emulation (F6) and multicolor mode (F5). Using such settings, picture
generation will be smooth enough to allow correct loading, so practically all
programs may be loaded with picture generation enabled (screen loading,
loading with counters etc.). This is a great improvement over Lunter's
emulator in which the user must disable screen generation to allow loading!
If you have a slower computer, using some tricks the emulator can perform
standard screen loading without disturbing the loading process, but any
non-standard access to screen (for example in loaders with counters) will
cause loading errors. In such cases, the last solution is disabling screen
updating using Shift+F6, and enabling it again after loading is finished.
The second problem is with programs which have very long blocks where one
block is loaded into various memory banks (in one part) of the Spectrum 128.
Such programs are extremely rare, one example is Barbarian 2 128. Memory
paging in the emulator is slow, so it will disturb the loading process. Such
programs cannot be loaded directly into the emulator. Instead, use the option
'Sample from cassette' in the environment (look chapter 3.2.4.). Note that
any loading from real tape is impossible if you start the emulator under MS
Windows!

       Mode SBST is very similar to LPT1 mode, but the loading is performed
using a Sound Blaster sound card (option /SB must be used in this case,
otherwise SBST mode will not be available for selecting). To accomplish such
loading, you must use your external MIXER program (which is supplied with
your sound card) to turn off everything except line input on one channel
(mono). Due to the very problematic timing of this sound card, loading using
a Sound Blaster is much more unreliable than loading using a LPT1 port, so
for serious applications you must search for B G Services interface. With a
Sound Blaster, loading with synchronous border emulation and multicolor mode
is possible only on very fast computers, so with the Sound Blaster disabling
screen generation using Shift+F6 is needed more often. Saving on a real tape
recorder is not possible using Sound Blaster, because it will cause conflicts
with the algorithm for loading (we thought that reliability of loading is
more important). If you must save something to a real tape and you only have
a Sound Blaster, save it to a tape file, convert this file into a TZX using
the environment, then play the TZX file using the utility PLAYTZX by Tomaz
Kac which may be found on the Internet. Emulation of the AY chip in SBST mode
is disabled, for the same reason.

       As we mentioned earlier, the emulator also supports blocks which
contain samples of real tape input. These samples usually represent samples
of a tone record of some totally non-standard saved program, but principally,
they may also represent music or speech records, etc. Various methods for
creating such blocks exist (see chapter 3.). Loading from such blocks is quite
different: the emulator simply returns value of the tape input bit (bit b6 in
port 254) according to the content of the sampled data at the exact moment
when reading is performed. Warajevo uses an intelligent algorithm which
automatically switches into sample loading mode when a block with samples
appears, so any manual intervention (like 'Start the tape' in X128 emulator)
is unnecessary.

        Simply use AUTO or SLOW tape emulation algorithm (FAST may fail
sometimes). You can read more about this in chapter 7.3.1. However, if our
intelligent algorithm fails due to any reason, you may force sample loading
by entering Tape Manager, moving to desired sample block, and exiting Tape
Manager. This will immediately switch to sample loading mode. Such manual
manipulations are sometimes necessary with multi-level games, because after
loading the main programs sample loading mode will be switched off, so you
need to manually force loading of the wanted overlay level. Do not leave the
tape file on the block with samples when you don't perform loading, else you
will hear a unwanted noise (e.g. "tape recorder" will "play")!

       All these features (except loading from samples) work equally as well
with native Warajevo tapes as with Lunter tapes. In short, the tape emulation
is very flexibe, there is only the question on how to transfer Spectrum
programs to your PC. Generally, there are four ways:

1) A great number of Spectrum programs in .Z80, .TAP, .SNA, .TZX and in some
   other formats may be found on some FTP servers, as mentioned in chapter
   1.1. All these formats are usable on the Warajevo emulator. For more
   details, see chapter 3.9.

2) Warajevo 2.51. in LPT1 and SBST modes allows direct loading of programs
   from a real tape recorder through a LPT1 port or Sound Blaster card, as we
   described earlier.

3) Using the environment, it is possible to load programs from the tape
   recorder to a TAP file. For the details see description of the 'Casette'
   submenu in the 'Communications' menu in chapter 3.2.4.

4) The environment allows transfer of programs from the Spectrum 128 to the
   PC using the RS232 connector on the Spectrum 128. The transfer occurs
   without problems, for normal speed programs, no matter what their sizes.
   We will explain details about this transfer later. For turbo-saved and
   speedlock programs, this method is not suitable.

The preferred method for transfer depends on many things: which machine and
which equipment you have, type of program to transfer, what you want to do
with the program, etc. This may seem confusing. To help users, we made a
flowchart in TRANSHLP.DOC which will explain which method is the best in each
situation.

       The selection of the algorithm for tape emulation can be changed using
the command /L described previously. The selected algorithm practically has
no influence on the speed of the emulator. However, in most cases, it is
recommended to keep the emulator in 'AUTO' mode. You should note that it is
not recommended to call Tape Manager while loading with non-standard
routines, and especially to not change the algorithm while loading. This may
cause incorrect loading. However, you can call the monitor even while
loading. Calling the environment using F10 while loading will nearly always
cause incorrect loading when you go back to the emulator. During loading from
a real tape, pressing any function key will surely cause a loading error.


2.5.   THE EMULATION OF THE MICRODRIVE
       ===============================

       Principally, microdrive emulation needs less description than the tape
system emulation. The emulator uses files with extension .MDR (we call them
cartridges) for emulation of real microdrive cartridges. The user can select
these files using the 'MdriveFiles' menu in the environment (see chapter
3.4.). MDR files need not have fixed length (this is not case in Lunter's
emulator). Their length may vary from 10 to 254 sectors, and if you select
254 sectors length, our MDR files will be compatible with the format of
Lunter's emulator. If you get the message 'Microdrive not present' when you
try to use the microdrive even though you selected a cartridge file, it means
that cartridge is not formatted. It may be formatted using the FORMAT command
from BASIC, or using 'Format' option from the 'Microdrive' submenu of the
menu 'MdriveFiles'. This is all you need to know about microdrive emulation
if you know about working with a real microdrive. The MDR file format is
given in the technical part of the manual.

       The Microdrive is emulated on an I/O level and so is very realistic,
even more so than Lunter's program. Nearly all programs will work, and some
unusual effects (which work on a real Spectrum) will work too. You can try
this from BASIC to see these effects:

  OUT 239,238: OUT 239,236

This will start the microdrive "motor" without other harmful effects. You can
see that the disc lamp indicator will flash, and the emulator will continue
working normally.

  10 OUT 239,238: OUT 239,236
  20 POKE 23692,255: PRINT IN 231;" ": GO TO 20

This program will start the microdrive "motor" and will display the bytes
read using "moving microdrive reading head" (this effect will not work on
Lunter's program).

  OUT 239,0

This will start the microdrive "motor", but also the "microdrive erasing
head". After a few seconds all the cartridge will be erased. Only this effect
of these three effects mentioned will work on Lunter's emulator. Of course,
these features are not very useful, but they illustrate the degree of
accuracy.

       Microdrive emulation is very fast, typically much faster than on a real
Spectrum. Of course, file access time is shorter on shorter cartridges.
However, some operations which use intensive ROM switching (for example,
MOVE) may be much slower than on an original machine.


2.6.   THE EMULATION OF SINCLAIR NETWORK
       =================================

       This emulation is one very exotic thing, which we wanted to implement
long ago, to round off all the ideas from the legendary Clive Sinclair
(Sinclair Network itself also has a rather exotic implementation). At this
moment, only the Warajevo emulator tries to emulate this. Such emulation (at
I/O level) is technically very hard to implement, because the real Sinclair
Network is essentially based on the data-link layer of the transfer protocol.
We can not have network control on a PC using such a low level technique (due
to the number of different network cards, different transfer media and
different transfer protocols), so we perform emulation using a shared file,
which is a method which belongs to the session layer of the transfer protocol
(if you don't understand what we are talking about, read any book about
ISO-OSI network referent model). Using this, we achieve total independence of
a specific kind of network card, transfer protocol (Novel, IPX, TCP-IP etc.),
transfer medium (LAN, modem) etc. Some people may think that this is
emulation of a bicycle using a helicopter, but we say that emulation works,
but not in such a way that we would like. Emulation is still slow and a bit
unreliable (although it works quite well with the transfer of short
messages), and sometimes needs tedious adjusting of some parameters before
communication begins to work. With some effort, it is possible to make
communication between two emulators even through the Internet!

       To try and adjust the network emulation, find a shared drive and
directory that all emulators which want to communicate have access to (for
example, let it be G:\SHARED). This directory must allow full rights (both
reading and writing) to all net users (such rights you must seek from your
network administrator, if you don't have them). If you don't know about
working with PC networks, chapter 7.13. describes how to perform this task.
If you haven't got a network, you may try emulation with two emulators under
a multitasking operating system (for example, Windows 95) in CGA mode.
Suppose the shared file for package transfer has the name TRANSFER.NET (this
name can be any valid filename). Set the emulators correctly, using the
command line option /#N;G:\SHARED\TRANSFER.NET or using the environment (see
the description of the option /#N). On the receiving emulator type and run
following BASIC program (we assume that you know something about the syntax
and meaning of BASIC commands which use the Sinclair Network if you decided
to read this chapter):

  10 FORMAT "n";2
  20 OPEN #4;"n";3
  30 INPUT #4;a$
  40 CLOSE #4
  50 PRINT a$

On the sending emulator type and run a similar program:

  10 FORMAT "n";3
  20 OPEN #4;"n";2
  30 PRINT #4;"Hello from net!"
  40 CLOSE #4

On the receiving emulator, you will get the message "Hello from net!" very
quickly, if everything is OK. But, if this doesn't happen, stop both
programs using the BREAK key, and try changing the parameters <block_delay>,
<free_len> and <busy_len>, where <block_delay> has the greatest influence
(try, for example, to increase this parameter to 60 or more, using
/#N;G:\SHARED\TRANSFER.NET;60 or using the environment). Be aware of the fact
that increasing this parameter slows down transfer speed, but increases the
chance of a successful transfer. With greater values of this parameter, it is
possible that the emulator may take about 10 seconds to recognise the
pressing of the BREAK key or a function key (be patient). It is not
recommended (if not necessary) to set <block_delay> to a value above 350,
else you can totally lock the emulator. Principally, <block_delay> should
take the minimum value which allows correct emulation on your configuration.
Parameters <free_len> and <busy_len> have a greater range (say, from 2 to
20000). For exact meaning of these parameters, see the technical part of the
manual.

       From experience, we discovered that the emulation works considerably
better if you run the receiver program before running the sender program,
than the other way around. If you try network emulation with 2 emulators on
the same computer under MS Windows (this is not very reliable), you will get
better results when the sender program is in foreground, and receiver program
is in the background, than vice versa.

       Network emulation works fine when only short packages (10-100 bytes)
are interchanged, so you can make a program (or adapt an existing one) for
playing a logical game (why not chess if you are feeling ambitious) using 2
emulators through the network. When greater packages are used, problems with
the network emulation become greater. For example, the BASIC commands SAVE*
and LOAD* perform transfers using 255-byte packages (this is also the
greatest package length on the Sinclair Network). Try, for example, to type
on receiving emulator the command

  FORMAT "n";2: LOAD *"n";3SCREEN$

and on sending emulator something like:

  FORMAT "n";3: SAVE *"n";2CODE 0,6912

Maybe this transfer will need a greater value of <block_delay> parameter than
when only short messages are transferred, but in every case the transfer will
be rather slow (by the way, the real Sinclair Network was incredibly fast,
regardless of the silly implementation), so whenever possible, transferring
of short packages (using combination OPEN#/PRINT#/CLOSE#) is recommended.
Summarily: the network emulation works, but to point to which it can to fully
satisfy us has still not been achieved. At the moment, broadcasting (e.g.
sending simultaneously to all stations, and receiving from an unspecified
station, which can be achieved in BASIC using 0 as station number) still does
not work, and some machine routines which use the Sinclair Network (for
example, the game TT Racer) don't work either. Maybe these things (and better
efficiency too) will be implemented in some future release of the emulator.
For more details about network emulation, read the chapter about it in the
technical part of the manual.


2.7.   THE EMULATION OF THE MIDI INTERFACE
       ===================================

       This is another exotic thing which is also implemented only in Warajevo
emulator (but it works very good, in opposite to network emulation). It is
known that Spectrum 128 has built-in one-way MIDI interface (output only).
This feature is now implemented also in the emulator. To try this, you must
have Sound Blaster compatible sound card (it is important to say that we use
General MIDI standard, not MPU-401 standard) and, of course, MIDI compatible
music instrument. So, connect your synthesizer with PC (using Sound Blaster),
run Spectrum 128 emulator using switch /SB, and type the following command in
128 Basic:

  PLAY "Y1 cdefgabC"

Your synthesizer will play C-major scale. If you don't want simultaneous sound
on Sound Blaster speaker too, try the command:

  PLAY "","","","Y1 cdefgabC"

If nothing happens, check whether your instrument is in MIDI mode, and whether
MIDI receiving channel is set to 1 (subcommand Y in PLAY command determines
MIDI receiving channel which will be used). For full syntax and meaning of the
PLAY command, and for other details, read Spectrum 128 manual, and eventually,
manual of your music instrument. We want more to say that on the most of the
today music synthesizers tone color (e.g. simulated instrument) may be changed
using command:

  PLAY "Y1 Z192 Z5"

where number after second Z subcommand (5 in this example) determines tone
color (in range which is instrument dependent).

2.8.   THE EMULATION OF TIMEX SINCLAIR 2068 PARTICULARITIES
       ====================================================

       The Timex Sinclair 2068 computer and the ordinary ZX Spectrum 48K are
different in some details: the Timex has a built-in AY sound chip (like the
Spectrum 128K), two ATARI joystick connectors, changed timing of picture
generation (so interrupts occur 60 times per second), extended video modes,
essentially different and expanded ROM (24K) which also contains some new
BASIC commands, and a memory bank switching system which allows various ROM
and RAM expansions.

       The sound chip and joystick connectors are supported with the BASIC
statements SOUND and STICK. They are implemented in the emulator, and we can
not tell you anything special about them. On extended video modes the Timex,
in addition to the classic video mode (256x192 pixels with 8x8 pixels color
attributes), possesses a multicolor video mode (256x192 pixels with 1x8
pixels color attributes, every byte has own color attribute), and extended
resolution mode (512x192 pixels in two colors). Also, it is possible to
relocate the video memory in the standard video mode from address 16384 to
address 24576. All of these features are emulated in the Warajevo emulator
(only on the VGA card, these days this is not a great loss). Unfortunately,
these modes are not supported by BASIC commands, so you can try them only if
you have some Timex software which uses these features. If you don't have
such software, you can make one rough test by giving BASIC command OUT 255,6.
This will switch on extended resolution mode (you will get trash on the
screen, because standard BASIC does not support this mode). You can switch
back to normal mode using OUT 255,0. Multicolor mode may be turned on using
OUT 255,3 (in this case, switching back to normal mode using OUT 255,0 must
be performed without seeing what you type on screen). You can read more about
extra video modes in the technical part of the manual.

       The Timex's system of memory bankswitching is also implemented in the
Warajevo emulator. It supports three internal 64 Kb memory banks called HOME,
EXROM and DOCK. The HOME bank contains 16 Kb ROM (called HOME ROM) at
addresses 0-16383, and the rest of the 48 Kb is filled with RAM. The EXROM
bank initially contains only 8 Kb ROM (called EXROM ROM). This ROM is not
fully decoded, so its image repeats itself 8 times (e.g. at addresses 0-8191,
8192-16383, 16384-24575 and so on). The DOCK bank is initially empty and
connected via pull-up resistor (so reading from it will give #FF). Its
purpose is memory expansions (ROM or RAM) using cartridges which you can plug
into the cartridge dock on Timex computer. Although the EXROM bank is not
designed for expansions, cartridges exist which are mapped into this bank.

       ROM extensions mapped into the DOCK bank are mostly implemented as
so-called LROS (Language ROM Oriented Software) and AROS (Application ROM
Oriented Software). LROS programs are mapped at address 0 in the DOCK bank
and they must be written in machine code. AROS programs are mapped at address
32768 in the DOCK bank, and may be either in machine code or in BASIC (The
Timex BASIC interpreter allows the running of BASIC programs from the DOCK
bank). LROS programs always have autorun and they will be started after
initialization of the Timex computer is finished (an example of such software
is Zebra OS_64). AROS programs may be or may not to be autorun programs. Both
type of programs have a short header at the beginning which contains the
necessary informations (start address etc.) for their execution. The Warajevo
emulator introduces special DCK files which keep content and configuration of
DOCK and EXROM memory banks, so it allows emulation of various ROM/RAM
expansions, LROS and AROS programs. The contents of these banks are not keep
in snapshot files, due to more flexibility (such organization allows running
the same snapshot in different Timex configurations). You can read more about
the structure of DCK files in chapter 7.9.4. In the environment, some useful
options for manipulating DCK files are implemented (see chapter 3.5.).

       In addition to that mentioned above, the Timex version of the Warajevo
emulator also emulates the TS2040 printer (similar to the ZX printer), and
AERCO parallel printer interface.


2.9.   THE SYNTAX OF ZX BASIC
       ======================

       For those who forgot it we give here a short overview of the syntax of
the Spectrum BASIC, in the usual form (simplified Backus-Nauer form):

x, y, z ...    represent numerical expressions
x$, y$ ...     represent alphanumeric expressions
m, n, p ...    represent numerical expressions which are rounded to the
               nearest integer
v, v1, v2 ...  represent numerical variable names
‡, ·, ...      represent a single letters ('a'..'z' or 'A'..'Z')
c              represent any character
d              represent a single digit (0..9)
b              represent any BASIC command

[A]            means 'A can be omitted'
{A|B|C}        means 'A or B or C'
[A...]         means 'A can be omitted or repeated many times'

Statements:

BEEP x,y
BORDER m
BRIGHT m
CAT
CIRCLE [{BRIGHT m|FLASH m|INK m|INVERSE m|PAPER m|OVER m}{;|,}...]x,y,z
CLEAR [m]
CLOSE #m
CLS
CONTINUE
COPY
DATA {x|x$}[,{y|y$}...]
DEF FN {‡([·[$][,Á[$]...]])=x|‡$([·[$][,Á[$]...]])=x$}
DIM ‡[$](m[,n ...])
DRAW [{BRIGHT m|FLASH m|INK m|INVERSE m|PAPER m|OVER m}{;|,}...]x,y[,z]
ERASE x$
FLASH m
FOR ‡=x TO y STEP z
FORMAT x$
GO SUB m
GO TO m
IF x THEN b
INPUT {x|x$|#m|AT m,n|BRIGHT m|FLASH m|INK m|INVERSE m|LINE ‡$[([m[,n...]][,
    [p] TO [q]])][([[r][ TO [s]]])...]|PAPER m|TAB m|OVER m}[{;|,|'}{y|y$|#p|
    AT p,q|BRIGHT p|FLASH p|INK p|INVERSE p|LINE ·$[([i[,j...]][,[k] TO
    [l]])][([[t][ TO [u]]])...]|PAPER p|TAB p|OVER p}...}
INVERSE m
LET {{v|‡(m[,n...])}=x|‡$[([m[,n...]][,[p] TO [q]])][([[r][ TO [s]]])...]=x$}
LIST {#m[,n]|[n]}
LLIST {#m[,n]|[n]}
LOAD x$[{CODE [m[,n]]|DATA ‡[$]()|SCREEN$}]
LPRINT {|x|x$|#m|AT m,n|BRIGHT m|FLASH m|INK m|INVERSE m|PAPER m|TAB m|OVER m}
    [{;|,|'}{|y|y$|#p|AT p,q|BRIGHT p|FLASH p|INK p|INVERSE p|PAPER p|TAB p|
    OVER p}...]
MERGE x$
MOVE x$,y$
NEW
NEXT ‡
OPEN #m,x$
OUT m,n
OVER m
PAPER m
PAUSE m
PLOT [{BRIGHT m|FLASH m|INK m|INVERSE m|PAPER m|OVER m}{;|,}...]x,y
POKE m,n
PRINT {|x|x$|#m|AT m,n|BRIGHT m|FLASH m|INK m|INVERSE m|PAPER m|TAB m|OVER m}
    [{;|,|'}{|y|y$|#p|AT p,q|BRIGHT p|FLASH p|INK p|INVERSE p|PAPER p|TAB p|
    OVER p}...]
RANDOMIZE [n]
READ {v1|‡(m[,n...])|‡$[([m[,n...]][,[p] TO [q]])][([[r][ TO [s]]])...]}[,{v2|
    ·(p[,q...])|·$[([i[,j...]][,[k] TO [l]])][([[t][ TO [u]]])...]}...]
REM [c...]
RESTORE [m]
RETURN
SAVE x$[{CODE m,n|DATA ‡[$]()|LINE m|SCREEN$}]
STOP
VERIFY x$[{CODE [m[,n]]|DATA ‡[$]()|SCREEN$}]

ZX Interface 1 statement extensions:

CAT [#m{,|;}]n
CLEAR #
CLS #
ERASE x${,|;}m{,|;}y$
FORMAT x${,|;}m[{,|;}y$]
LOAD *x$[{,|;}m[{,|;}y$]][{CODE [m[,n]]|DATA ‡[$]()|SCREEN$}]
MERGE *x$[{,|;}m[{,|;}y$]]
MOVE {#m|x$[{,|;}n[{,|;}y$]]} TO {#p|z$[{,|;}q[{,|;}r$]]}
OPEN #m{,|;}x$[{,|;}n[{,|;}y$]]
SAVE *x$[{,|;}m[{,|;}y$]][{CODE n,p|DATA ‡[$]()|LINE q|SCREEN$}]
VERIFY *x$[{,|;}m[{,|;}y$]][{CODE [m[,n]]|DATA ‡[$]()|SCREEN$}]

'128 Basic' extensions:

CAT !
ERASE !x$
FORMAT x$;m
LOAD !x$[{CODE [m[,n]]|DATA ‡[$]()|SCREEN$}]
MERGE !x$
PLAY x$[,y$[,z$,[r$[,s$[,t$,[u$,[w$]]]]]]]]
SAVE !x$ [{CODE m,n|DATA ‡[$]()|LINE m|SCREEN$}]
SPECTRUM
VERIFY !x$[{CODE [m[,n]]|DATA ‡[$]()|SCREEN$}]          (but this is a bug)

The '128 Basic' no longer accepts some incomplete syntax forms accepted by
'48 Basic' for CAT, ERASE x$ and FORMAT x$.

Timex Sinclair 2068 statement extensions:

CAT x$,[c...]
DELETE [m],[n]
ERASE x$,[c...]
FORMAT x$,[c...]
LOAD *x$,[c...]
MERGE *x$,[c...]
MOVE x$,[c...]
ON ERR {GOTO x|CONTINUE|RESET}
OPEN #m,x$,[c...]
SAVE *x$,[c...]
SOUND m,n[;p,q...]
RESET [{*|#n}]
VERIFY *x$,[c...]

TS2068 basic also doesn't accept incomplete syntax forms for ERASE x$,
FORMAT x$, CAT and MOVE x$,y$.

'+3 Basic' extensions (not yet implemented into the emulation):

CAT {#m[,x$]|[x$]}[EXP]
COPY [{EXP [INVERSE]|x$ TO {y$|SCREEN$|LPRINT|SPECTRUM FORMAT}}]
FORMAT {x$|LINE m|LPRINT x$[;y$]}
MOVE x$ TO y$
PLAY x$[,y$[,z$,[r$[,s$[,t$,[u$,[w$]]]]]]]]
SPECTRUM

The '+3 Basic' doesn't accept '128 Basic' extensions (except the commands
PLAY and SPECTRUM, because there is another method for other 128-like
commands) nor ZX Interface 1 extensions, and no longer accepts wrong syntax
form accepted by '48 Basic' MOVE x$,y$. That's why in '+3 Basic' some
commands like LOAD, CAT, MOVE, COPY etc. have meaning which is strongly
dependent on the content of their string arguments.

The numerical expressions (in all Basic forms) have the following form:

<number>                               BIN [{0|1}...]
x+y                                    CODE x$
x-y                                    COS x
x*y                                    EXP x
x/y                                    FN ‡([·[$][,Á[$]...]])
x^y                                    IN m
+x                                     INT x
-x                                     LEN x$
(x)                                    LN x
{x=y|x$=y$}                            NOT x
{x>y|x$>y$}                            x OR y
{x<y|x$<y$}                            PEEK m
{x<=y|x$<=y$}                          PI
{x>=y|x$>=y$}                          POINT (m,n)
{x<>y|x$<>y$}                          RND
v                                      SGN x
‡(m[,n...])                            SIN x
ABS x                                  SQR x
ACS x                                  TAN x
x AND y                                USR {x|x$}
ASN x                                  VAL x$
ATTR (m,n)

The Timex Sinclair 2068 also introduces two new numerical functions:

STICK (m,n)                            FREE

The alphanumeric expressions have the following form:

"[c...]"                               CHR$ m
x$+y$                                  INKEY$[#m]
(x$)                                   SCREEN$ (m,n)
x$([[m][ TO [n]]])                     STR$ x
‡$[([m[,n...]][,[p] TO [q]])]          VAL$ x$
x$ AND x

The numbers have the form d[d...][.[d...]][{E|e}[{+|-}]d[d...]], and a
numerical variable names have the form ‡[{·|d|_}...].


2.10.  EMULATOR ERROR MESSAGES
       =======================

       Sometimes the emulator interrupts work (or don't even start working)
with the reporting of some errors. This chapter describes these events.

"Program finish at address #nnnn"

       Normal finish of the program (pressing Shift+F10, Ctrl+F10 or Alt+F4).
The hexadecimal address of the instruction which was interrupted is written.
If this occurred in Shadow ROM (e.g. ROM of ZX Interface 1) the text
'(Shadow ROM)' is displayed too. On the 128 version, if the stopping occurred
in ROM, '(Standard ROM)' or '(Derby ROM)' will be displayed, depending on the
currently active ROM. If the stopping occurred on an address greater than
49152, after the address will be also written the active bank of RAM like
'(RAM page n)'. On the Timex version of the emulator, after the address will
be displayed '(HOME)', '(EXROM)' or '(DOCK)', depending on the currently
active memory bank.

"Error loading CFG file"

       The instruction /C was given, but the emulator cannot load a file
'SPECSIM.CFG' for some reason (most probably because it doesn't exist in
the current directory, or in the directory which was set using the DOS
environment variable WARAJEVO).

"Invalid command line parameter"

       An invalid command option was given (directly, or in the file
'SPECSIM.CFG'), or an existing option has a wrong parameter.

"Invalid tape name or tape error"

       For some reason the name after the option /T is incorrect. Most
probably the name was omitted completely, or the extension was different from
'.TAP'. Also, it may be that tape creation was not successful.

"Invalid drive or directory"

       The option /D, for some reason, has not done its task. Most probably
the directory was nonexistant.

"File ZX48.ROM not found"

       The 48 version of the emulator was started, and the file 'ZX48.ROM'
was not found in the current directory.

"The file ZX128_0.ROM or ZX128_1.ROM not found"

       The 128 version of the emulator, without option /2 was started, and
one of the files 'ZX128_0.ROM' or 'ZX128_1.ROM' was not found in the current
directory.

"The file ZXP2_0.ROM or ZXP2_1.ROM not found"

       The 128 version of the emulator, with option /2, was started, and one
of the files 'ZXP2_0.ROM' or 'ZXP2_1.ROM' was not found in the current
directory.

"The file TS2068_H.ROM not found"

       The Timex version of the emulator was started, and the file
'TS2068_H.ROM' was not found in the current directory.

"The file TS2068_X.ROM not found"

       The Timex version of the emulator was started, and the file
'TS2068_X.ROM' was not found in the current directory.

"File ZXI1.ROM not found"

       The emulator was started with option /E, and the file 'ZXI1.ROM' was
not found in the current directory.

"Cannot open snapshot file"

       For some reason, the loading of the snapshot file using command /R
failed. Most probably, something is wrong with your snapshot file name, or
the snapshot file with this name doesn't exist.

"Incorrect snapshot file"

       The snapshot file was found, but it's format was wrong. Most probably,
this is a file which was not created with 'Warajevo' nor Lunter's 'Z80'
emulator up to release 3.03. This message will also be displayed when you try
to load snapshot files which keep content of the ROMs, like snapshots created
using the emulator by Pedro M. R. Salas. In such cases, the solution is to
use the option 'Any Z80 -> 128K without Interface 1' which is described in
chapter 3.3.3.

"Incorrect hardware version"

       Most probably, this error occurs when loading a 128K snapshot file in
the 48K or Timex version of the emulator, or loading a Timex snapshot file in
the 48K or 128K version. Also, this error occurs if the snapshot file has the
ZX interface 1 activated, but the file 'ZXI1.ROM' is not present, or when
trying to load Lunter's snapshot files with SamRam or Multiface 128
activated. In these cases, the solution is the same as in previous case.

"Can not work on 8086/8088"

       This emulator requires at least an '80286' processor for work.

"Invalid graphic card"

       There is no graphic card that was detected as a CGA, Hercules, EGA,
EGA Mono or VGA card.

"Extended graphic modes need EGA/VGA at address #nnnn"

       Extended graphic modes on the Timex version of the emulator are
implemented only on EGA and VGA graphic cards.


"Program use 128 ports at address #nnnn"

       This error message occurs when the option /?128 is active, and a
program tries to write some data to any Spectrum 128 port. The address will
be displayed in the same way as with "Program finish at address #nnnn".

"Escape sequence detected at address #nnnn"

       This error message occurs when the option /?86 is active, and the
emulator detects the presence of 'Escape' sequences which patch 80x86 machine
code in Z80 code (for details, see chapter 5.2.). The address will be
displayed in the same way as with "Program finish at address #nnnn".

"Cannot open cartridge file"

       For some reason, loading of the cartridge file using command /# failed.
Most probably, something is wrong with the filename, or the filename doesn't
exist.

"Cartridge file too long or short"

       Cartridge files may have anything from 9 to 254 sectors, so acceptable
file lengths are between 4887 and 138465 bytes.

"Cannot open net file"

       For some reason, creating or opening the interface file for network
interchanging was not successful.

"Error loading DCK file"

       For some reason, the loading of DCK file using command /E failed. Most
probably, something is wrong with the filename, or the filename doesn't
exist.

"Requested bank number not implemented"

       DCK file contains the bank number which is not implemented. At this
time, all standard banks HOME, EXROM and DOCK are implemented, but banks
which correspond to various independent memory expansions out of standard
banks (for example, expansion to 1 MB) are not implemented.

"Sound Blaster card cannot be detected"

       The option /SB (without additional arguments) was given, but the
emulator did not successfully detect a Sound Blaster compatible sound card.

"Obsolete command option"

       Some command options which were frequently used in earlier releases of
the emulator (like /I and /W), are now obsolete, and there is no need for
their usage. This report will be shown if you try to run emulator with an
obsolete options.

"Error loading environment"

       For some reason, the loading of the environment when pressing F10
failed. Most probably, the file WARAJEVO.EXE wasn't found.

"Unexpected wrapping at address #nnnn"

       The '80286' processor and its younger brothers 'do not know' to put a
16-bit number to the address with offset #FFFF, and in this case they execute
INT 0DH. The emulator traps this interrupt and tries some actions to solve
the problem. We think that we've solved all cases, however this report is
kept for a case of the unexpected interrupt 0DH. If this report occurs, this
most probably indicates existence of a bug in the emulator. The address when
the problem happened is displayed in the same way as with "Program finish at
address #nnnn". In the case of this report, please inform us under which
circumstances and with which program it occurred.

       There is also a possibility for this report to occur without a bug in
the emulator if you used so-called Escape sequences to switch to 80x86 mode
of the emulator, and if you used some 80x86 instruction which puts a 16-bit
value in address #FFFF. For an explanation about Escape sequences see chapter
5.2.

"CS must not be changed"

       Only very advanced users can see this report. It will appear if you
use Escape sequences, and you try to go back to normal emulation mode when
the code segment is different when compared with the emulator segment (e.g.
the segment in which Escape sequence was called). For an explanation about
Escape sequences see chapter 5.2.


3.     THE ENVIRONMENT OF THE WARAJEVO EMULATOR
       ========================================

       The environment of the emulator was introduced in the release 1.5. It
was created because many users said that using the emulator with command
switches was too complicated, and that working with Lunter's emulator was
much easier. The most important remark was the impossibility of loading and
saving snapshot files using menus directly from the emulator. The environment
was first developed to solve these problems. During development, an idea
occurred to us that we could also integrate the programs ZXTOOLS and ZXSHELL
(which were present until release 1.2. of the emulator) together with the
environment in one compact logical unit. That's how the environment got to
the stage that it is today (it is written in Turbo Pascal).

       The environment needs a hard disc. Principally, even a floppy disc is
sufficient, but the program has many overlay modules, so when you work with
the environment, the file WARAJEVO.EXE must be accessible the whole time, and
it may be impractical and slow on floppy disc.

       The environment may be called directly from DOS (by running the
program WARAJEVO), or from the emulator (by pressing F10, or using the right
mouse button). The emulator and the environment are split into two programs
only due to memory requests, but they act like one program, so you can not
see this splitting. More precisely, the emulator calls the environment from
the disc, and the environment calls the emulator from the disc when one part
needs other part (the calling method is CHAIN, not EXEC, due to better memory
management, if this fact makes any sense to you).

       If you call the environment from the emulator (pressing F10), the
exact sequence of events will be as follows (you may skip this part if it is
too complicated for you, or if it is not interesting for you):

- The whole Spectrum memory image, values of processor registers and states
  of emulated I/O devices will be saved in the snapshot file TEMP.Z80 in the
  directory which contains the emulator itself (this default directory may be
  changed by changing the variable WARAJEVO from the DOS environment; we will
  explain this later);
- On the Timex version of the emulator, when memory expansions are present
  their state will be saved in the file TEMP.DCK (in the directory which
  contains the emulator itself, or in the directory determined using the DOS
  environment variable WARAJEVO).
- The state of all the command parameters, data about current tape file etc.
  will be saved in the ASCII file SPECSIM.CFG (also in the directory which
  contains the emulator itself, or in the directory determined using the DOS
  environment variable WARAJEVO). The file TEMP.Z80 will be marked to be a
  current snapshot file, and on the Timex version the file TEMP.DCK will be
  marked to be a current DCK file (commands /RTEMP and maybe /ETEMP will be
  stored into SPECSIM.CFG).
- Now the emulator calls the environment with the command /C, e.g.
  WARAJEVO /C. This means that the environment must accept parameters from
  the file SPECSIM.CFG (see chapter 3.11.). This file contains also the
  command /RTEMP, so it will be a message to the environment to take into
  account the content of the snapshot file TEMP.Z80 and it will become the
  active snapshot file.

All these operation last about 1-2 seconds.

  Calling the emulator from the environment will cause the following events:

- The state of all the options which are set up using the environment will be
  saved into the file SPECSIM.CFG. If the active snapshot file is marked,
  the file SPECSIM.CFG will contain a parameter /R<name> too. It will be
  /RTEMP if you called environment from the emulator and you didn't change
  name of the active snapshot file.
- The emulation type (48K, 128K or Timex) will be determined. This will be
  automatically determined in accordance with the content of the active
  snapshot file (if it is a 48K snapshot file, the emulation type will be
  48K emulation etc.). If the active snapshot file is not marked, the
  emulation type will be determined according to the option 'Emulator' in the
  menu 'Setup', or according to the command parameter /&E.
- Now the environment calls the emulator using the command /C (e.g.
  SPEC48 /C or SPEC128 /C according to the last step). If the active snapshot
  file exists it will be loaded (due to the command /R in the SPECSIM.CFG
  file), else a 'pure' emulator will be started.

       As you can see, if you call the environment from the emulator, and if
you don't make any changes while you are in the environment, after you go
back to the emulator it will continue normally. So, you may look at the
environment as the emulator's 'main menu', not as a different program!

       If you start the environment directly from DOS, it will first check
whether the file with the name DEFAULT.CFG exists. If it exists, all the
initial values for the command parameters (see chapter 2.1.) will be picked
from this file. For example, if you want to work on a 486 machine with a VGA
card, sound card, analogue joystick, if you want high-quality border
emulation but don't want a warning on 386 virtual mode, and finally if you
use COM1 serial port at 2400 Baud, put the following parameters into the
DEFAULT.CFG file:

/SA /U5 /JA /! /&C1 /&S6

The file DEFAULT.CFG is a simple ASCII file with parameters separated by
spaces or newlines. Obviously, the file DEFAULT.CFG acts like SPECSIM.CFG,
but DEFAULT.CFG has global scope. The environment reads this file only when
you first start the environment (and only when you start environment directly
from the operating system). The file SPECSIM.CFG will automatically be
created on every emulator-environment call and vice versa, so it has local
scope (it's use is intended mostly for the interchanging of necessary
informations between the emulator and the environment, but DEFAULT.CFG acts
like the main configuration file). If you start the environment with the
parameter /C (e.g. WARAJEVO /C) the command parameters will be read from the
file SPECSIM.CFG instead from DEFAULT.CFG (this is implemented mainly for
internal purposes).

       If you want, for any reason, to change the directory in which the
temporary files SPECSIM.CFG, TEMP.Z80 and TEMP.DCK will be stored, and also
to change the directory from which the file DEFAULT.CFG will be read, set the
DOS variable WARAJEVO to the full path (including the drive) of the desired
temporary directory using the DOS command SET WARAJEVO=<path>, for example,
SET WARAJEVO=C:\TEMPDIR (the best place to do it is in the file
AUTOEXEC.BAT). This, and other options, allow the running of the emulator
directly from a CD ROM. WARAJEVO also has a function for determining whether
the environment will use graphical or text mode (this will be described in
next chapter), so the full syntax for setting the DOS environment variable
WARAJEVO is:

SET WARAJEVO=[G|T] [path]


3.1.   BASIC ELEMENTS OF THE ENVIRONMENT
       =================================

       The environment may be called directly from DOS, or from the emulator
itself by pressing F10 (or clicking the right mouse button). Starting from
release 2.0, the environment may work in a graphics mode too when using an
EGA or a VGA card, and this produces more professional looking results (but
works slower, and needs more computer resources). To get it working in
graphics mode, set the variable WARAJEVO in the DOS environment to G using
command SET WARAJEVO=G (for example, in the file AUTOEXEC.BAT). This option
may be combined with setting the directory for temporary files, so you may
use settings like SET WARAJEVO=G C:\TEMPDIR.

       After you enter the environment, on the topmost line of the
environment screen a main menu appears. You can access the menu options using
one of the 3 following ways:

- Press Ctrl+F10, then use left and right cursor keys to move through menu;
- Press Alt and the first letter of the menu option;
- Move the mouse pointer to the option name then click the left button.

       The bottommost line of the screen contains a (incomplete) list of
shortcut keys, and the 'Start' button (like Windows 95). You can also select
them using the mouse. The decimal number in the corner is the amount of free
RAM in bytes. In the middle of the screen there is a window with the current
filenames and current status parameter settings. If you start the environment
in graphics mode, a window showing the content of the screen in the emulator
will also be shown. Double clicking this window will start the emulator.

       Pressing F1 will open the HELP window. Help is topic sensitive, e.g.
you will always get help which is related to your current job. If there are
highlighted words or phrases in the help window, this means that you can get
additional help about these topics. You can select a topic using the keys Tab
and Shift+Tab, or by moving the mouse pointer to the topic and then double
clicking. The help file is detailed, sometimes more detailed than this
manual, so read the help file when you have problems!

       This picture represents the general look of one window (the picture is
not exactly the same as in the program, because characters with codes less
than 32 aew removed, to prevent problems with printing this document on a
printer):

                      Close icon
                       ≥    Title ⁄ƒ Top frame line
                       ≥      ≥   ≥   ⁄ƒƒƒƒƒƒ Zoom icon
                    …Õ[˛]ÕÕÕTitleÕÕÕÕ[Ô]Õª
                    ∫                    ∫
                    ∫  Working area of   Ô
                    ∫    the window      ˛
                    ∫                    ±  Vertical scrollbar
                    ∫                    ±         ≥
                    ∫                    ± <ƒƒƒƒƒƒƒŸ
                    ∫                    ±
                    ∫                    V
                    »ÕÆ±±±±±˛±±±±±±±±±±ØƒŸ <ƒƒ Resize corner
                            ≥
                  Horizontal scrollbar

The window can be shown without some of these elements.

       Clicking the mouse button on the close icon will close the window. The
same effect can be achieved by using ALT+F4 (as in MS Windows).

       Clicking on the top frame line changes the frame shape, and while you
hold the mouse button, you can move the window to a new position. Without the
mouse, the same effect is possible by pressing CTRL+F5 then using the arrow
keys. Press ENTER when finished.

       If you press the mouse button on the Zoom icon, the window will be
resized to fit the whole screen. Press here again, and the window size will
be restored. The same effect can be achieved using ALT+F5.

       Clicking the mouse on the resize corner of the window will start
resizing. While you hold the mouse button, you can move the mouse pointer to
define the new dimension. The same effect is possible by pressing CTRL+F5,
and defining the new size using SHIFT with the arrow keys. Press ENTER when
finished.

       The vertical scrollbar is used for changing the text position in a
window:

         Ô   Top arrow
         ±   Above pointer
         ±
         ˛   Pointer
         ±   Below pointer
         ±
         V   Bottom arrow

       Clicking the mouse button on the top and bottom arrows moves the
pointer up and down respectively. The keys Up and Down have same effect.
Clicking the part of the scroll bar above the pointer will move the pointer
one page up, like PgUp. It is similar with the part below the pointer.
Dragging the pointer using the mouse is a faster way to move it to the
desired position.

       The horizontal scrollbar is also used for changing the text position
in a window, but also to display the progress of some long job:

                             Æ±±±±±±±±˛±±±±±±±±Ø
                             ≥     ≥  ≥    ≥   ≥
            Left arrow ƒƒƒƒƒƒŸ     ≥  ≥    ≥   ≥
            Left of pointer ƒƒƒƒƒƒƒŸ  ≥    ≥   ≥
            Pointer ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ    ≥   ≥
            Right of pointer ƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ   ≥
            Right arrow ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ

       Clicking the mouse button on the left and right arrows moves the
pointer to left and right respectively. The Left and Right keys have the same
effect. Clicking on the part of the scroll bar, which is on the left of the
pointer, moves the pointer one page left. The same effect as the key
combination Ctrl+Left. It is similar with the part to the right of the
pointer. It is possible to drag the pointer using a mouse too.

       Dialogs are special forms of windows. When you work with a dialog, you
cannot access options from the main menu. The dialog window usually has many
items such as list boxes, the 'OK' and 'Cancel' buttons, input lines, radio
buttons, checkboxes, static text etc. One of the items is focused and it is
called the active item. You can move through the items using TAB and
SHIFT+TAB. If you have a mouse, you can directly access the items by moving
the mouse pointer to the desired item and then by pressing the mouse button.
If the item has a highlighted first letter, you can press ALT with this
letter to reach it.

       Selecting the 'OK' button will usually start the desired operation.
Selecting the 'Cancel' button or pressing ESC will cancel changes and return
us to the main menu.

       Radio buttons (˘) are used for selecting one of few possible states.
You can select any of these options using the arrow keys (or by pressing the
ALT key with the highlighted letter). Checkboxes [X] are used for activating
or deactivating some switch-type options, and their usage is similar. You can
activate or deactivate a checkbox by using the SPACE key or a mouse.

       The following picture represents the general look of one list box:

              .........................
              :   Line 1              Ô
              :   Line 2              ˛
              :   Line 3              ±  Vertical scrollbar
              :   Line 4              ±         ≥
              :                       ± <ƒƒƒƒƒƒƒŸ
              :                       ±
              :                       V
              :..Æ±±±±±˛±±±±±±±±±±Ø...:
                       ≥
                Horizontal scrollbar

       List boxes are used for selecting files names, blocks in TAP files, or
for viewing some data. One element is highlighted. You can move the highlight
in the list box using the arrow keys, PgUp, PgDn, Home, End (with the usual
meaning), Ctrl+PgUp (move to top of the list) and Ctrl+PgEnd (move to the
bottom of the list). Faster access to any element of the list can be got by
pressing a mouse button, or using the scroll bars. For some commands you must
select the highlighted item by pressing SPACE, ENTER or by double clicking
the mouse.

       The file selecting dialog box contains an input box, a file list, a
file information panel, the standard button 'Cancel', one other action button
'Open', plus a history list that's attached to the name input box. The 'Name'
input box is the place where you enter the name of the file to load, or the
filename mask to use as a filter for the Files list box (for example, *.*).
If you press arrow down, you can select filenames previously entered using
the so-called history list.

       The 'Files' list box lists the names of files in the current directory
that match the filename mask in the 'Name' input box:, plus the parent
directory and all subdirectories. e.g. (when mask is *.PAS) :

              ⁄ Files ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒø
              ≥                                 ≥
              ≥  FILENM01.PAS  ≥  FILENM09.PAS  ≥
              ≥  FILENM02.PAS  ≥  FILENM10.PAS  ≥
              ≥  FILENM03.PAS  ≥  FILENM11.PAS  ≥
              ≥  FILENM04.PAS  ≥  FILENM12.PAS  ≥
              ≥  FILENM05.PAS  ≥  ..            ≥
              ≥  FILENM06.PAS  ≥  \MOREXAMP     ≥
              ≥  FILENM07.PAS  ≥  \TOURS        ≥
              ≥  FILENM08.PAS  ≥  \ANSWERS.DIR  ≥
              ≥  Æ±±±˛±±±±±±±±±±±±±±±±±±±±±±Ø   ≥
              ¿ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ

       The file information panel shows the path name, file name, date, time,
and size of the selected file, like here:

             ⁄ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒø
             ≥ C:\TP\EXAMPLES\*.PAS                     ≥
             ≥ HELLO.PAS       52  Jul 14,1990  12:00pm ≥
             ¿ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ

None of the items on this information panel are selectable. Selecting the
'Open' button will open, (or create, depending on the current option) the
selected file.


3.2.   'TAPEFILES' MENU
       ================

       This menu contains options for manipulating tapes (TAP files). As we
mentioned earlier, TAP files are used for the emulation of real Spectrum
tapes. Tapes are organized as a double-coupled list of elements called
blocks. Precise organization of tapes will be given in chapter 7.9.1.
Lunter's TAP format of tapes (TAP files) is also supported, with nearly equal
rights as native the Warajevo tape format.


3.2.1. SUBMENU 'TAPES'
       ===============

       This submenu contains options for selecting and viewing TAP files.

       OPTION 'SELECT'
       ---------------

       Selects the active tape (or creates a new one if the file with the
given name doesn't exist). All operations in the 'TapeFiles' menu will be
related to this tape (tape file). When you call this option, a file
selection dialog will appear. This option has the shortcut key F2, like the
similar option in the emulator kernel.

       The option 'Select' will set command parameters /T and /D described in
chapter 2.1. so this option can change the active directory.

       OPTION 'UNSELECT'
       -----------------

       Cancels selection of the active tape file.

       OPTION 'PARAMETERS'
       -------------------

       Option 'Parameters' will open a dialog which is similar in use to the
Tape Manager described in chapter 2.4. The list box 'Tape position' allows
seeking to any desired block in the tape, which will be active after entering
the emulator. Checkboxes 'Loading method' allow the selection of the tape
loading algorithm (described in chapter 2.4. too). If you select the option
'Autostart', after entering the emulator the selected program will be
automatically loaded. If you use automatic loading, you can enter the initial
color attribute into the input line named 'Initial color attribute'. For more
details, see the description of parameters /F, /L, /A, and /Y in chapter 2.1.

       If you select the 'Autostart' option, the current snapshot file will
be cancelled, because the memory image is in this case superfluous. Also,
parameters from this dialog will be ignored if the MIC/EAR device selected in
the sound setting dialog (menu 'Setup') is not 'Tape file'.

       Option 'Parameters' has the shortcut Shift+F2.

       OPTION 'VIEW'
       -------------

       This views the content of the active tape. This option has the
shortcut Alt+F2. The display is as described in chapter 3.2.2.

       SUBMENU 'PRINT'
       ---------------

       This submenu makes it possible to print tape content to the Screen,
a Printer or into a disc File.

       OPTION 'SCREEN'
       ---------------

       Selection of the option 'Screen' opens a new window on screen which
contains a print preview of the document about tape content. If you change
the current tape file, the preview window will not be automatically updated.

       OPTION 'PRINTER'
       ----------------

       Selection of the option 'Printer' lists all the blocks of the tape
file to the printer, in two columns with page breaks. The dialog for
selecting print options contains two groups of radio buttons, an input line
for manual entering of the paper size, and the 'OK' and 'Cancel' buttons. The
first group of radio buttons are for selecting paper length. There are two
standard sizes. Use '72' for European 12" A4 continuous paper, or '66' for
American 11" Letter continuous paper. If you select 'User defined size', you
should manually enter the size in the input line. The second group of radio
buttons determine the port to which the printer is connected.

       OPTION 'FILE'
       -------------

       Selection of the option 'File' acts like the option 'Printer' but
printing will be redirected to a text file. The dialog for this option is
similar to the previous dialog. After you select 'OK', you must give an
output filename using a file selection dialog.

       OPTION 'COPY TO NEW'
       --------------------

       This option copies the selected blocks from one tape file to another.
After you select the destination file using the file selection dialog you
will see a new dialog on the screen. The top list box lists the blocks of the
source tape. You can select or unselect the blocks using SPACE, ENTER or by
double clicking the mouse. The selected block will be denoted with '>'. The
bottom list box lists the blocks of the destination tape file. All selected
blocks from the source tape file will be stored before the highlighted block
in the destination tape file (or appended to end of the file if you highlight
the EOF marker). If the destination tape is in Lunter's format, copying is
possible only on to the end of the tape.


3.2.2. SUBMENU 'BLOCKS'
       ================

       This menu contains option for manipulating individual blocks into a
tape file. Blocks in TAPE files are an analogue of the blocks on a real tape.
On a real tape, every block consists of 5 parts:

- leader signal (you hear a continous tone and see red and cyan lines on the
  border);
- synchro byte, which determines the end of leading signal;
- flag byte, which determines the purpose of the block, but it will be not
  loaded into memory;
- data bytes (you hear a variable tone and see yellow and blue lines on the
  border);
- parity byte, used for checking correctness of block loading (if it is not
  OK, you will see the message 'R Tape loading error').

In the emulated tape in native Warajevo format, we keep flag byte and data
bytes. The parity byte is not kept in the file, it will be calculated, so the
file is always "OK". In Lunter TAP files, the parity byte is also kept in the
file.

       When you save a program on the original Spectrum, you in fact save two
blocks. The first, with a long leader signal but with little data (17 bytes)
is called the header. The header keeps the program name and information about
program length etc. The second block, with a shorter leader but usually with
much more data contains the actual program (or data, memory image, screen
data etc.).

       In list boxes, headers are displayed in a way which describes their
meaning, as you can see from following examples:

PENETRATOR run 10, 1200+30       This is a BASIC program with the name
                                 PENETRATOR. It has a length of 1200 bytes
                                 without variables, and the variables
                                 occupy an additional 30 bytes. The start
                                 line of the program is 10.

TLL        bas  180+0            This is BASIC program called TLL. It's length
                                 is 180 bytes without variables, and variables
                                 occupy no additional space. There is no
                                 autostart.

ACCOUNT    num a(), 5000         This is a numerical array stored with the
                                 name ACCOUNT. The array name is a(). It's
                                 length is 5000 bytes.

TELEPHONE  chr a$(), 12123       This is an alphanumeric array stored with
                                 the name TELEPHONE. The array name is a$().
                                 It's length is 12123 bytes.

MEMORY     byt 32000, 3121       This is a memory image stored with the name
                                 MEMORY. The start address is 32000, and its
                                 length is 3121 bytes.

       Data blocks (headerless) in the emulator can be compressed and
uncompressed. There are no compressed blocks on the original Spectrum. Their
advantage is that such blocks occupy much less space on disc. Blocks may be
compressed using the submenu 'Implode'. Data blocks will be displayed like
the following:

Headerless len 20000 F:255       This is a 20000 bytes long data block with
                                 flag byte 255.

Compressed len 2048 (510)        This is a compressed block, it's length is
                                 2048 bytes, but it occupies only 510 bytes
                                 on the disc.

       The flag byte determines the block type. It is always 0 for headers,
and it is typically 255 for data bytes, although non-standard headerless
blocks may have different values.

       In addition to ordinary data blocks, the Warajevo emulator also
supports special blocks which contain samples of real tape input which are
taken at regular time intervals. Blocks which contain samples may be
compressed (very efficiently). The environment will show such blocks like
this:

EAR sample len 64993 (5807)      This is a block which contains pure samples
                                 from the tape EAR socket. The logical length
                                 of the block is 64993 bytes, but after
                                 compression, this block occupies only 5807
                                 bytes on the disc.

Sampled tone records may be very long (500 Kb or more). Due to technical
reasons, the Warajevo emulator cuts these records into a series of blocks no
more than 64Kb long. So, one sampled record may be split into ten or more
blocks.

       OPTION 'REORDER'
       ----------------

       This option rewrites all blocks of the tape file to the new tape file,
but in a new order. The list box for this option is very specific. When you
select the block using ENTER, SPACE or double clicking the mouse, any further
moving of the highlight through the list box will move the block too. Pressing
the ENTER key again will park the block to the new location and then you can
move the next block using the same method.

       When you define the new order, you can select the 'OK' button. This
will create a backup (BAK) file and a new tape (TAP) file. You must have
enough space on the disc for the backup file. If you do not have enough
space, use the 'Change position' option instead of this option.

       OPTION 'EXTRACT'
       ----------------

       This option extracts the selected blocks to standalone files. You can
select blocks with a list box using the way described earlier. The radio
buttons determine the treatment of the flag byte. It can be the first byte in
an extracted file or it can become the file extension. If you want to ignore
(throw away) the flag byte, the second option is recommended. The file names
of extracted blocks will be automatically derived according to their position
and the name of the tape file. All compressed blocks will be decompressed
before extracting.

       OPTION 'DELETE'
       ---------------

       This option deletes selected blocks from the TAP file. When you select
all of the blocks you want to remove, select the 'OK' button. This will
create a backup (BAK) file and a new tape (TAP) file without the selected
blocks. You must have enough space on the disc for the .BAK file. If you
haven't got enough space, use the 'Exclude' option instead of 'Delete'.

       OPTION 'ADD BLOCK'
       ------------------

       Adds a standalone file from the disc and makes it a new block on the
tape file. Select the block which you want to add using the file selection
dialog. After this, a new dialog appears on screen. The radio buttons
determine the treatment of the flag byte. It can be extracted from the first
byte in the standalone file or from it's file extension. If you selected
the second option, every nonnumeric file extension will be assumed to be
zero. The list box shows the position of the new created block. The selected
file will be stored before the highlighted block in the destination tape
file (or appended to the end of the file if you highlight the EOF marker). If
the destination tape is in Lunter's format, appending is possible only at the
end of the tape.

       OPTION 'EDIT BLOCK'
       -------------------

       This option edits selected block using a hexadecimal, decimal or ASCII
editor. Editing of compressed blocks is not allowed, because their size
depends dynamically on the data in them.

       OPTION 'EXCLUDE'
       ----------------

       This option excludes a block from the chain in the .TAP file. This
option is similar to the 'Delete' option, but unlike 'Delete', this option
only redirects the pointers in the tape file to forget that this block
exists, but it still occupies the space in the file. That's why, this option
will not work with Lunter TAP files, only with native Warajevo TAP files. Use
this option only if you haven't got enough space on disc for the backup file,
or if the option 'Delete' would take too much time. The selecting of the 'OK'
button will exclude the highlighted block from the chain.

       Excluded blocks can be removed using the 'Linearize' option (see
chapter 3.2.3.).

       OPTION 'CHANGE POSITION'
       ------------------------

       This changes the position of one block in the tape file. Unlike the
'Reorder' option, here you can move only one block at a time, but you do not
need space for the backup file, and the job is much faster if you don't want
to change the position of many blocks. This option only reassigns pointers in
the chain of the tape file. That's why this option works only with tapes in
native Warajevo format, not with Lunter TAP files.


3.2.3. SUBMENU 'IMPLODE'
       =================

       Every block on a tape file, except headers, can be compressed. The
compression reduces the occupied space on the disc by about 30-60% or even
more. Compression uses an Implode algorithm, similar to many archivers (ZIP,
ARJ etc.). This is a feature which is an exclusive characteristic of the
native Warajevo format, so options from this menu will not work when the
active tape is in Lunter TAP format.

       SUBMENU 'COMPRESS'
       ------------------

       Submenu 'Compress' contains 3 suboptions: 'Compress all', 'Linearize'
and 'Compress selected'.

       OPTION 'COMPRESS ALL'
       ---------------------

       This option will compress all blocks in the tape file except headers,
already compressed blocks and blocks where the compression will give worse
results. The original tape file will be saved in a backup (BAK) file. The
compression is a long process, so you will see on the screen two horizontal
scrollbars which show the progress of the operation.

       If you cancel compression using the ESC key, the rest of the tape will
not be compressed but only copied. The ESC key is checked only between
compression of two blocks, not during compression of the one block.

       OPTION 'LINEARIZE'
       ------------------

       This option will purge all excluded blocks from the tape file,
creating a backup (BAK) file and new tape (TAP) file.

       OPTION 'COMPRESS SELECTED'
       --------------------------

       This option is similar to 'Compress all', but with this option you can
 select which blocks will be compressed using a list box.

       OPTION 'DECOMPRESS'
       -------------------

       This option will decompress all compressed blocks in the tape file.
The original tape file will be saved in a backup (BAK) file. You will see on
the screen a horizontal scroll bar which shows the progress of the operation.

       OPTION 'EFFICIENCY'
       -------------------

       This option displays four numbers. The 'Actual size' is the actual
length of the tape file. The 'Compressed size' is the sum of the sizes of all
of the blocks on the tape, and it should be equal to the compressed size. If
not, you should linearize the tape file, because there are excluded blocks
in it. The 'Original size' is a sum of the uncompressed sizes of all blocks
in the tape file. The 'Percentual result' displays compression efficiency
(e.g. ratio between compressed and uncompressed sizes).


3.2.4. SUBMENU 'COMMUNICATIONS'
       ========================

       This submenu contains two submenus: 'RS232' and 'Cassette'.

       SUBMENU 'RS232'
       ---------------

       If you connect a Spectrum 128, +2 or +3 and a PC using the RS232
interface, you can use options in this submenu to send and receive tape
blocks to and from the Spectrum. You can also send the communication program
to the Spectrum 128 and configure RS232. See also chapter 3.12. about the
communication program.

       Communications using RS232 is very risky and dangerous if you started
the emulator from MS Windows.

       OPTION 'SEND TO SPECTRUM'
       -------------------------

       This option allows you to send blocks, using the RS232 interface, from
a tape file to a real Spectrum 128. For this purpose you must connect two
computers using a cable (see chapter 3.12.), load the communication program
on the real Spectrum using a real tape recorder, then select the option
'PC to TAPE' in the communication program.

       On the PC, the user can select/unselect the blocks which will be sent
to the Spectrum using a list box. On the Spectrum, you can select option 'L'
for loading headers with corresponding blocks or 'H' for loading headerless
blocks. When you have selected all of the desired blocks, select 'OK'. The
transfer will start. The PC will show a horizontal scroll bar of the
progress of the operation. The indicator that communication is working is if
flashing lines appear on the Spectrum border. If the communication fails,
the Spectrum will report the error. In this case, repeat the transfer.

       Sometimes it will be hard for the Spectrum to recognize the start of
the block. The effect will sound like a machine gun. Press BREAK on the
Spectrum and ESC on the PC and try again. You may need to leave the
environment and start it again.

       When all blocks are sent, press BREAK on the Spectrum, then press 'S'
to save them to the tape recorder.

       OPTION 'RECEIVE FROM SPECTRUM'
       ------------------------------

       This option allows you to receive blocks from the Spectrum 128 to your
PC. For this purpose you must connect two computers as in the previous
option. You must first load onto Spectrum the blocks that you want to
receive, using the commands 'L' (for blocks with headers) or 'H' (for
headerless blocks). When you have loaded the desired blocks, select this
option on the PC and then press 'S' on the Spectrum (transferred blocks will
be appended to the end of the current tape file). The transfer will then
start. A horizontal scroll bar will show the progress of the operation. After
you have received all the blocks press ESC on the PC. In the case of a
problem, the PC will interrupt the transfer.

       OPTION 'SEND COMMUNICATION PROGRAM'
       -----------------------------------

       Using this option the communication program stored in the file
COMM128.BZX will be sent to the Spectrum 128. Connect the computers as
before. You must type into the Spectrum (in 128K mode) the short BASIC
program displayed on the screen and wait until the transfer finishes. After
this simply follow the instructions which will appear on the screen.

       OPTION 'CONFIGURE RS232'
       ------------------------

       Using this option you can select the communication port (default is
COM2) and the communication baud rate (default is 9600 Bd).

       SUBMENU 'CASSETTE'
       ------------------

       Besides transferring using the RS232 interface, it is possible to
directly load programs from a real tape into the environment using a
'B G Services' interface or a Sound Blaster card. In addition to these two
variants, options from this menu work also with a tape recorder connected to
LPT1 port using only one resistor and diode for protection (this method is
described in the documentation of the Spanish Spectrum emulator by Pedro
Gimeno). We must remark again that loading using Sound Blaster is very
unreliable. More information about the 'B G Services' interface and loading
through Sound Blaster can be found in chapter 2.4. Options from this menu
will not work if the emulator is started from the MS Windows environment.

       OPTION 'RECEIVE FROM CASSETTE'
       ------------------------------

       After selecting this option, you will see a dialog which allows you to
determine whether the program produces sound during loading from cassette
('Hear loading sound') and whether the program checks for loading errors
('Tape loading error check', disable this option only when it is the only
solution). Also, you can determine the loading speed ('Effective speed').
This speed must be about 1500 Bd for programs saved using a normal speed, but
changing of this speed allows loading of many protected programs saved using
a higher speed. The loading routine is similar to the loading routine for the
Spectrum ROM, and it is based on the routine written by Rui Fernando
Ferreiera Ribeiro from Portugal. The radio buttons 'Input device' allow
selecting between B G Service's interface, the Spanish interface, and Sound
Blaster.

       When you select 'OK', you will see a loading window. Loaded blocks
will be appended to the end of the active TAP file. When loading errors
appear, you will see a 'Tape loading error' message. In this case, rewind
the tape and try loading the current block again. If the header of the
program is loaded correctly, the program name will appear in the loading
window. If you have an EGA or VGA graphic card, you will see flashing lines
on the border during loading, just like on a real Spectrum.

       During loading, pressing keys S, N, 1, 2 and ESC you can switch the
speaker on/off, switch error checking on/off and break the loading process
respectively.

       OPTION 'SAMPLE FROM CASSETTE'
       -----------------------------

       The previous option has a disadvantage: loads are performed using a
routine which is more or less similar to the routine in the Spectrum ROM, so
it is not possible to load non-standard saved programs. This option simply
transfer samples of a tone record from a real tape to a TAP file (sample
blocks will be created), so you can transfer absolutely any programs into a
TAP file (you can store in a TAP file ordinary music using this option).
Since the emulator does not perform any kind of checking with this option,
no loading errors will appear.  Incorrect loading will cause a loading error
only when you try to load a program from a created TAP file into the
emulator.

       The dialog linked with this option allows you to set the sampling
frequency and input device, and whether the program produces sound during
loading. However, there are some difficulties with using this option.
Sampling from tape needs allocation of huge memory buffers (for example, 5
minutes of tone record sampled at 22050 Hz needs about 800 Kb). So, you must
have at least 2 Mb of RAM. Also, linear addressing of memory space is needed
due to the reliability of loading at segment boundaries, so at least a 80386
processor is needed. This option initially allocates a 1-Mbyte buffer out of
the space usually used by DOS. This is space which begins on an address which
is 64 Kb above the first megabyte of RAM (linear address 1114112). No DOS
extenders (like DPMI) are needed, the environment directly accesses memory
locations in the buffer. Unfortunately, there is no guarantee that some
'virtual' drivers which are sometimes in use didn't allocate this space for
their own purposes. So, before starting this option remove all drivers which
access memory above 1 Mb like QEMM, EMM386, RAMDRIVE, VDISK, SMARTDRV, HIMEM,
various versions of WINDOWS etc. The safest method is running on a totally
'nude' computer, e.g. without superfluous drivers in AUTOEXEC.BAT and
CONFIG.SYS files. Linear memory access also needs temporary processor
switching in 'protected' mode, so it is not possible to start this option
when the processor is in 'V86' mode. Most of above mentioned drivers switch
the processor into 'V86' mode, so you can not even start this option in the
presence of these drivers (an error message will appear).

       To give more flexibility, the dialog for this option also contains two
input fields 'Lowest linear address' and 'Highest linear address'. Using
these fields, you can change the start and end address of the sample buffer
(it's your responsibility, though). Decreasing the start address below
1114112 is extremely risky. Increasing the end address is useful for the
sampling of very long blocks or during sampling at a frequency of 44100 Hz.
The required buffer length is:

BUFFER_LENGTH = SAMPLE_FREQUENCY * DURATION_OF_THE_RECORD_IN_SECONDS / 8

       The sampling starts the moment you press 'OK'. Tone samples will be
appended to the end of active tape file, which must be in Warajevo format
(because Lunter TAP format does not support tone sample blocks). The sampling
will be interrupted when you press the ESC key. After the transfer is
finished, it is not bad idea to exit the environment and reboot the computer.

       OPTION 'ADVANCED SETUP'
       -----------------------

       This option allows you to set 7 time constants which control the
loading process, and change the base address of the Sound Blaster sound card
(typically 544 or 220 HEX). A description of time constants is 'too advanced'
for here so you must look at the technical part of the manual (chapter 7.14.).
The first 4 constants are not dependent on loading speed, and changing these
constants is needed very rarely. The last three constants will be
automatically adjusted when you change the effective loading speed, but it is
possible to manually set them for better control. If you are not familiar
with loading routines, do not change these constants. However, if you have
loading problems, you can try (if you want) to slightly change the last 3
constants (especially the constant named 'Threshold').


3.2.5. SUBMENU 'CONVERT'
       =================

       This menu contains options for converting formats between different
PC and Spectrum commercial programs. There are also options for converting
tape formats between Warajevo and other PC-based Spectrum emulator format.
The conversion rules will be described, so you can use these options for
partial conversion from (or to) some unsupported formats which are similar to
supported formats.

       SUBMENU 'ASCII <-> BASIC'
       -------------------------

       These conversions are compatible with Beta BASIC 3.0 and 128K Basic.

       OPTION 'ASCII -> BASIC'
       -----------------------

       First you must select an ASCII file which contains a BASIC program in
ASCII format which will be converted. The converted program will be stored in
the current tape file before the highlighted block (or appended to end of the
file if you highlight EOF marker). If the active tape is in Lunter TAP
format, storing is possible only at the end of the tape.

       The rules of conversions are:

- The ASCII file must contain line numbers between 1 and 9999;
- One BASIC line in the ASCII file must take exactly one screen line;
- All standard ASCII signs (#32-#127) will be converted to the same signs;
- After numbers and arguments of DEF FN will be placed character #14 and 5
  bytes with numerical representations;
- The characters #128-#148 will be converted to UDG characters;
- The characters 'ú','È','€','‹','ﬂ','ﬁ','›' will be converted to similar
  Spectrum characters;
- The keywords (including Beta BASIC 3.0) will be tokenized if they are out
  of quotes;
- The tokens 'GO TO' and 'DEF FN' can be entered with or without the space.

       OPTION 'BASIC -> ASCII'
       -----------------------

       You must place the highlight in the list box on the header of the
BASIC program that you want to convert into an ASCII file. When you select
'OK', define the name of the output ASCII file. The default name is
BASASCII.TXT.

       The rules of conversions are:

- All standard ASCII signs will be converted to the same PC signs;
- The keyword tokens will be split into ASCII signs;
- Five-byte number definitions after #14 will be ignored;
- UDG signs will be converted to signs above #127 if they are quoted, or to
  keywords of Beta BASIC if they are not quoted;
- Quoted graphic characters will be converted to PC graphic characters if
  they exist. If a graphic character is not quoted, it will be converted to
  the keyword of Beta BASIC;
- The Pound and CopyRight will be converted to similar PC characters;
- The color control codes (under #32), if quoted, will be converted to
  CHR$(nn).

       SUBMENU 'ASCII <-> HISOFT'
       --------------------------

       This menu supports conversion to and from Hisoft's programs GENS,
PASCAL and C Compiler.

       OPTION 'ASCII -> GENS'
       ----------------------

       Select the source ASCII file and position of destination file in the
tape file the method described earlier. The rules of conversions are:

- The ASCII file must not contain line numbers. Line numbers will be
  automatically created as 10, 20, 30 ...
- The labels must be written from the first column;
- The instructions must not begin in the first column;
- All standard ASCII signs will be converted.

       OPTION 'ASCII -> C'
       -------------------

       Select the source ASCII file and position of the destination file in
the tape file using the method described earlier. The rules of conversion
are:

- The ASCII file must not contain line numbers;
- All standard ASCII signs will be converted.

       OPTION 'ASCII -> PASCAL'
       ------------------------

       Select the source ASCII file and position of the destination file in
the tape file using the method described earlier. The rules of conversion
are:

- The ASCII file must not contain line numbers;
- PASCAL reserved words will be tokenized;
- All standard ASCII signs will be converted.

       OPTION 'GENS -> ASCII'
       ----------------------

       Select the header of the assembler program which will be converted to
an ASCII file and state the name of the output file (default is
GENSASCII.TXT) using the method desribced earlier. The rules of conversions
are:

- All standard ASCII signs (#32-#127) will be converted;
- Line numbers will be ignored;
- The tab will be converted to one space;
- Signs above #127 will be ignored.

       OPTION 'C -> ASCII'
       -------------------

       Select the header of the C program which will be converted to an ASCII
file and name the output file (default is CASCII.TXT) using the method
described earlier. The rules of conversions are:

- All standard ASCII signs (#32-#127) will be converted;
- Line numbers will be ignored;
- LF (10) will be converted to CR/LF (#13+#10);
- Tokens for '>=', '<=' and '!=' will be decomposed;
- Signs above #127 will be ignored.

Spectrum C programs may have more blocks with one header.

       OPTION 'PASCAL -> ASCII'
       ------------------------

       Select the header of the Pascal program which will be converted to an
ASCII file (if you use HP4S, select the second header) and name the output
file (default is PASASCII.TXT) using the method desribed earlier. The rules
of conversions are:

- All standard ASCII signs (#32-#127) will be converted;
- Line numbers will be ignored;
- Pascal tokens will be decomposed;
- Signs above #127 will be ignored.

       SUBMENU 'ASCII <-> TASSWORD'
       ----------------------------

       This menu supports conversion to and from Tasman's word processors for
the Spectrum called Tasword 2 and Tasword 3.

       OPTION 'TASSWORD 2 -> ASCII'
       ----------------------------

       Select the header of the Tasword 2 text file which will be converted
to an ASCII file and name the output file (default is TSWRDCII.TXT) using
the method described earlier. The rules of conversions are:

- All standard ASCII signs (#32-#127) will be converted;
- After every 64 signs a new line will be inserted;
- Signs above #128 will be ignored;

       OPTION 'TASSWORD 3 -> ASCII'
       ----------------------------

       Select the header of the Tasword 2 (or Tasword 128) text file which
will be converted to an ASCII file and name the output file (default is
TSWRDCII.TXT) using the method described earlier. The rules of conversions
are:

- All standard ASCII signs (#32-#127) will be converted;
- After every 64 signs a new line will be inserted;
- Signs above #127 will be ignored;
- The null byte (#0) will be converted to a new line.

       OPTION 'ASCII -> TASSWORD 2'
       ----------------------------

       Select the source ASCII file and the position of the destination file
in the tape file using the method described earlier. The rules of conversions
are:

- A new line on a PC ASCII file will be a new line on a Tasword 2 file;
- All standard ASCII signs will be converted.

       OPTION 'ASCII -> TASSWORD 3'
       ----------------------------

       Select the source ASCII file and the position of the destination file
on the tape file using the method described earlier. The rules of conversions
are:

- A new line on a PC ASCII file will be a new line on a Tasword file;
- All standard ASCII signs will be converted;
- After every 64 signs a line delimiter will be inserted.

       SUBMENU 'ASCII <-> THE LAST WORD'
       ---------------------------------

       This menu supports conversion to and from the text processor The Last
Word.

       OPTION 'ASCII -> THE LAST WORD'
       -------------------------------

       Select the source ASCII file and the position of the destination file
in the tape file using the method described earlier. The rules of conversions
are:

- A new line on a PC ASCII file will be a new line on a The Last Word file;
- All standard ASCII signs will be converted;
- After every 40 signs a soft line delimiter will be inserted.

       OPTION 'THE LAST WORD -> ASCII'
       -------------------------------

       Select the header of the The Last Word text file which will be
converted to an ASCII file and name the output file (default is TLWASCII.TXT)
using the method described earlier. The rules of conversions are:

- All standard ASCII signs will be converted;
- Signs above #127 will be ignored;
- Signs #13 and #12 Null byte will be converted to a new line.

       SUBMENU 'ASCII <-> MACHINE LIGHTNING'
       -------------------------------------

       This menu supports conversion to and from the macro assembler Machine
Lightning.

       OPTION 'ASCII -> MACHINE LIGHTNING'
       -----------------------------------

       Select the source ASCII file and the position of the destination file
in the tape file using the method described earlier. The rules of conversions
are:

- A new line on a PC ASCII file will be a new line on a Machine lightning
  file;
- All standard ASCII signs will be converted;
- Tabs and spaces will be converted to a Machine lightning TAB symbol.

       OPTION 'MACHINE LIGHTNING -> ASCII'
       -----------------------------------

       Select the header of the assembler program which will be converted to
an ASCII file and name the output file (default is MLSCII.TXT) using
the method described earlier. The rules of conversions are:

- All standard ASCII signs will be converted;
- Signs above #127 will be ignored;
- The tabulators will be expanded.

       SUBMENU 'ASCII <-> FORTH'
       -------------------------

       This menu supports conversion to and from Abersoft's Forth compiler.

       OPTION 'ASCII -> FORTH'
       -----------------------

       Select the source ASCII file and the position of the destination file
in the tape file using the method described earlier. The rules of conversions
are:

- All standard ASCII signs will be converted;
- The resulting FORTH program will be exactly 11263 bytes long, because that
  is the size of the FORTH ram disc.

       OPTION 'FORTH -> ASCII'
       -----------------------

       Select the header of the Abersoft Forth RAMDISC file which will be
converted to an ASCII file and name the output file (default is FORTHASC.TXT)
using the method described earlier. The rules of conversions are:

- All standard ASCII signs will be converted;
- Signs above #127 will be ignored;
- After every 32 bytes new line will be inserted.

       SUBMENU 'ASCII <-> LOGO'
       ------------------------

       This menu supports conversion to and from the Sinclair Logo
interpreter. We must remark that the Spectrum Logo programs may have more
blocks with one header.

       OPTION 'ASCII -> LOGO'
       ----------------------

       Select the source ASCII file and the position of the destination file
in the tape file using the method described earlier. The rules of conversions
are:

- A new line on a PC ASCII file will be converted to 3 new line symbols in
  a Logo program;
- All ASCII signs will be converted;
- The rest of the last block will be filled with zeros to full block length.

       OPTION 'LOGO -> ASCII'
       ----------------------

       Select the header of the Logo program which will be converted to an
ASCII file and name the output file (default is LOGOASCI.TXT) using
the method described earlier. The rules of conversions are:

- All standard ASCII signs will be converted;
- Signs above #127 will be ignored;
- Signs 0, or four new line signs terminate the conversion.

       SUBMENU 'SCREEN$ TO TIFF'
       -------------------------

       The Warajevo emulator can convert the Spectrum's screen image to a
color or black and white TIFF picture file.

       OPTION 'COLOR TIFF PICTURE'
       ---------------------------

       Select the header of the screen image file which will be converted to
a TIFF file and name the output file (default is COLORTIF.TIF) using the
method described earlier.

       OPTION 'BLACK AND WHITE TIFF PICTURE'
       -------------------------------------

       Select the header of the screen image file which will be converted to
a TIFF file and name the output file (default is BWTIFF.TIF) using the
method described earlier.

       SUBMENU 'OTHER EMULATORS'
       --------------------------

       Warajevo TAP files may be converted to and form the formats of
different Spectrum emulators, including:

- Z80, by Gerton Lunter from Netherlands;
- SPECEM, by Kevin J. Phair from Ireland;
- ZX, by Peter Kroselj (?) from Slovenia;
- SP, by J. Swiatek and K. Makowski from Poland;
- SPECTRUM 2.00, by Pedro M. R. Salas from Spain;
- Nuclear ZX, by Radovan Garabik from Slovakia;
- ZX, by Eduard Rindt and Ludek Brukner from Czech;
- SP105 (Spectrum + TR-DOS), by N. V. Shalaev from Russia;
- ZX32, by Vaggelis Kapartzianis from Greece;
- JPP, by Arnt Guldbransen from Norway.

       Also, conversions to and from the TZX format (recently a very popular
tape format by Tomaz Kac from Slovenia, which is supported in the X128
emulator by James McKay from Great Britain) and conversions to and from the
ZXS tape format (storage format used on the Russian Internet site ZX Museum)
are implemented too.

       Except the conversion 'LUNTER TAP -> WARAJEVO TAP', all conversions
which are described below don't work if the current tape is in Lunter TAP
format.

       SUBMENU 'WARAJEVO <-> ROMAN & EASY'
       -----------------------------------

       The emulator ZX (Roman & Easy inc.) by Peter Kroselj (?) keeps every
block in separate files named ZXTnnmmm.H and ZXTnnmmm.B in the directory
FILES, and it uses special files (with the extension .ZXT) which contain the
logical block structure of each tape. There is also a file which keeps
information about which tapes exist (filename TAPES.ZX). These files are not
located in the directory FILES, but in the directory where the ZX emulator
itself is located (e.g. the parent directory of the directory FILES).

       OPTION 'ROMAN & EASY INC -> WARAJEVO'
       -------------------------------------

       This converts tape files from ZX by Roman & easy inc format to
Warajevo format, appending files to the current Warajevo tape file. When you
select this option, you will see on the screen the dialog for selecting the
tape which you want to convert. You must be in the directory FILES. You will
be prompted before appending each block.

       OPTION 'WARAJEVO -> ROMAN & EASY INC'
       -------------------------------------

       To make this conversion, you must be in the directory FILES, and its
parent directory must contain the file TAPES.ZX (which could be empty). This
conversion will create the necessary .H and .B files based on the active
Warajevo tape, one .ZXT file with the same name as the active Warajevo tape,
and will perform the necessary changes in the TAPES.ZX file to inform the ZX
emulator about the presence of the newly created tape.

       SUBMENU 'WARAJEVO <-> LUNTER Z80'
       ---------------------------------

       The Z80 emulator by Gerton Lunter uses a tape format with the same
extension .TAP, but his format is rather poor in comparasion with the native
Warajevo format.

       OPTION 'LUNTER TAP -> WARAJEVO TAP'
       -----------------------------------

       This converts the tape from Lunter TAP format to native Warajevo TAP
format. If the active tape file is a Warajevo tape file, use the dialog to
select the name of the tape which you want to convert. All blocks from this
tape will be appended to the end of the current Warajevo tape. If the active
tape file is a Lunter tape file, use the dialog to select the name of the
destination tape (the default name will be same as the name of the source
tape with prefix 'W', for example TAPE.TAP becomes WTAPE.TAP). In this case,
conversion will create a new tape in the native Warajevo format.

       OPTION 'WARAJEVO TAP -> LUNTER TAP'
       -----------------------------------

       This converts the current Warajevo tape to Lunter's tape format.
Select the name of the destination tape using the dialog. The default name
will be same as name of the source tape with a prefix 'L', for example
TAPE.TAP becomes LTAPE.TAP.

       SUBMENU 'WARAJEVO <-> IRISH SPECEM'
       -----------------------------------

       The emulator SPECEM by Kevin J. Phair does not support headerless
blocks, but it puts every Spectrum file in separate files with the extension
.__B, .__C etc. depending on their type.

       OPTION 'IRISH SPECEM -> WARAJEVO TAP'
       -------------------------------------

       Using the dialog select the SPECEM file which will be converted. The
converted program will be appended to the end of the current Warajevo tape
file.

       OPTION 'WARAJEVO TAP -> IRISH SPECEM'
       -------------------------------------

       You must place the highlight in the list box on the header of the
Spectrum file which you want to convert into SPECEM format.

       SUBMENU 'WARAJEVO <-> POLISH SP'
       --------------------------------

       The SP emulator by J. Swiatek and K. Makowsky uses the file
TAPE_ZX.SPC for tape emulation, but we support conversions from files with
arbitrary names, if their formats are the same as this file. The russian
emulator SP_UKV uses the SPC format too.

       OPTION 'POLISH SP SPC -> WARAJEVO TAP'
       --------------------------------------

       Using the dialog select the SPC file which will be converted. The
converted blocks will be appended to the end of the current Warajevo tape
file.

       OPTION 'WARAJEVO TAP -> POLISH SP SPC'
       --------------------------------------

       This converts the current Warajevo tape file to the SPC format. Using
the dialog select the name of the destination tape. The default name is
TAPE_ZX.SPC.

       SUBMENU 'WARAJEVO <-> SPECTRUM 2.00'
       ------------------------------------

       The emulator Spectrum 2.00 by Pedro M. R. Salas uses the BLK format
for the tape emulation. In fact, this format is the same as Lunter's TAP
format.

       OPTION 'BLK -> WARAJEVO TAP'
       ----------------------------

       Using the dialog select the BLK file which will be converted. The
converted blocks will be appended to the end of the current Warajevo tape
file.

       OPTION 'WARAJEVO TAP -> BLK'
       ----------------------------

       This converts the current Warajevo tape file to the BLK format. Using
the dialog select the name of the destination tape.

       SUBMENU 'WARAJEVO <-> ZX GARABIK'
       ---------------------------------

       The Nuclear ZX Emulator by Radovan Garabik uses the LTP format for the
tape emulation. In fact, this format is the same as the polish SPC format.

       OPTION 'LTP -> WARAJEVO TAP'
       ----------------------------

       Using the dialog select the LTP file which will be converted. The
converted blocks will be appended to the end of the current Warajevo tape
file.

       OPTION 'WARAJEVO TAP -> LTP'
       ----------------------------

       This converts the current Warajevo tape file to the LTP format. Using
the dialog select the name of the destination tape.

       SUBMENU 'WARAJEVO <-> ZX BRUKNER'
       ---------------------------------

       The ZX emulator by Eduard Rindt and Ludek Brukner keeps every block in
a separate file with the extension .001, .002 etc.

       OPTION 'ZX BRUKNER -> WARAJEVO TAP'
       -----------------------------------

       Using the dialog select the block which you want to include in the
active TAP file (it must be a block with an extension like .nnn). After this,
select the position in the active tape file where this block will be included
(like in the option 'Add Block' in submenu 'Blocks' which is described in
chapter 3.2.2.).

       OPTION 'WARAJEVO TAP -> ZX BRUKNER'
       -----------------------------------

       All blocks from the active Warajevo tape will be extracted and saved
with the same name as the name of the tape file, but the extensions will be
.001, .002 etc.

       SUBMENU 'WARAJEVO <-> TZX'
       --------------------------

       The TZX format is a very popular tape format by Tomaz Kac from
Slovenia, which is planned to be a universal format for keeping Spectrum
programs in such a way that it includes all possible cases which appear on a
real Spectrum. This format may include textual program descriptions,
pictures, and even some commands (a kind of macrolanguage). At the moment,
this format is only supported by the X128 emulator by James McKay and the
MultiMachine emulator by Paul Hodgson from Great Britain. On FTP sites,
the number of programs saved in this format grows every day.

       OPTION 'TZX -> WARAJEVO TAP'
       ----------------------------

       Using the dialog select the TZX file which will be converted. The
converted blocks will be appended to the end of the current Warajevo tape
file. The TZX format is much more complex than the TAP format, so some
details will be simply ignored during conversion. Blocks which contain tone
samples in any form, or blocks which contain other non-standard records will
be converted into Warajevo sample blocks. The TZX format is very complex, so
this conversion is a bit slower than the other conversions, but much faster
than in release 2.0. Starting from release 2.5, Warajevo allows the user to
customize the rules of the conversion, using the option 'TZX conversion setup'
in this menu. At this moment, the rules of conversions are:

- 'Standard speed' blocks will be sampled to EAR sample blocks, or converted
  into headerless blocks (if you thrust in EDGE RECOGNIZER), depending on the
  current settings; a pause after them will be sampled to EAR sample blocks
  or ignored, depending on the settings;
- 'Pure tone', and 'Sequence of pulses' blocks will be sampled to EAR
  Sample blocks or ignored, depending on the settings;
- 'Turbo loading' and 'Pure data' blocks will be converted to EAR Sample
  blocks, or into headerless blocks (if you believe that EDGE RECOGNIZER will
  recognize them), depending on the settings;
- 'Direct recording' blocks will be converted only if they have the
  recommended sampling frequencies of 44100 or 22050 Hz; optionally they may
  also be ignored;
- 'Finite Pause' blocks will be sampled to EAR sample blocks;
- 'Infinite pause' will be saved as normal blocks, with zero size;
- 'Group Start' blocks indicate that the following EAR samples should not be
  separated;
- 'Group End' blocks start separating of following samples;
- 'Loop' and 'EndLoop' blocks are implemented using repeated sampling;
- 'Jump To' blocks are implemented only for forward jumps; backward jumps may
  optionally be ignored;
- 'Call Sequence' and 'Return From Sequence' are not planned to be
  implemented;
- 'Select' blocks will simply be ignored;
- 'Text Description' blocks will be displayed on the screen during the
  conversion, or will be ignored, depending on the settings;
- 'Message block' depending on settings can be ignored, displayed on the
  screen during the conversion, or converted into 'Character array' blocks
  which may be seen in the Tape Manager in the emulator itself;
- 'Archive Info' blocks will be ignored;
- 'Hardware Info' and 'Emulation Info' blocks are implemented only when
  using the 'Start' button (see chapter 3.9.);
- 'Custom Info' blocks will be ignored;
- 'Snapshot' blocks are implemented only when using the 'Start' button.

       All sampling will be performed at 44100 Hz. For more information about
TZX blocks, read the documentation about the TZX file format, which may be
found on the Internet.

       After the conversion, tape imploding is highly recommended, because
the converted tape file may be big, and imploding sample blocks is very
efficient.

       OPTION 'WARAJEVO TAP -> TZX'
       ----------------------------

       This converts the current Warajevo tape file to the TZX format. Using
the dialog select the name of the destination tape. The TAP format is simpler
than TZX, so this conversion usually works fine.

       OPTION 'TZX CONVERSION SETUP'
       -----------------------------

       All suboptions in the dialog for this option will be described
separately.

- Sample standard blocks rather than copy them

  Determines whether 'Standard speed' blocks would be converted into EAR
  Sample or Headerless blocks. The former is a bit more reliable, because it
  will work in all cases, but it will cause remarkable slower loading even
  with quite small programs;

- Sample pause after standard block

  Determines whether a pause after a 'Standard speed' block would be sampled,
  or ignored.

- Sample Turbo blocks rather than copy them

  Determines whether 'Turbo loading' blocks would be converted into EAR
  Sample or Headerless blocks. The former is more reliable and will work in
  all cases. The latter (if EDGE RECOGNIZER succeeds in recognizing the
  block) will cause remarkably faster loading;

- Sample pause after turbo block and pure data

  Determines whether a pause after 'Turbo loading' and 'Pure data' blocks
  would be sampled, or ignored.

- Sample pure tone and sequence of pulses

  Determines whether 'Pure tone' and 'Sequence of pulses' blocks would be
  sampled or ignored; The latter is necessary if you determine that 'Pure
  data' blocks would be converted into Headerless blocks.

- Sample pure data rather than copy them

  Determines whether 'Pure data' blocks would be converted into EAR Sample or
  Headerless blocks. Like in previous similar options, the former is much
  more reliable.

- Embed messages in converted tape

  When this option is switched on, 'Message' blocks will be converted into
  'Character array' header blocks, which may be seen in the Tape Manager in
  the emulator itself. The message will be truncated to 10 characters. This
  option is useful for separating levels in games stored in TZX format.

- Convert direct recording

  Determines whether 'Direct recording' blocks would be converted or ignored.

- Put all blocks and groups in separate samples

  When this option is turned off, during conversion the logical structure of
  the TZX file will not be preserved, so the converted file will have
  "pasted" blocks. The converted file will then have a lot less blocks, and
  the drawback is the fact that the blocks on the converted tape will not
  logically correspond to blocks on the TZX file. Switching this option off
  may drastically speed up the conversion of TZX files which have a huge
  number of blocks (for example, in Firebird Bleepload programs).

- Allow negative jumps (not yet implemented)

  Determines whether negative jumps would be allowed in the TZX file
  (although they are not implemented yet).

- Show text description blocks

  Determines whether text descriptions from 'Text Description' block would be
  displayed on the screen during conversion or would be ignored.

- Show message blocks

  Determines whether 'Message' blocks would be displayed on the screen during
  conversion, or would be ignored.

- Extract snapshot block

  Determines whether 'Snapshot' block would be extracted during the starting
  of TZX files using 'Start' button, or would be ignored.

- Show warning for nonimplemented blocks

  Determines whether the environment would display warning message for
  nonimplemented blocks.

- Consider hardware and emulation info

  Determines whether 'Hardware Info' and 'Emulation Info' blocks would be
  considered during the starting of TZX files using 'Start' button, or would
  be ignored.

       You need not set these options every time you enter into the
environment. Namely, every option has its corresponding number. The first
option corresponds to number 1, and every option has a number which is twice
the number of the previous option (second option has number 2, third 4,
fourth 8, etc. and last option has number 16384). To keep permanent TZX
settings, add the numbers of all the options which are turned on, and use
that number as a parameter after the command option /&T in the configuration
file DEFAULT.CFG. Alternatively, if you don't want to calculate it, after you
have changed the settings enter the emulator using F10 then immediately exit
the emulator. Edit the created file SPECSIM.CFG, and read the number after
the option /&T in this file.

       SUBMENU 'WARAJEVO <-> ZX MUSEUM'
       --------------------------------

       The ZX Museum is a Russian Internet site on which you can find about
1000 programs stored in ZXS format. This format is not directly supported by
any emulator. This format is also richer than TAP format, but it seems that
no programs on this site use the extra features of ZXS format which are not
supported in TAP format, so this conversion will work fine.

       OPTION 'MUSEUM ZXS -> WARAJEVO'
       -------------------------------

       Using the dialog select the ZXS file which will be converted. The
converted blocks will be appended to the end of the current Warajevo tape
file. Extra features of the ZXS format will simply be ignored.

       OPTION 'WARAJEVO TAP -> MUSEUM ZXS'
       -----------------------------------

       This converts the current Warajevo tape file to the ZXS format. Using
the dialog select the name of the destination tape.

       SUBMENU 'WARAJEVO <-> SPECTRUM + TRDOS'
       ---------------------------------------

       The SPECTRUM + TR-DOS (also known as SP105) emulator is an emulator by
N. V. Shalaev from Russia, which emulates the expanded version of the ZX
Spectrum 128 with the TR-DOS disc interface. It uses the TRD format. This is,
in fact, a format for disc emulation, not for tape emulation, but since this
is the only format which this emulator supports, we allow partial conversions
from TRD format to TAP format, and vice versa. To complete the conversion,
some things must be done manually.

       OPTION 'TRD -> WARAJEVO TAP'
       ----------------------------

       Using the dialog select the TRD file which will be converted. The
converted programs will be appended to the end of the current Warajevo tape
file. After this, converted programs will not work, because loading from
TR-DOS disc is performed using different commands from loading from tape. So,
after the conversion, you must manually change all BASIC loaders on the
converted tape file.

       OPTION 'WARAJEVO TAP -> TRD'
       ----------------------------

       The TRD format does not support headerless blocks (TRD is disc format,
so this limitation is natural). Move the highlight to the header of the
program which you want to convert. After this, using the other dialog select
the TRD file on which you want to copy the program from the TAP file (so, the
TRD file must exist, and it must be properly formatted using the SP105
emulator). Clearly, using this kind of conversion, after copying all of the
wanted blocks, you must also manually change the BASIC loaders (except in the
cases when the TAP file is created using the special case of converting
snapshot files in TAPE files, we will explain this later in the manual).

       SUBMENU 'WARAJEVO <-> ZX32'
       ---------------------------

       The ZX32 emulator by Vaggelis Kapartzianis for Windows 95 uses a
relatively complex ZXT (or ZXS) format for tape emulation. This format, in
addition to tapes, may contain snapshot files and many other things.

       OPTION 'ZX32 ZXT -> WARAJEVO TAP'
       ---------------------------------

       Using the dialog select the ZXT file which will be converted. The
converted blocks will be appended to the end of the current Warajevo tape
file. During conversion, only details which are related to tape emulation
will be extracted from the source file. The ZXT format is much more complex
than the TAP format, so any peculiarities during conversion will simply be
ignored. This conversion does not support the compressed ZXT/ZXS format.

       OPTION 'WARAJEVO TAP -> ZX32 ZXT'
       ---------------------------------

       This converts the current Warajevo tape file to the ZXT format. Using
the dialog select the name of the destination tape.

       SUBMENU 'WARAJEVO <-> JPP'
       --------------------------

       The VOC format is one of the most popular methods for storing data
from original tape, using audio samples. It was developed by Creative Labs,
and the first emulator that used this format was JPP by Arnt Gulbransen. This
format is also implemented in the Z80 emulator by Gerton Lunter and in the
X128 emulator by James McKay. VOC is in fact an audio format, so it is
usually huge (often some megabytes).

       OPTION 'VOC -> WARAJEVO TAP'
       ----------------------------

       Using the dialog select the VOC sample file which will be converted.
All data from the VOC file will be converted into EAR Sample blocks (on 30303
Hz) and will be appended to the end of the current Warajevo tape file. After
this conversion, tape imploding is highly recommended. Before compression,
the resulting TAP file is about 8 times shorter than the VOC file, but after
compression, the TAP file is usually 50-100 times shorter than the source VOC
file!

       OPTION 'WARAJEVO TAP -> VOC'
       ----------------------------

       This converts the current Warajevo tape file to the VOC format. Using
the dialog select the name of the destination sample file. Be aware of the
fact that VOC files may be huge.


3.3.   'Z80SNAPS' MENU
       ===============

       This menu is dedicated to manipulations with snapshot files. Snapshot
files are files which contain a Spectrum memory image, including the contents
of all processor registers and the states of some emulated I/O devices. They
have the extension .Z80 and they are compatible with Lunter's snapshot
format.

       If you call the environment from the emulator (by pressing F10), the
name of the active snapshot file will always be TEMP.Z80, because it is a
snapshot file in which the emulator saves the temporary state before entering
the environment.

       Calling the emulator from the environment (also done by pressing F10)
will run the active snapshot file (if it is not changed, the emulator will
continue working as if the environment had not been called). Calling the
emulator with no active snapshot file will cause the activating of the
'pure machine' (e.g. after a few seconds you will see the famous message
'Sinclair research Ltd.').


3.3.1  SUBMENU 'SNAPS'
       ===============

       In this menu there are options for selecting and viewing snapshot
headers.

       OPTION 'SELECT'
       ---------------

       Selects the current snapshot file using a dialog. All operations in
the 'Z80Snaps' menu will be related to it. This option has the shortcut
Shift+F7.

       This option will set the parameter /R described in chapter 2.1. The
snapshot filename will be given with a full path name, so selecting this
option will not set parameter /D (e.g. will not change active directory).

       OPTION 'UNSELECT'
       -----------------

       This cancels the selecting of the current snapshot file. If you call
the environment from the emulator, this option will reset the emulator after
running the emulator again, because after this option the memory image will
not be present (the 'pure machine' will be activated). That's why this option
has shortcut F9.

       OPTION 'RENAME'
       ---------------

       This option allows renaming of the active snapshot file. This option
may be very useful if you call the environment from the emulator (current
snapshot name is TEMP.Z80 in this case). Renaming allows snapshot saving with
any name (first press F10 in the emulator to call the environment, select
renaming, then give wanted name). So, this option is certainly an improvement
of the option F7 in the emulator kernel, that's why this option has the
shortcut F7 in the environment too.

       OPTION 'INFO'
       -------------

       This option shows the header of the current snapshot file. See the
technical part of the manual for a description of the elements of the header.


3.3.2  SUBMENU 'EDIT'
       ==============

       This menu allows changing of the current snapshot file.

       OPTION 'REGISTERS'
       ------------------

       This option calls a large dialog with input lines for entering
register values, and three groups of radio buttons (for selecting the
interrupt mode, and interrupt flip-flops IFF1 and IFF2).

       OPTION 'HARDWARE'
       -----------------

       This option will open a dialog which allows you to select the type of
hardware configuration saved in the snapshot file (e.g. whether the
Interface I is emulated or not, whether the Interface I ROM is paged in or
not, and the border color). In the case of the 128K or Timex snapshots the
state of sound registers, last selected sound register, 128K MMU port, Timex
horizontal MMU register and control register may be changed.

       OPTION 'MEMORY'
       ---------------

       When editing 48K or Timex snapshots, this will start an editor
(hex, decimal or ASCII) for editing all 48K of memory saved in the snapshot
file. For 128K snapshots, you must previously select the page (16K long) to
be edited (0-7). This option has shortcut F3.


3.3.3. SUBMENU 'CONVERT'
       =================

       This menu contains options for converting between the snapshot formats
of many Spectrum emulators, including:

- SPECTRUM, by Pedro Gimeno from Spain;
- VGASPEC, by Alberto Olloqui from Spain;
- SPECEM, by Kevin A. Pair from Ireland;
- JPP, by Arnt Guldbransen from Norway;
- SPECEMU G, by Bernd Waschke from Germany;
- SP UKV, by unknown author from Russia;
- Nuclear ZX, by Radovan Garabik from Slovakia;
- X128, by James McKay from Great Britain;
- SPECTRUM 2.00, by Pedro M. R. Salas from Spain;
- ZX32, by Vaggelis Kapartzianis from Greece.

       Also, it is possible to make some modifications to the snapshot files,
converting snapshot files to TAP files, etc.

       SUBMENU 'SPANISH SPECTRUM <-> WARAJEVO'
       ---------------------------------------

       The SPECTRUM emulator by Pedro Gimeno uses the SP snapshot format.

       OPTION 'SP -> Z80'
       ------------------

       Select the name of the source (SP) and the destination (Z80) file,
using the usual way.

       OPTION 'Z80 -> SP'
       ------------------

       The active snapshot file will be converted into SP format. All data
which is specific to the Warajevo emulator will be ignored. Select the output
filename in the usual way.

       SUBMENU 'VGASPEC <-> WARAJEVO'
       ------------------------------

       The VGASPEC emulator by Alberto Olloqui also uses the SP format, but
it is slightly different. This emulator is an illegal prerelease of the
SPECTRUM emulator by Pedro Gimeno.

       OPTION 'OLD SP -> Z80'
       ----------------------

       Like option 'SP -> Z80'.

       OPTION 'Z80 -> OLD SP'
       ----------------------

       Like option 'Z80 -> SP'.

       SUBMENU 'IRISH SPECEM <-> WARAJEVO'
       -----------------------------------

       The SPECEM emulator by Kevin A. Pair uses the PRG format.

       OPTION 'PRG -> Z80'
       -------------------

       Like option 'SP -> Z80'.

       OPTION 'Z80 -> PRG'
       -------------------

       Like option 'Z80 -> SP'.

       SUBMENU 'JPP <-> WARAJEVO'
       --------------------------

       The JPP emulator by Arnt Guldbransen uses the SNA format. This format
is also supported by Lunter's Z80 emulator, X128, SP_UKV and Wspecem
emulators, and by the XZX emulator for XWindows.

       OPTION 'SNA -> Z80'
       -------------------

       Like option 'SP -> Z80'.

       OPTION 'Z80 -> SNA'
       -------------------

       Like option 'Z80 -> SP'.

       SUBMENU 'SPECEMU G <-> WARAJEVO'
       --------------------------------

       The SpecEmu G emulator by Bernd Waschke uses the SEM format.

       OPTION 'SEM -> Z80'
       -------------------

       Like option 'SP -> Z80'.

       OPTION 'Z80 -> SEM'
       -------------------

       Like option 'Z80 -> SP'.

       SUBMENU 'SP UKV <-> WARAJEVO'
       -----------------------------

       The emulator SP UKV by an unknown Russian author uses the expanded
SNA format, which allows storage of 128K programs.

       OPTION 'SNA 128 -> Z80'
       -----------------------

       Like option 'SP -> Z80'.

       OPTION 'Z80 -> SNA 128'
       -----------------------

       Like option 'Z80 -> SP'.

       SUBMENU 'NUCLEAR ZX <-> WARAJEVO'
       ----------------------------------------

       The Nuclear ZX emulator by Radovan Garabik uses the SNP format.

       OPTION 'SNP -> Z80'
       -------------------

       Like option 'SP -> Z80'.

       OPTION 'Z80 -> SNP'
       -------------------

       Like option 'Z80 -> SP'.

       SUBMENU 'X128 <-> WARAJEVO'
       ---------------------------

       The emulator X128 by James McKay supports many snapshot formats, and
the SLT format. This format is also supported in the WSpecEm emulator, and in
the last release (3.05.) of Lunter's emulator.

SLT is an expanded Z80 format which also includes external levels which are
loaded from tape in the original program (so called MultiLevel Load Trap
support or MLT). That's why conversion to or from this format is a bit
specific.

       OPTION 'SLT -> Z80 + TAP'
       -------------------------

       Select the SLT file which will you want to convert in the usual way.
It will be converted to pair of Z80 and TAP files, where the Z80 file will
contain a pure snapshot, and the TAP file will contain the additional levels.
Overlays are stored in such a way that, for example, an overlay with
identification number 5 will be stored in the TAP file as a fifth block.
However, if the SLT file contains overlays in a non-sequential order, the
missing empty blocks will be created. The MLT support which is implemented in
the Warajevo emulator allows correct working of the program after such
conversion (for more details, look chapter 7.1.). The destination Z80 and TAP
files may be selected in the usual way.

       OPTION 'Z80 + TAP -> SLT'
       -------------------------

       Blocks from the active TAP file and the active snapshot file will be
combined and stored in the destination SLT file (which is determined in the
usual way).

       SUBMENU 'SPECTRUM 2.00 <-> WARAJEVO'
       ------------------------------------

       The Spectrum 2.00 emulator by Pedro M. R. Salas uses the SEM format,
which, unlike all other formats, also stores the ROM image.

       OPTION 'SIT -> Z80'
       -------------------

       Select the name of the source (SIT) in the usual way. Then you will be
asked whether you want to extract the ROM image to a separate file. If you
answer yes, select the filename of the extracted ROM image. After this, you
will be prompted for the name of the destination (Z80) snapshot file.

       OPTION 'Z80 -> SIT'
       -------------------

       The active snapshot file, together with the file ZX48.ROM will be
converted into SIT format. All data which is specific to the Warajevo
emulator will be ignored. Select the output filename in the usual way.

       SUBMENU 'ZX32 <-> WARAJEVO'
       ---------------------------

       We've already said that the ZX32 emulator by Vaggelis Kapartzianis for
Windows 95 uses ZXT (or ZXS) format. This format may contain tapes,
snapshots etc.

       OPTION 'ZXS RIFF -> Z80'
       ------------------------

       Select the source and destination filename in the usual way. During
the conversion, only data related to the snapshots will be extracted from
the source file and converted. ZXS is more complex than Z80, so specific
details during conversion will simply be ignored. This conversion does not
support the compressed ZXT/ZXS format.

       OPTION 'Z80 -> ZXS RIFF'
       ------------------------

       The active snapshot file will be converted into ZXS format. Give the
name of the output file in the usual way.

       SUBMENU 'Z80 (48K) <-> Z80 (128K)'
       ----------------------------------

       The Z80 snapshot format is the most popular snapshot format, and it is
used in the Warajevo emulator, the Z80 emulator by Gerton Lunter, the X128
emulator by James McKay, the XZX emulator by Erik Kunze and Des Harriot, the
ZX JAM emulator by Juan Antonio Moreno, the SPECTATOR emulator for QL by
Carlo Delhez and recently on some other emulators. Warajevo mainly recognizes
all Z80 snapshots (their formats are slightly different), but the program
ZXCOMP recognizes only those snapshots generated from Warajevo without
Interface I emulation. So, this option generates snapshots to be just like
they were created with Warajevo without the option /E. Also, use this option
to ignore additions from Lunter's emulator such as SAMRAM, or ROM images from
snapshots created using the emulator by Pedro M. R. Salas which cause
messages like 'Incorrect hardware version' or 'Incorrect snapshot file'.

       OPTION 'ANY Z80 -> 48K WITHOUT INTERFACE 1'
       -------------------------------------------

       The active snapshot file will be filtered. The new snapshot file is a
dedicated 48K version of the snapshot. Including the details mentioned above,
this option will ignore all 128K additions (if they are present), so there is
no guarantee that the converted program will work (if a converted program
used expanded memory, etc.). You must give the name of the output file. The
default name is the same as the name of the active snapshot, with the prefix
'4' (for example, SNAP.Z80 becomes 4SNAP.Z80).

       OPTION 'ANY Z80 -> 128K WITHOUT INTERFACE 1'
       --------------------------------------------

       The active snapshot file will be filtered. You must give the name of
the output file. The default name is the same as the name of the active
snapshot, with the prefix '1' (for example, SNAP.Z80 becomes 1SNAP.Z80 if you
don't specify otherwise). The new snapshot file is a dedicated 128K version
of the snapshot.

       OPTION 'Z80 SNAPSHOT -> TAP'
       ----------------------------

       This option converts the active snapshot file to a TAP file. The
converted TAP file may be used in the emulator itself, may be sent back to
the original Spectrum using RS232, or may be used (after conversion) in
emulators which don't support snapshot files.

       After running this option, a big dialog appears in which the most
complex item is group of the radio buttons with the name 'Purpose of tape
file'. Due to their complexity, every button will be explained separately:

- Button 'Usable on Warajevo and original machine (lowest screen damage)':

  After this option the BASIC loader on the tape will be such that the last
  block  on the tape will be loaded using the machine routine (without
  header). In such cases, screen damage will be minimal (2 bottom screen
  rows), and in some cases changing additional parameters can completely
  remove screen damaging. Such a tape will work on the Warajevo emulator, and
  on a real Spectrum too (if you make a transfer).

- Button 'Ready to convert to Z80 emulator (medium screen damage)':

  This option is included after the remarks of many Warajevo users. The tape
  which is produced using the previous option unfortunately will not work
  on Lunter's emulator after converting to Lunter TAP format. The problem is
  with Lunter's emulator: his emulation of the loading routine is worse than
  ours, so our extremely optimized machine loader is not compatible with his
  emulator. So, we implement this option which makes it compatibile with
  Lunter's emulator. The price is a bit more screen damage (3 bottom screen
  rows).

- Button 'Ready to convert to Polish emulator (big screen damage)':

  After this conversion, the BASIC loader on the tape will be such that all
  the blocks on the tape will be loaded from BASIC, without the use of
  additional machine code loaders. The consequence is big screen damage (two
  bottom rows, and whole topmost third of the screen). Use this option only
  when you later want to make a conversion of the produced TAP file into the
  formats of emulators which don't support (or badly support) headerless
  blocks (like Irish and Polish emulator).

- Button 'Prepared for copy to Microdrive or Opus':

  After this conversion, the BASIC loader on the tape will be such that all
  the blocks on the tape will be loaded from BASIC using the microdrive
  loading syntax (Opus uses the same syntax). Screen damage will be big. Such
  a tape may be transferred directly to the Microdrive or the Opus disc, and
  the program will work.

- Button 'Prepared for copy to Wafadrive':

  Like the previous option, but the loader will be adapted to the Wafadrive
  loading syntax (Wafadrive is a device similar to Microdrive).

- Button 'Prepared for copy to Disciple or Plus D':

  Like the previous option, but the loader will be adapted to Disciple or
  Plus D disc loading syntax.

- Button 'Prepared for copy to TR-DOS':

  Like the previous option, but the loader will be adapted to TR DOS disc
  loading syntax. The TAP file which is produced using this conversion may be
  directly converted into TRD format using the earlier described option
  'Warajevo TAP -> TRD' without any manual modification of the BASIC loader!

       Besides the described radio buttons, the dialog for this conversion
also contains 2 input lines, called 'Startup Routine address' and 'Startup
register Stack address'. Using these fields, advanced users may totally
remove screen damaging. After loading of the last block, a short machine code
routine (32 bytes) which is located in the screen memory (at address 22240)
sets the initial values of the registers for program execution, state of the
MMU port, border color etc. according to the values which are stored on the
stack (32 bytes, but in Lunter-compatibility case 36 bytes) and in the
screen memory (at address 22500). By changing the addresses which are written
in these 2 input lines, you may change this convention (at your own risk) and
force the startup routine and startup stack to be located at an arbitrary
place in memory which you can guarantee to be empty. If you are a skillful,
this will remove screen damaging. These addresses may not be set in the range
23296 - 25343 (to prevent conflicts with loading of the last block on the
tape), and on the Spectrum 128K addresses 49152 - 65535 are also forbidden
(to prevent conflict with RAM paging). If you don't understand what we are
talking about, do not change these two input fields.

       Conversion of Timex 2068 snapshot files is not implemented yet (it is
quite complicated, because the Timex computer has a loading routine stored in
the alternative EXROM memory bank).

       After you press 'OK', select the name of the output file in the usual
way.


3.4.ˇˇˇ'MDRIVEFILES' MENU
       ==================

       This menu contains options for selecting and manipulating MDR files
which emulate microdrive cartridges. An MDR file is a sequential file with
records called sectors. Sectors are 543 bytes long, and their organization is
similar to real sectors on microdrive cartridges. We will simply call MDR
files "cartridges".


3.4.1. SUBMENU 'MICRODRIVE'
       ====================

       This menu contains options which treat the cartridge like one logical
unit.

       OPTION 'SELECT'
       ---------------

       Selects the current cartridge file (or creates a new one if the
selected cartridge file not exist). All operations in the 'MdriveFiles' menu
will be related to it. This option calls the file selecting dialog to select
the filename. The Spectrum allows 8 microdrives, so the field 'MDV num'
should contain the  microdrive number. This microdrive will be the current
microdrive. The default value is the first unselected microdrive. In a window
with the current filenames (the main window in the environment) the current
microdrive is marked with an asterisk. If you don't want severe problems, you
must not select the same file for two different microdrives. (on a real
Spectrum this is physically impossible). This may cause data damage.

       This option has the shortcut F8. It is like inserting a cartridge into
the microdrive on a real Spectrum. This option sets the parameter /#
described in chapter 2.1.

       If you want to create a new cartridge file, the field 'Sectors' must
contain the desired number of sectors in the file (from 10 to 254, the
default is 254). An unformatted cartridge will be created. If you select 254
sectors per file, the created file will be compatible with Lunter's Z80
emulator, else it will not be.

       OPTION 'UNSELECT'
       -----------------

       This cancels the selection of the active cartridge file (this is like
removing the cartridge from the microdrive on a real Spectrum).

       OPTION 'DEFAULT'
       ----------------

       This option allows the selection of the active microdrive. All
operations in the 'MdriveFiles' menu will be performed on it. The shortcut
for this option is Shift+F8.

       OPTION 'CATALOG'
       ----------------

       This lists the catalog of the logical files on the cartridge file.
Unlike the CAT command in BASIC, this option will show some additional
information about the files (type, length, etc.) which may be useful if you
want to move files to tape, or similar. The display will be like that in
the options from menu 'TapeFiles'.

       OPTION 'FORMAT'
       ---------------

       This formats the cartridge file, like the FORMAT command from BASIC.
You must give the cartridge name.

       OPTION 'OPTIMIZE'
       -----------------

       This option rearranges sectors in the cartridge file in the best way,
so that the optimized file has the minimum access time to all logical files
on it. The original file will be saved with the extension .BAK.

       OPTION 'VIEW'
       -------------

       This views the contents of the current cartridge file as a logical
list of sectors. The logical number of each sector will be displayed,
together with the name of the file allocated in the sector (or 'Unallocated'
if the sector is not assigned to any file). If the sector is allocated, you
can see which record of the file is allocated in the sector, and the number
of bytes in the record. For files created using the PRINT# command, the sign
'PRINT file' will be displayed. Files created using the SAVE* command have 9
bytes of additional information in the first record, which may be seen by
using the option 'Catalog'. This option will display only the type of the
file (BASIC, CODE, etc.). Finally, for EOF records the symbol EOF will be
displayed too.

       The signature 'Unformatted or bad sector' shows sectors which don't
have the correct structure. These sectors may be created only by improper
usage of IN and OUT instructions (for example, using OUT 239,0 after a few
seconds all sectors will become bad). A newly formatted cartridge always has
one or two bad sectors.

       OPTION 'RENAME'
       ---------------

       This option allows you to change the cartridge name (the name given
when formating, not the physical name of the MDR file).

       OPTION 'WRITE PROTECT'
       ----------------------

       This makes the current MDR file write protected by changing its file
attribute to read-only, so this file will be protected when working in the
emulator.

       OPTION 'WRITE UNPROTECT'
       ------------------------

       Cancels the previous option.


3.4.2. SUBMENU 'SECTORS'
       =================

       This menu is dedicated to manipulation of individual sectors on the
cartridge file.

       OPTION 'VERIFY'
       ---------------

       This option checks the correctness of a sectors logical structure.
After you select the sector, a message 'This sector is OK' will be displayed
if the sector is good, else you are asked 'Adjust this sector?'. Select OK if
you want to correct the logical sector structure. Using this option you can
repair unformatted or bad sectors, or sectors which have been damaged by
incorrect use of the option 'Edit'.

       OPTION 'EDIT'
       -------------

       This option allows you to directly change the sector content. You can
select whether you want to change only the actual sector data (512 bytes) or
the whole sector (543 bytes) including system data (this is dangerous if you
don't know what you are doing). The organization of the sector is given in
the technical part of the manual. The editor is similar to the editor for
editing snapshot files, so it allows decimal, hex or ASCII editing.

       Changing only the actual sector data will always the preserve correct
logical structure of the sector, but changing the whole sector needs manual
correcting of some control bytes in the sector, to retain integrity. If you
damage the sector structure, you can correct it using the option 'Verify'.


3.4.3. SUBMENU 'FILES'
       ===============

       This menu is dedicated to manipulating individual logical files on the
 cartridge file.

       OPTION 'DELETE'
       ---------------

       Select the file which you want to delete from the cartridge, and it
will be deleted. This is similar to the ERASE command in BASIC.

       OPTION 'RENAME'
       ---------------

       Using this option you can change the name of a logical file stored on
the cartridge. Select the file to be renamed in the usual way.

       OPTION 'HIDE'
       -------------

       The command CAT from BASIC will not display the names of files which
have the character CHR$ 0 as the first character of the name (hidden files).
The option 'Hide' changes the name of the selected file by appending CHR$ 0
to the beginning of the name, so this file will become invisible to the
CAT command.

       OPTION 'UNHIDE'
       ---------------

       This option makes a hidden file (selected using the usual method)
visible again.

       OPTION 'COPY'
       -------------

       This option allows you to copy files from one cartridge file to
another. Select the file which will be copied, and enter the destination
microdrive in the input line. This option will delete any file with the same
name on the destination cartridge file.


3.4.4. SUBMENU 'CONVERT'
       =================

       This menu is dedicated to converting the MDR format into the cartridge
formats of other emulators.

       OPTION 'ENLARGE MDR TO 254 SECTORS'
       -----------------------------------

       At the moment, this is the only option in this menu. It enlarges the
active cartridge file to 254 sectors (if it was shorter than 254 sectors), so
that it becomes compatible with Lunter's emulator. Newly created sectors will
not be formatted.


3.5.   'DOCKFILES' MENU
       ================

       This menu contains options for selecting and manipulating DCK files
which emulate the various memory expansions of the Timex Sinclair 2068. The
format of such files is described in chapter 7.9.4.


3.5.1. SUBMENU 'DOCKS'
       ===============

       This menu contains options for the selection and viewing DCK files.

       OPTION 'SELECT'
       ---------------

       Selects the active DCK file. All operations in the 'DockFiles' menu
will be related to this file. This option sets the switch /E described in
chapter 2.1.

       OPTION 'UNSELECT'
       -----------------

       Cancels the selection of active DCK file.

       OPTION 'VIEW'
       -------------

       This option shows information about the current DOCK file, like bank
ID number, status of each chunk in the bank, etc.

       OPTION 'MERGE'
       --------------

       This option allows you to merge one DOCK file and another. After you
select this option, you will be asked for the name of a DCK file which will
be merged with the current DCK file. This is possible only if two DOCK files
do not use the same memory space. This option is the equivalent of making a
cartridge on a real Timex which has everything stored on two other cartridges
which do not use the same memory chunks (one LROS and one AROS for example,
or one program in DOCK and second in EXROM bank, etc.).


3.5.2. SUBMENU 'CONVERT'
       =================

       This option is dedicated to the conversion of LROS and AROS programs
which you have in the form of a binary cartridge dump on the disk (how you
got such a file is not important) into a valid DCK file which is usable in
the Warajevo emulator. By the way, at the moment we only have five usable DCK
files, so if somebody has a binary dump of any LROS or AROS program, please
send it to us!

       OPTION 'ROM TO DCK'
       -------------------

       You will be asked for the name of a ROM file (16 Kb long), then for
the name of the resulting DCK file. This option will make a DCK file which
will be loaded into the HOME bank, so that the DCK file can replace the
standard Timex HOME ROM. For example, if you convert ZX48.ROM into TS2048.DCK
and select the TS2048.DCK file as the active DCK file (using the environment,
or TS2068 /ETS2048) you will get Timex Sinclair 2048 emulation!

       OPTION 'BINARY TO LROS'
       -----------------------

       You will be asked for the name of a binary file, then for the name of
the resulting DCK file. This option assumes that this file is a dump of a
LROS program (mapped at address 0 in DOCK bank). If the length of the source
file is not divisible by 8192, the converted file will be filled with zeros
to the appropriate length. The source file need not be a real LROS (with a
five byte LROS header at address 0), the only important thing is that the
converted file will be mapped at address 0 in the DOCK bank. For example, if
you convert ZX48.ROM into SPECEMU.DCK using this option, you will get a DCK
file which emulates the well-known Spectrum emulator cartridge for the Timex
(The Spectrum emulator must be started with OUT 244,3 - Timex users know what
this is).

       OPTION 'BINARY TO AROS'
       -----------------------

       You will be asked for the name of a binary file, then for the name of
the resulting DCK file. This option assumes that this file is a dump of some
AROS program (mapped at address 32768 in DOCK bank). If the length of the
source file is not divisible by 8192, the converted file will be filled with
zeros to the appropriate length.


3.6.   'DATABASE' MENU
       ===============

       The environment allows you to manage a database of Spectrum software
(program name, category, producer, year of production etc.). With every
program you can also keep some additional text (e.g. POKE's for infinite
lives). Also, it is possible to assign data about where the program is
located (on which tape or snapshot file), in which directory, on which
diskette, etc. and which command parameters the program needs. There are
options which allow you to start programs by name using data from the
database, so the emulator will automatically set the appropriate directory,
drive, command line parameters, etc. If correctly used, the options in this
menu are the most powerful options in the whole program.

       The database consists of 3 files:

SOFTWARE.DBF - Main database
SOFTWARE.DBT - Text assigned to records in the main database
ADDITION.DBF - Database with additional linked data

If one of these files doesn't exist, the program will create a empty one. The
database has a format which is compatible with DBASE programs (see chapter
7.9.7.).

       For using a database, a hard disc is vital. If you have a very slow
computer, working with a big database (above 500 records) may be rather slow.
In such cases, it is recommended that you split the database into smaller
databases (it is possible for each data base to be located in a different
directory).

       Working with the database needs some preparation, that's why calling
options from this menu for the first time may take some time, especially if
the database is long.


3.6.1. SUBMENU 'DBF DIRECTORY'
       =======================

       This menu is dedicated to selecting the database directory. This
allows you to have more than one database (in different directories) on the
disc. We recommend splitting into several databases if you have more than
5000 records, to avoid overuse of memory.

       OPTION 'SELECT DIRECTORY'
       -------------------------

       Using this option you can select the database directory. All options
from the 'DataBase' menu will be related to the database in this directory.
Select the directory as you would for 'Change directory' in the 'Dos' menu
(see chapter 3.8.).

       OPTION 'UNSELECT'
       -----------------

       This cancels the selection of the database directory using the
previous option. After this option the active database will be the database
in the same directory as the environment.


3.6.2. CREATING AND EDITING THE DATA BASE (OPTION 'EDIT')
       ==================================================

       Although the option 'Run' is before this option in the menu, the
option 'Edit' will be described first, because the database must be created
first. After selecting the option 'Edit' (which has the shortcut F6), you
will see on screen a list box for listing the database records (if the
database is not empty, the current record is highlighted). The list box may
be scrolled in all four directions using the method described earlier (see
chapter 3.1.). Unless the database is empty, you can see that every record in
the database is split by vertical lines into 9 fields. In fact, there are
still 5 fields in each record (total of 14 fields), but these fields are not
displayed in the list box. Before the explanation of the creating and editing
process, we will first explain the meaning of each field, from left to right.
Some fields (but not all) may remain empty.

       DESCRIPTION AND MEANING OF THE FIELDS
       -------------------------------------

       The first field is called 'Short name'. This field is important for
automatically running programs from the database. If you run the environment
from DOS giving this name as a parameter, the given program will
automatically be loaded and started using the data from the database. For
example:

WARAJEVO ATICATAC

will search for a record with the short name 'ATICATAC', run the emulator,
and automatically load and run the program 'Atic Atac' using the data in this
record. This field must not be empty.

       The next field is called 'Full name'. The short name is limited to 10
characters, so often it can't be descriptive enough. That's why you can store
the full name of the program. This field must not be empty.

       The third field has the title 'Software distributor or producer'. This
field should contain the name of the company which produces or distributes
the Spectrum program (Ultimate, for example).

       In the fourth field, called 'Category of the program', you can enter
the category of the Spectrum program (for example, Arcade adventure, Logical
game, Painting program, etc.).

       The next field ('Year') is used for entering the year when the program
was produced.

       The sixth field, called 'Machine type' contains the computer type
which the Spectrum program needs for correct execution. This field may
contain '16', '48', '2068', '128', '+2', '+3' or 'SAM' (the last means Sam
Coupe, not Lunter's SamRam). If this field contains '16' or '48', the 48K
emulator will be executed when you run this program from the database. When
this field contains '2068', the Timex emulator will be executed, and in all
other cases, the 128K emulator will be executed (emulation of Spectrum +3 and
Sam Coupe are not yet implemented).

       In the next field ('Message language') the user may enter the language
on which program messages are displayed (this allows you to make a
distinction between programs which display messages on English and Spain, for
example).

       The eighth field, 'File Name', is very important. It contains the name
of a tape file, snapshot file, cartridge file, or even another file in the
format of some other emulator, on which the Spectrum program is located.
Later, we will see that this field is linked to the descriptor which describes
whether is it a tape, snapshot, cartridge file, or something else, on which
disc and directory this file is located, and the diskette name if the file is
on the floppy disc. This field may be empty only if you don't want to run
programs from the database.

       The last field displayed in the list box is 'Position'. It is used to
determine the position of the Spectrum program (block) in a tape file if you
the previous field says that this program is located on a tape file.

       The meaning of the other fields which are not displayed in the list
box will be explained later.

       DIALOG FOR DATA BASE BROWSING
       -----------------------------

       The dialog for database browsing contains the list box described
above, and the buttons 'Edit', 'Append', 'Delete', 'Seek' and 'Close'.

       'Edit' is used for editing the current record, and the button 'Append'
is used for appending a new record (it is only a valid option when the
database is empty). The procedure for entering and changing the records will
be described soon.

       'Delete' deletes the current record from the database. If the database
is very large this may be rather slow, so it is recommended to use some
database management program like DBase if you want to delete a big group of
records. Also, the record deleting will not delete the assigned memo block
(see the next section, field 'Remark') in the file SOFTWARE.DBT. To delete
such a block, you must use the DBASE program (or something similar), the
command COPY TO, or some memo file packer.

       'Seek' allows fast seeking to any desired record. After activating
this button, a dialog appears with input lines assigned to records in the
database. Enter the lines assigned to fields which you want use for seeking,
and leaver the other lines empty. Wildcards ? and * are allowed (with the
same meaning as in DOS). Then, click the 'OK' button, and you will be moved
to the first record with a structure like the entered structure. For example,
if you want to move to the record with short name PENETRATOR, you may enter
PEN* in the input line 'Short name' and then select 'OK'.

       'Close' simply closes the dialog used for browsing the data base (like
'Cancel'). The same thing can be achieved using Esc.

       ENTERING AND CHANGING RECORDS
       -----------------------------

       After using 'Edit' or 'Append', a large dialog for entering or
changing the records will appear. Different fields need different methods for
editing, so it will be described in detail.

       The fields 'Short name', 'Full name', 'Year', 'Command line' and
'Position' may be entered simply by entering the desired text into the
assigned input lines. The field 'Command line' is not displayed in the list
box when you browse the database, but in this field you can enter the command
parameters (for example, /JK /Q100) which are needed for the Spectrum program
to be emulated correctly when you want to run the program using a database.

       The field 'Remark' (this field will not be displayed in the database
browser either) allows the user to enter some text up to 512 bytes long,
using an embedded ASCII screen editor, which contains some additional remarks
about the Spectrum program (for example, POKE's for infinite lives in some
games, hints for solving a game, name of the magazine in which this program
is described etc.). The entered text will be stored in the file SOFTWARE.DBT.
In additions to standard cursor movement, the embedded editor understands
many editing commands which are seen in the Borland compilers.

       The field 'Machine type' may be entered using a group of radio
buttons.

       The field 'Software producer or distributor' must be entered using a
specific method. This field is linked to a list box. It will contain all the
program categories used earlier. If you want to select an existing category,
simply highlight it using the arrow keys or a letter key. But if you want to
enter new data (this is only solution when the database is empty), press the
'Insert' key and type the desired category. Why do we assign the list box to
this field, instead of an input line like with the other fields? The reason
is as follows. The text which describes the producer name may be relatively
long, but there are not that many different producers. It would be irrational
to keep the whole text in each database record. So, the main database
contains only internal codes (for example, U002 instead of 'Ultimate'), but
the separate file (ADDITION.DBF) contains text linked to the stored codes.
Using this method the main database made smaller. The list box contains the
producers entered earlier, so the selection of a previously used producer
will not make the database larger. If you want to edit a previously used
producer name, highlight it, then press the right arrow. You will enter edit
mode. If you want to delete the highlighted item, press 'Delete'.

       The fields 'Category' and 'Message language' may be entered using the
same way as 'Software producer or distributor'.

       Entering and changing 'Tape name' is similar, but here pressing
'Insert' will open a dialog which contains one group of radio buttons named
'File type' and 4 input lines. Using the radio buttons you can select whether
the current Spectrum program is located on a tape file, snapshot file,
cartridge file (in this case automatic running is not possible), or in some
other format (option 'Full name in Path field'; in this case automatic
running is performed by passing a file to the 'Start' button which is
described in chapter 3.9.). The input line 'File name' must contain the name
of the TAP (Z80, MDR) file, and the input line 'Path' must contain the drive
and directory on which the file is located (with the option 'Full name in
Path field' the field 'Path' must contain not only the path, but the full
filename including path and extension, and in this case the name in 'File
name' is only an alias). The input line 'Volume label' may optionally contain
the diskette name if the program is located on a floppy disc. This allows the
emulator to produce an error message if you insert the wrong diskette into
the drive when you try to run program. In the input line, which is located
after 'Input name' field and is marked as (  ), you may optionally type an
internal two-character identification code, which allows you to have 2 files
with same name (in different directories or on different discs). This is
necessary due to 'File name' being the key field, that's why it must be
unique. So, we append to this field an identification code, which makes this
field unique when the filenames are the same. 'Browse' automates entering
the fields in this dialog in the usual way, and there are also the standard
'OK' and 'Cancel'.

       'Sort marker' (not displayed in the database browser) may have only
one of two states: marked or unmarked. It's state may be set using the
assigned checkbox. For the meaning of this field, see chapter 3.6.5.

       'Problems' (also not displayed in the data base browser) describes
problems which appear with some programs. Unfortunately, our emulator is not
perfect, so it is good idea to keep in the database the types of problems
which may appears with the corresponding program. Activating the checkbox
linked with this field will open a second dialog (will be described later)
which allows more detailed setting of this field.

       After you have entered or modified the record, use 'OK' to accept
changes, or 'Cancel' to discard changes. Esc acts like 'Cancel'.

       DIALOG FOR EXPLAINING OF PROBLEMS
       ---------------------------------

       The dialog for problem explanation contains a group of checkboxes.
Activate a checkbox if the problem described beside it appears with the
assigned program. For example, activate the checkbox 'Flickering' if sprites
in the assigned program flicker too much. For an explanation of possible
problems see chapter 8.


3.6.3. RUNNING PROGRAMS FROM THE DATA BASE (OPTION 'RUN')
       ==================================================

       After you create the database, you can use it. Of course, you can
simply browse data in the database, but you can also start programs using
data in the database. 'Run' gives this facility (shortcut Shift+F10).

       This option opens a list box for database browsing like in the 'Edit'
option. First, select the desired Spectrum program using the list box. Then
you have two possibilities:

- If you select 'Select', all the data associated with this program (like
  tape/snapshot/cartridge name, directory, command parameters etc.) will be
  activated, but you will not leave environment after this.

- If you select 'Run', all the data associated with this program will be
  activated too, but the emulator will be immediately executed and automatic
  loads and runs the selected program.

       When the program is in a snapshot file, automatic running is performed
according to the snapshot file. When the program is on a tape file, autorun
is performed using the command /A (it will be automatically inserted for you
in this case), and when the program is on a cartridge file, automatic running
is not possible. Instead, you must use the command LOAD* from BASIC.


3.6.4. SORTING THE DATA BASE (OPTION 'SORT')
       =====================================

       The database can be sorted by various fields. If you don't state
otherwise, the database will be sorted by the 'Short name' field. Using this
option you will see a dialog with checkboxes in which you can define other
sort criteria. The order of setting checkboxes is important (for example, if
you first set 'Category' then 'Full name', the database will be sorted first
by 'Category' and then by 'Full name'. To help you, the dummy input line
'Sorting order' will display the current sorting order, using the following
abbreviations:

S - Short name
F - Full name
P - Software producer or distributor
C - Category of the program
Y - Year of production
M - Machine type
L - Message language
T - Tape name and position

        The database is not sorted psychically, but manipulates pointers which
are created in memory after the first use of the database (that's why the
first access needs some time). The pointer table will be removed from memory
if some other option requires additional memory space. If you want to use the
database again, the index table is recreated, but it will take some time so
it is not recommended to keep switching from 'Database' to other options.

       When you leave the environment, the index table will not be saved on
disc. So, how does the program know the sorting criteria when you rerun the
program? The command parameter /&O described in chapter 2.1. is used. For
example, if you want to sort by category and then by full name, put the
command /&OCF into DEFAULT.CFG.


3.6.5. SUBMENU 'MARK SORT PRIORITY'
       ============================

       Every record in the database contains a 'Sort marker' field. If this
field of the record is set (we say that this record is marked), this record
will be (logically) moved to the end of the database, regardless of the
position where this record is normally located. Using marking you can put
records which are not used very often at the end of the database. Also, using
marking you can select which records will be included in a report (see
chapter 3.6.6.).

       OPTION 'CONDITIONAL'
       --------------------

       Using this option you can set a sort marker. When you select this
option a dialog similar to the 'Seek' option. After selecting OK, all records
which look like the entered mask will be marked (e.g. logically moved to the
end of the database). As in the 'Seek' option, the wildcards ? and * are
allowed.

       If you want to mark only one record, the easiest method is to set this
field during record editing.

       OPTION 'SWAP MARKER'
       --------------------

       This option will mark unmarked records and unmark marked records. When
correctly used, this option makes some operations easier. For example, if you
want to organize the database to put arcade adventures at the BEGINNING of
the database, first mark all such records using the previous option (this
will move such records to the END of the database), then use this option to
toggle the markers.

       OPTION 'UNMARK ALL'
       -------------------

       This option simply unmarks all marked records in the database.


3.6.6. CREATING OF THE REPORT (OPTION 'REPORT')
       ========================================

       The environment allows creation of reports about the database, which
may be printed on the printer, screen or a text file. Using a dialog, you may
select which fields will be included in the report, select the output device,
select whether you want to print all records, only marked or only unmarked
records, and select the dimensions of the paper.

       The reports are organized in such a way that each record will be
printed on a new line. If you select too many fields in the report, some
fields may be truncated (due to limited paper width) but this will be done
optimally.

       If you include the 'Problems' field in the report, problems will be
printed as a coded string, using the abbreviations described in chapter 8.

       The input lines 'Paper length' and 'Printable lines' should contain
the paper length in lines (default 72) and the number of effectively printed
lines on the paper (it should be slightly smaller, default is 66). The line
'Report width' should contain the number of characters in one row.

       Using the radio buttons 'Printer type' you may select your printer
type. These buttons determine the necessary control codes, and maximal usable
report width. If you select an ASCII printer, control codes will not be sent.
The maximum usable report widths in characters are:

ASCII A4:                    80 characters
ASCII A3:                    132 characters
Epson A4 Pica:               80 characters
Epson A4 Compressed:         132 characters
Epson A4 Elite Compressed:   160 characters
HP LaserJet Courier:         80 characters
HP LaserJet Compress:        132 characters
Epson A3 Pica:               132 characters
Epson A3 Compressed:         200 characters
Epson A3 Elite Compressed:   255 characters


3.6.7. SUBMENU 'CONVERT'
       =================

       This menu allows conversion of the Warajevo database into other ZX
Spectrum database format, including:

- SPECPIC, by Andreas Schrapnel and Jahn Claus from Germany;
- SGD, by Martijn Van Der Heidne from Netherlands;
- ZX RAINBOW, by Jahn Claus from Germany;
- SPECBASE, by Rodolfo Edison Guerra from Uruguay.

       During conversions, all fields particular to the source database
which are not supported in the destination database, will be ignored.

       OPTION 'WARAJEVO -> SPECPIC'
       ----------------------------

       The active Warajevo database will be converted into the SpecPic
database format which consists of 8 files with the names DATABASE.TBL,
PROGNAME.TBL, SPECIALS.TBL, PROGTYPE.TBL, PRODUCER.TBL, AUTHORS.TBL,
COUNTRY.TBL and PROGPATH.TBL. You must confirm the selection of this option.
Any previous SpecPic database will be erased.

       OPTION 'WARAJEVO -> SGD'
       ------------------------

       The active Warajevo database will be converted into the SGD database
which is stored in the file GAMES.DAT. The user must confirm the selection
of this option. Any previous SGD database will be erased. The SGD database
format doesn't contain data about program paths, so they will be ignored.
Also, 'Category' will be truncated to 7 characters due to the limitations of
the SGD format. The language field is not converted because we only support
release 1.24 (it was introduced in release 1.32.). The command line field is
checked only for joystick items.

       The author of the SGD format changes the database format from release
to release. Currently, this converts to the format of release 1.24. The older
versions probably will not be able to read this format, but fortunately, new
versions can automatically upgrade from previous versions.

       OPTION 'WARAJEVO -> ZX RAINBOW'
       -------------------------------

       The active Warajevo database will be converted into the ZX Rainbow
database format which consists of 10 files with the names DATABASE.TBL,
PROGNAME.TBL, SPECIALS.TBL, PROGTYPE.TBL, PRODUCER.TBL, AUTHORS.TBL,
COUNTRY.TBL, PROGPATH.TBL, STARTUP.TBL and VOLUMES.TBL. You must confirm the
selection of this option. Any previous ZX Rainbow database will be erased.

       OPTION 'WARAJEVO -> SPECBASE'
       -----------------------------

       The active Warajevo database will be converted into the SpecBase
database format which consists of the files SPECBASE.DBF and SPECBASE.DBT.
You must confirm the selection of this option. Any previous SpecBase database
will be erased.

       OPTION 'SGD -> WARAJEVO'
       ------------------------

       Using the dialog select the name of the DAT file (SGD database) which
you want to convert. The converted database will be appended to the active
Warajevo database. This conversion also looks at the content of the SGD file
SGD.INI and its GameDir property, to determine the paths to programs which
are described into database. The author of the program SGD changes the
database format from release to release. The received data depends upon the
version of the DAT file. We can read data up to version 1.32. For very big
databases, this conversion may take a lot of time (15 minutes or more).

       In earlier releases, we noticed problems with the conversion of the
"World of Spectrum" SGD database into the Warajevo format. Namely, the
Warajevo database unfortunately has limitations of the number of records in
the database, due to the limitations of the DOS (sorting indexes, producer
names, and file names are stored into the RAM to speed up working with the
database). When the Warajevo is developed, we simply did not expect such huge
databases! Now, we included 3 checkboxes to ignore sorting, producer names and
file names if the database is too huge, what is the case with the WOS archive
database. Without sorting and producer names Warajevo can handle not only
GAMES.DAT, but also complete SGD database (90K still remains free). Of course,
this a first aid, not an ideal solution, and we are now searching for a better
solution...

       OPTION 'SPECPIC -> WARAJEVO'
       ----------------------------

       Before using this option, you must be in the directory which contains
the SpecPic data base. The converted data base will be appended to the active
Warajevo database.

       OPTION 'ZX RAINBOW -> WARAJEVO'
       -------------------------------

       Before using this option, you must be in the directory which contains
the ZX Rainbow database. The converted database will be appended to the
active Warajevo database.

       OPTION 'SPECBASE -> WARAJEVO'
       -----------------------------

       Before using this option, you must be in the directory which contains
the SpecBase database. The converted database will be appended to the active
Warajevo database.


3.7.   'SETUP' MENU
       ============

       This menu is used for easily setting various command parameters which
control the emulation (these parameters are almost all parameters described
in chapter 2.1.). All options from this menu will open a dialog which allows
easy modification of parameters.

       OPTION 'EMULATOR'
       -----------------

       Using this option you can select whether you want to emulate the
Spectrum 48K, Spectrum 128K or Timex Sinclair 2068. If a snapshot file is
selected, the type of emulation will be automatically determined from the
header, but we allow manual entering of emulation type (this is necessary if
you want to run a 'pure' emulator without a snapshot file). A new feature
introduced in release 2.5. is the possibility of switching from the 48K
version to the 128K version without resetting. Other combinations of mode
switching cause the resetting of the emulator so as to prevent an 'Incorrect
hardware version' error message.

       OPTION 'VIDEO'
       --------------

       This option allows the setting of the video graphic card, mode of
attribute emulation on monochrome cards, default palette in color CGA mode,
moment of screen updating in partial video emulating mode, mode of border
emulation, switching on multicolor emulation, and parameters related to
multicolor emulation. For details about using this option look at the
descriptions of the commands /V, /M, /Q, /QX and /U in chapter 2.1 and the
online help for this option. It has shortcut key F5. Be aware of the fact
that the dialog for this option changes itself when some options are turned
on or off. For example, if the border emulation is not set to 'Rainbow', you
will not have the option for switching on multicolor mode, and if the
graphics card is not 'VGA' or 'Autodetect' you will not have the option of
turning on the 'Rainbow' border!

       OPTION 'SPEED'
       --------------

       Using this option you may easily change the speed of the emulator. The
parameter 'Speed in % relative' may be changed by directly entering the
numeric value, or using the horizontal scrollbar. Activate the 'Maximal speed
mode' checkbox if you want to use the maximal possible speed of the emulator.
Activate the 'Maximal loading speed' checkbox if you want to maximize the
loading speed of emulated tapes which retain full compatibility. For more
details, see the descriptions of the options /%, /%MAX and /%LMAX in chapter
2.1.

       OPTION 'TEST'
       -------------

       Using this option, you may include or exclude various tests, like the
testing for use of 128K Spectrum features during 48K emulation, or testing
for the presence of 'Escape' sequences. Also, you can set a time after which
returning to the environment or DOS will occur. For more details, see the
descriptions of the commands /?128, /?86 and /@ in chapter 2.1.

       OPTION 'NETWORK'
       ----------------

       Using this option, you may set the name of an interface file for
Sinclair Network emulation, and other parameters of the network emulation.
The dialog for this option contains an input line for entering the name of
the interface file, and 3 input lines for entering other emulation
parameters. The input line for entering the name of the interface file is
linked to a 'Browse' button, which allows you to select the file using a file
selection dialog. For more details, see the description of the command /#N in
chapter 2.1, and the description of the network emulation in the user and
technical parts of the manual.

       OPTION 'SOUND'
       --------------

       Using this option you can select whether you want sound emulation,
which device will be used for tape emulation (TAP files, LPT port or Sound
Blaster), and setup data for the Sound Blaster card (default values are read
from the BLASTER variable in DOS environment). If the 128K or Timex emulation
is selected, you may also select which device will be used for AY chip
emulation and, if the device is the PC beeper, which AY channels will be
emulated. For more details, see the descriptions of the commands /U, /S and
/L in chapter 2.1. This option has the shortcut key F4 (like the similar
option in the emulator kernel).

       OPTION 'INTERFACE 1'
       --------------------

       Using this option you can select whether you want ZX Interface 1
emulation and, if you do, whether you want only 8 K paging or full 16 K
paging and whether you want the old or new ROM. A similar effect has the
command parameter /E as mentioned in chapter 2.1.

       OPTION 'JOYSTICK'
       -----------------

       Using this option you can select the type of the joystick emulation,
and the calibration constants for the analogue joystick (this makes sense
only if you select analogue joystick with manual calibration). You can set
more than one joystick emulation simultaneously, but not all combinations are
valid. For details, see the description of the command parameter /J in
chapter 2.1.

       OPTION 'PRINTER'
       ----------------

       This option determines the type of ZX printer emulation. For details,
see the description of the command parameter /P in chapter 2.1.

       OPTION 'ROM'
       ------------

       This option allows you to set some parameters related to the emulation
of the ROM of the ZX Spectrum. Firstly, you can select whether you want
faster execution of BASIC programs, and the display of the inverted cursor in
monochromatic modes. With 128K emulation you can determine whether you want
emulation of an ordinary Spectrum 128 or Spectrum +2. For more details, see
the descriptions of the command parameters /B, /K and /2 in chapter 2.1.

       OPTION 'MS WINDOWS'
       -------------------

       This option allows you to set some parameters related to MS Windows
compatibility, including whether the emulator shows a warning in 'virtual
8086' mode, whether the emulator should install a task switch handler to
refresh screen garbage after a task switch, and whether the emulator should
prevent any access to the printer. The last two options work only if the test
for 'virtual 8086' mode is disabled. For more details, see the description of
the command switch /! in chapter 2.1.


3.8.   'DOS' MENU
       ==========

       This menu contains some familiar DOS operations.

       OPTION 'ABOUT'
       --------------

       This displays some information about the program.

       OPTION 'DIRECTORY'
       ------------------

       This option displays all files in the current directory.

       OPTION 'CHANGE DIRECTORY'
       -------------------------

       This option allows you to change directory, by typing the name into
the input line, or by using a directory tree which looks like the following
picture:

             ⁄ Directory Tree ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒø
             ≥   Drives                            ≥
             ≥   ¿ƒ¬C:\                            ≥
             ≥     ¿ƒ¬WINDOWS                      ≥
             ≥       ¿ƒƒSYSTEM                     ≥
             ¿ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ

The directory tree enables you to move through directories by using the
selection bar and pressing ENTER. The 'ChDir' button changes the current
directory once you've selected or typed in the new directory name. The
'Revert' button goes back to the previous directory.

       OPTION 'OS SHELL'
       -----------------

       This temporarily leaves the environment and exits to DOS. To return to
the environment type EXIT.

       OPTION 'EXIT'
       -------------

       Leaves the environment and exits to DOS. The same effect may be done
using ALT+F4 (like MS Windows) or ALT+X (like Turbo Pascal).


3.9.   'START' BUTTON
       ==============

       The 'Start' button is located in the bottom left corner of the screen,
like in Windows 95 (this is not real button, but a field in the status line,
which may be activated using Alt+S). It is implemented to make running of
Spectrum programs easier, and not only programs in Warajevo format (TAP, Z80,
MDR and DCK), but also programs in the formats of other emulators (SNA, BLK,
SNP, TZX, SLT etc.) and even programs which are archived in ZIP files.

       After activating the 'Start' button, a file selection dialog will
appear. If you select a Warajevo file (TAP, Z80, MDR, DCK), it will be passed
to the emulator, and started (in the case of a TAP file using the parameter
/A without additional parameters like /F for example, will start the first
program on the tape, in the case of MDR files the program on the cartridge
with the name 'run' will be started, and in the case of DCK files, the DCK
file will be loaded, but started only if it contains auto-boot programs like
LROS or AROS programs). But, if you select a file which is not in a Warajevo
format (for example, SNA, SP, BLK, SNP, TZX, LTP, VOC, SIT etc.), the
environment will perform automatic conversion into a Warajevo file TEMP.Z80
or TEMP.TAP (depending on whether the selected file is a snapshot or tape
file), passes this converted file to the emulator, and starts it (all these
things will take very little time, practically instantaneous, except with
very complex formats like TZX, or with huge formats like VOC).

       When the selected file is a TZX file, 'Hardware Info' and 'Emulation
Info' blocks will optionally be taken into consideration (depending of the
settings in 'TZX conversion setup'. 'Hardware Info' checks whether the
program uses 128K or Timex features and in that case switches the emulator
into 128 or Timex mode; if the computer for which the program is designed is
not supported, conversion will fail; if a peripheral which the program uses
is not supported, it will be ignored. From 'Emulation Info' blocks only bits
2, 6 and 9 are considered. For more information, read some documents on the
TZX format. If a TZX file contains a 'Snapshot' block, it will be extracted
and started, or ignored (depending on settings), and the remaining blocks
will be converted to a TEMP.TAP file. Be aware of the fact that the
conversion of a TZX file will be performed according to the rules which may
be customized using the 'TZX conversion setup' option described earlier and
using the switch /&T in the configuration file.

       If you select a SCR file (Spectrum Image file), the emulator will be
immediately started with the screen displayed, then the emulator will enter
into an endless loop (of course, F10 will return into the environment). This
allows not only screen viewing, but also saving the screen onto a tape using
the embedded monitor (press F3, then give the command S16384 6912 'Filename').

       If you select a file with the extension .ZIP (archived file), the
emulator will create a temporary directory called ZIPRUN (as a subdirectory
of the directory which is determined using the DOS environment variable
WARAJEVO), erases its content if it was previously created, and then, by
calling the program PKUNZIP.EXE (which must be located in the currently
active path set using the DOS command PATH) unpacks the archive into this
directory. After unpacking, if the archive contains only one file, then the
emulator will deal with this file like in previous cases. But, if the archive
contains more files, a new dialog appears which allows the user to select
which file will be started (using the previously described algorithm).

       This is a list of formats currently supported by the Start Button:

Z80, TAP (Lunter), TAP (Warajevo), BLK, SPC, LTP, TZX, ZXS (Museum),
ZXS (ZX32), ZXT (ZX32), VOC, SLT, SNA (48), SNA (128), SP (VGASPEC),
SP (Spec 0.99), PRG, SEM, SIT, SNP, SCR, MDR, DCK and ZIP.


3.10.  THE FUNCTION KEYS IN THE ENVIRONMENT
       ====================================

       In this chapter we will sumarize all the function keys which may be
used in the environment of the Warajevo emulator. For more detailed
descriptions see the explanation of the corresponding options in the previous
text. Selection of the function keys is performed in such a way that the
key is analogous to the meaning of the keys in the emulator kernel itself.

 F1           - Calls the detailed and topic sensitive HELP system.
                Highlighted items may be selected using the mouse or TAB /
                CTRL + TAB.
 F2           - Opens a dialog for selecting the active tape file.
 F3           - Opens a editor for modifying the memory image of the active
                snapshot file.
 F4           - Opens a dialog for setting options related to sound.
 F5           - Opens a dialog for setting options related to the emulation
                of the video system.
 F6           - Opens a dialog for creating and changing the database.
 F7           - Changes the name of the active snapshot file. Using this
                option you can save the snapshot file from the emulator with
                arbitrary name (combination F10 + F7).
 F8           - Opens a dialog for selecting the active cartridge file.
 F9           - Cancels selection of the active snapshot file. If the
                environment is called from the emulator, returning to the
                emulator will perform a system reset, e.g. the running of a
                'pure' emulator.
 F10          - Calls the emulator, or returns to the emulator if in the
                environment. If the environment is in graphic mode, double
                clicking the mouse on the 'Screen' window has the same
                effect.

 Shift + F2   - Opens a dialog for setting the parameters assigned to the
                active tape file.
 Shift + F7   - Opens a dialog for selecting the active snapshot file.
 Shift + F8   - Opens a dialog for selecting the default microdrive number.
 Shift + F10  - Allows you to run a program using the data in the database.

 Alt + F2     - Displays the content of the active tape file.
 Alt + F4     - Leaves the environment and exits to DOS or Windows (as used
                in MS Windows).
 Alt + F5     - Expands the current window to full screen size (if this is
                allowed for the current window).
 Alt + T      - Activates the 'TapeFiles' menu
 Alt + Z      - Activates the 'Z80Snaps' menu
 Alt + M      - Activates the 'MdriveFiles' menu
 Alt + C      - Activates the 'DockFiles' menu
 Alt + B      - Activates the 'DataBase' menu
 Alt + U      - Activates the 'Setup' menu
 Alt + D      - Activates the 'Dos' menu
 Alt + S      - Activates the 'Start' button
 Alt + X      - Leaves the environment and exits to DOS or Windows (as used
                in Turbo Pascal).

 Ctrl + F4    - Closes the active window.
 Ctrl + F5    - Allows moving and resizing the active window.
 Ctrl + F10   - Activates the main menu.


3.11.  THE COMMAND LINE PARAMETERS IN THE ENVIRONMENT
       ==============================================

       WARAJEVO also allows some command parameters. We told you earlier
about one of them, /C. The full syntax of the command line which WARAJEVO
accepts is:

WARAJEVO [<short_name>] [<tape_name>.TAP] [<snap_name>.Z80] [[<mdr1_name>.MDR]
 [<mdr2_name>.MDR] ... [<mdr8_name>.MDR]] [/C[<code>]]

or, alternatively:

WARAJEVO /S<any_Spec_file> [/C[<code>]] [/G]

The meaning of these parameters is as follows:

<short_name>       This parameter represents the short name of the program in
                   the database. If the database contains a record with this
                   short name, after entering the environment it will
                   automatically call the emulator and load and run the
                   program using data from the database. For more details,
                   see the chapters about using the database, especially
                   chapter 3.6.2. The parameter <short_name> has absolute
                   priority in relation to other parameters (more precisely,
                   data from the database is 'more powerful' than data given
                   through the command line or data in the configuration
                   file).

<tape_name>.TAP    If you give the name of a tape file with the extension
                   .TAP as the parameter (for example, ARCADE.TAP) this tape
                   file will be activated after entering the environment. You
                   must specify the extension.

<snap_name>.Z80    If you give the name of a snapshot file with the extension
                   .Z80 as the parameter (for example, INVADERS.Z80) this
                   snapshot file will be activated after entering the
                   environment. You must specify the extension.

<mdrN_name>.MDR    If you give the name of a cartridge file with the
                   extension .MDR as the parameter (for example, WRITER.MDR)
                   this cartridge file will be activated after entering the
                   environment. You must specify the extension. As the
                   Spectrum allows up to 8 microdrives, you can specify up to
                   8 cartridge files, which will be assigned respectively to
                   microdrives 1, 2 etc.

/C                 If the parameter /C is used, the environment will use the
                   file SPECSIM.CFG for reading initial configuration instead
                   of DEFAULT.CFG. Principally, WARAJEVO /C will load the
                   emulator in exactly same state as when you last left it.

/C<code>           This parameter has the same meaning as /C, but in addition
                   some environment command determined by <code> will be
                   executed (for example, /C1236 will open the dialog for
                   setting parameters related to video emulation). This is
                   implemented for internal purposes. The table of command
                   codes needs too much space to show, so we will not
                   document it. By experimenting you can discover these codes
                   for yourself if you want to hack. Legal codes are from 100
                   to 256 and from 1200 to 1300.

/G                 If the parameter /G is given on an EGA or VGA graphics
                   card, the environment will be started in graphic mode,
                   regardless of the content of the variable WARAJEVO in the
                   DOS environment.

/S<any_Spec_file>  If the command parameter /S is given, the file
                   <any_Spec_file> will be immediately started after entering
                   the environment. Starting is performed through the 'Start'
                   button, so the given file may be any Spectrum file (Z80,
                   TAP, SNA, TZX etc.).

The described command parameters have priority in relation to the parameters
/T, /R and /# which are stored in the file DEFAULT.CFG (or SPECSIM.CFG).


3.12.  THE COMMUNICATION PROGRAM
       =========================

       This program is made for use on the original Spectrum 128 (or +2) and
it must be transferred to the Spectrum using the option 'Send communication
program' (see chapter 3.2.4.).

       It is a modification of 'Mastercopy 128' written by Vatroslav Sobot
from Zagreb, Croatia (we don't know where is he now exactly, so we didn't ask
him for permission - we hope that he will not be angry with us). We decided
to use this program for communications, because the Spectrum 128 has enough
memory for transferring long programs, a built-in RS232 interface, and this
program is very user-friendly.

       Connect the cable like this (if you can find a Sinclair connector):

            Spectrum 128                        PC COM port 24 pins

                1     ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ
                2     ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒ 5
                                        ¿ƒƒƒƒƒƒƒƒƒƒƒ 6
                3     ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ 20
                4     ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ 3
                5     ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ 2
                6     ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒ 7

When you load the communication program onto your Spectrum you have three
options:

1. TAPE TO TAPE
2. TAPE TO PC
3. PC TO TAPE

These options define the input and output device.

       After you have selected the devices, you have these options:

L - Loads the header and corresponding data block from the input device until
    BREAK key is pressed, or until loading fails.
S - Saves all the blocks from the memory to the output device.
H - Loads headerless blocks from the input device until the BREAK key is
    pressed or loading fails.
C - Clears all blocks from the memory.
R - Removes the last block from the memory.
F - Loads the headers and displays them on the screen, but doesn't store them
    in RAM.
Q - Resets the computer.
V - Views all blocks in memory. While viewing you have these suboptions:
     A - Cancels autostart of BASIC programs.
     N - Changes the name of header blocks.
     R - Remove a headerless (or header and corresponding block) from the
         memory.
     S - Saves the current block to the output device.
     n - Pauses (n=1-9 sec.) before saving this block.

Using this program you can transfer all programs saved with the normal speed.
For speedlock programs, see the technical part of the manual.


4.     BUILT-IN MONITOR
       ================


4.1.   THE FRONT PANEL
       ===============

       The monitor is one of the most interesting features of the Warajevo
Spectrum emulator. The monitor can be started by pressing F3, and it is fully
transparent to Z80 programs (e.g. it is written in PC machine code and does
not use any bytes in Spectrum RAM as workspace). After you press this key,
you will see the front panel. The front panel contains these:

- Values of all registers (AF, BC, DE, HL, SP, PC, IX, IY, IR, AF', BC', DE',
  HL', F and F');
- Memory pointer (MP);
- Current instruction, e.g. instruction at the program counter (PC);
- The effective address of the argument of the current instruction, and its
  value (ARG and (ARG) fields);
- The interrupt mode, and flip-flops IFF1 and IFF2;
- Memory banks and state of LOCK bit (128K version only);
- Memory configuration and value of control register #FF (Timex version only);
- A break point address (and its page);
- Memory bytes around registers PC, SP, HL, IX, IY, DE, BC and around memory
  pointer.

       The values of the registers are displayed as sixteen-bit values. They
should be decimal or hexadecimal. One register is active, and marked with a
sign ':'. The registers F and F' are displayed in binary form too, with an
explanation of all the bits. The marked register may be changed using TAB.

       The memory pointer (MP) is a default value for many instructions. It
is a sixteen-bit value too.

       The program-counter (PC) points to the current instruction. At the top
of the screen, the program counter, the hexadecimal values at this address,
and the mnemonic of the current instruction are displayed. The mnemonics are
standard Z80 mnemonics, with the addition of some synthetic instructions,
listed in the technical part of the manual.

       If the current instruction reads or changes a value in memory, the
argument field 'ARG' is not blank. It will contain the effective address of
the argument. For example, if the current instruction is 'LD A,(IX+3)', the
field 'ARG' will have the value of IX register incremented by three. '(ARG)'
is the value at the address shown by the field 'ARG'. The complex implicit
read/write instructions like RRD and LDIR do not affect this field. If the
current instruction has no memory arguments, these fields will be blank.

       The interrupt mode is displayed below the sign 'IM'. Two Z80 interrupt
flip-flops IFF1 and IFF2 are displayed below the signs 'I' and 'J'.

       On the 48K and 128K versions of the emulator, the character under the
letter 'R' shows the currently active ROM with the following meaning: 'S' for
standard ROM, 'I' for ZX Interface 1 shadow ROM, and 'D' for 128 Derby ROM.
The fields 'M', 'V' and 'L' are meaningful only in the 128K version, and
show the active RAM page, active video page and status of the 48K lock bit.
The 48K version displays asterisks ('*') instead.

       On the Timex version of the emulator, the number under the sign 'CTRL'
represents the value of control register (#FF). After the sign 'MC', eight
letters are displayed which represent the active memory bank for all eight
8-Kb memory chunks with 'H' for HOME bank, 'X' for EXROM bank and 'D' for
DOCK bank. The letter at the left end corresponds to the highest block
(addresses 57344 - 65535), and the letter at the right end corresponds to the
lowest block (addresses 0-8191).

       Your program could have one break point (which is, unfortunately, not
fully transparent to Spectrum programs), where the program immediately jumps
to the monitor. The field 'BP' displays its address and memory page (S, I or
D for ROM, 0-7 for RAM above 49152 in the 128 version), and a warning message
if it is in ROM. If there is no breakpoint, this field will be empty.

       Finally, you can see the memory bytes around register values. The
register is shown in the middle of the line. On the left side of the line are
bytes on addresses from <rr>-6 to <rr>-1. On the right side of the line are
bytes on addresses from <rr> to <rr>+5. The used registers are: PC, SP, HL,
IX, IY, DE, BC and the memory pointer (MP).

       The bottom two lines are used for entering commands and error
messages.


4.2.   ARGUMENTS OF COMMANDS
       =====================

       Arguments may be numerics or strings. Numerical arguments may be
entered in either decimal or hexadecimal system. If the number is
hexadecimal, it must be preceded by a hash (for example #3EC0). The special
argument '?' is used in some instructions as a wildcard sign, but if you use
this argument in some other instructions, you must know that it is internally
coded as 65535.

       String arguments are, in fact, packed numeric arguments. For example,

F'ABC'

is the same as

F'A' 'B' 'C'

or

F65 66 67

       Two special argument symbols, '.' and '$' mean 'Value of memory
pointer' and 'Value of current marked register'. The arguments are separated
with a space. When you are in the monitor, the keys are mapped PC style, not
Spectrum style.


4.3.   MONITOR COMMANDS
       ================

       We will use the symbol <word> for sixteen-bit values, and <byte> for
eight-bit values. Square brackets mean an 'Optional argument'. You may get
quick help about monitor commands with the syntax and a short description
using F1 when you are in the monitor.

       In some extremely rare situations (e.g. a Windows Task Switch during
single stepping through instructions) the content of the front panel may
become trashed. In such situations, type '_' and ENTER to force the
refreshing of the front panel.

A[<word>]                                        ABORT (48 version)
---------                                        ------------------

       This leaves the monitor and tries to interrupt the program returning
to BASIC. If the parameter <word> is omitted, the monitor recovers some
system variables (ERRSP, DF_SZ, FLAGX, FLAGS, P_RAMT, PIP, RASP), registers
(IY, SP), interrupt modes (performs IM 0) and flip-flops (EI) then jumps to
the main loop (MAIN_EXEC, address 4770) of the Spectrum Basic interpreter.
This will interrupt many programs.

       Sometimes this will not be enough. In that case, use the <word>
argument (the lowest allowed value is 23900). The monitor will restore RASP,
PIP and P_RAMT variables and acts like:

CLEAR <word-1>: NEW

Examples:

A                            Tries to return to BASIC.
A25000                       Restore some variables and act as BASIC commands
                             CLEAR 24999: NEW

A[<word>] [<byte>]                               ABORT (Timex version)
------------------                               ---------------------

       The command A in the Timex version of the emulator is similar to that
in the 48K version, but when the parameter <word> is omitted, the system
variable ERR_LN (23734) will be reset, and the SP register will be restored
according to the system variable MSTBOT (23744), not from RAMTOP. The label
MAIN_EXEC on the Timex is at address 3624, and the label NEW is at 3357. The
lowest allowed value of the parameter <word> is also 23900. but with the
original Timex ROM the lowest usable value is 26900. On the Timex version,
A0 will work like A, but ERR_LN will not be reset, and SP will be restored
from RAMTOP (use this only if you know exactly what you are doing).

       Some Timex programs use the ZX Spectrum ROM, so the command A is
expanded a bit to allow aborting of programs in the Spectrum environment.
Namely, if you use 1 as the argument (e.g. A1) the command A will be executed
without parameters assuming the presence of the Spectrum ROM (with the Timex
ROM this will cause a crash due to different ROM addresses). If you give a
second parameter (its value is not important), the jump to NEW will be
performed assuming the presence of the Spectrum ROM.

Examples:

A                            Tries to return to BASIC
A0                           Tries to return to BASIC with stack relocation
A1                           Tries to return to BASIC in the presence of the
                             Spectrum ROM
A30000                       Restore some variables and act as BASIC commands
                             CLEAR 30000: NEW
A30000 0                     Restore some variables and act as BASIC commands
                             CLEAR 30000: NEW in the presence of the Spectrum
                             ROM

A<byte> [<word>]                                 ABORT (128 version)
----------------                                 -------------------

       ABORT command in 128 version of emulator is quite complex. The first
parameter must have value 48 or 128 with meaning 'Abort to 48 Basic' or 'Abort
to 128 Basic'. If you not familiar with Spectrum 128 system variables, you can
not understand a lot of things.

       If the first parameter equals 48, A acts like A command in 48 version
of the emulator. The only difference is that if the parameter <word> is
omitted (soft abort), monitor restores printer channel "P" too, because 48
Basic and 128 Basic have different "P" channels, and using wrong "P" channel
may cause crash.

       If the first parameter equals 128, monitor first recovers some vital
things, like paging subroutines at address 23296 (SWAP, YOUNGER, ONERR, PIN,
POUT and POUT2), and system variables BANKM, RAMRST, P_RAMT, PIP and RASP.
Then, if parameter <word> is present, monitor acts like CLEAR <word>-1: NEW in
'128 Basic'. But, if parameter <word> is omitted, monitor tries to recover
BASIC system. It recovers system variables, registers, interrupt mode and
flip-flops like command A48, but it also recovers system variables COL,
TVPARS, WIDTH, BAUD, some undocumented editor variables in page 7 of RAM
(60435 and 65316/7), and printer channel "P" too. Then monitor jumps at
address 561 in Derby ROM. This will prepare screen editor for working, and
opens a main menu. If you now select '128 Basic', in many cases you can
continue working with Basic program who was present in memory. By using
command Y (for unlocking a 48K lock bit) and then A128 command, in many cases
you can transfer BASIC program from '48 Basic' to '128 Basic'. This is
impossible on real Spectrum 128!

       Note: The A128 command does not restore system variables SFSPACE and
SFNEXT, so if their contents are not corrupted, in many cases after A128
command you can normally work with RAM disc. However, this will not work if
this variables are corrupted, usually after switching from '48 Basic' to '128
Basic'. In this cases, you must manually restore these variables if you want
to use RAM disc after A128 command.

Examples:

A48                          Tries to return in 48 Basic
A128                         Tries to return in 128 Basic
A48 30000                    Acts nearly like CLEAR 29999: NEW in 48 Basic
A128 30000                   Acts nearly like CLEAR 29999: NEW in 128 Basic


B[<word>]                                        SET/CLEAR BREAKPOINT
---------                                        --------------------

       Sets the break point at address <word>, in currently active page. The
first byte of the instruction at address <word> will be replaced with 199, a
Z80 code of instruction RST 0, when you leave monitor. This instruction have
special meaning when breakpoint is set (it acts like breakpoint if PC is equal
to <word>, else it acts like normal RST 0). Then, when you leave the monitor
and continue executing of the program, incoming of this instruction will
return you to the monitor. The original value of this address will be then
restored. Obviously, such implementation on the break point is not fully
transparent for running Spectrum program (e.g. break point changes content of
the Spectrum program, and running program may erase the break point). However,
in many cases this implementation works quite good.

       If the break point is in ROM area, you will see the warning message
'Warning: ROM'. This is shown due to it should make the failure in the
emulator if the break point is in a data area instead on the beginning of the
some instruction. If such failure happens, first re-enter the monitor and then
press F9 for reset the emulator.

       Any entrance to the monitor will clear the break point, and the
original value of the changed instruction will be restored, except if you
changed it in the mean time, for example with basic POKE instruction. Command
B without parameters clears the breakpoint too.

Examples:

B#C3A8                       Puts breakpoint at address #C3A8
B                            Remove breakpoint



C<word1> <word2> <word3>                         INTELLIGENT COPY
------------------------                         ----------------

       Copies a <word3> bytes from address <word1> to address <word2>. Copying
is intelligently, in meaning that the blocks may be overlapped.

Example:

C40000 50000 100             Copies 100 bytes from address 40000 to address
                             50000


D[<word1> [<word2> [<byte1> [<byte2>]]]]         DISASSEMBLE
----------------------------------------         -----------

       Displays disassembled listing of the program in a form:

          address     bytes       mnemonic

Parameters are:

<word1>  Start address, if omitted, it will be the value of the program
         counter.
<word2>  End address, if omitted, the instructions will be listed until you
         press the SPACE key.
<byte1>  Number of rows on the screen, if omitted, or if you give '?', the
         default value is 24.
<byte2>  Disassembly options (see text below).

       Disassembling of RST instructions is smart: the monitor knows that
after every RST 8 instruction in every ROM (and after RST 32 instruction in
Interface 1 shadow ROM) follows one inline byte parameter, and it will be
disassembled like 'DB n'; after RST 40 instruction in Derby ROM and after RST
16 instruction in Interface 1 shadow ROM follows one inline word parameter,
and it will be disassembled like 'DW n'. However, disassembling of RST 40
instruction in standard ROM (calculator) is only  partially smart. This
restart may have many different inline parameters. Monitor will disassemble
inline parameters which follows RST 40 instructions as 'DB n' until monitor
detects 'end-calc' inline code (#38) or 'jump' inline code (#33). In many
cases this is correct, but sometimes this is not. If you specify parameter
<byte2>, it have following meaning:

0 - Turns smart disassembling off, e.g. do not display inline parameters as DB
    and DW;
1 - Disassemble everything as DB n, it is sometimes useful with O command;
    new feature introduced in release 2.5. is displaying of ASCII codes which
    correspond with displayed bytes, including BASIC tokens;
2 - Disassemble everything as DW n;
3 - Disassemble everything as DB n, until byte #38 (end-calc) or byte after
    byte #33 (jump), then continue with smart disassembling; this is sometimes
    useful when disassembling FP calculator routines.

Examples:

D                            Disassemble from the current value of the program
                             counter
D.                           Disassemble from the current value of the memory
                             pointer
D30000                       Disassemble from address 30000
D$ #FC38                     Disassemble from value of current marked register
                             to address #FC38
D1366 . 14                   Disassemble from address 1366 to the current
                             value of the memory pointer, in pages of 14
                             screen lines
D43200 43500 ? 2             Disassemble everything like DW n from address
                             43200 to address 43500
D23755 25000 ? 1             Disassemble everything like DB n from address
                             23755 (beginning of BASIC area) to address 25000;
                             ASCII codes and BASIC tokens in this area will
                             also be displayed
D0 $ 15 0                    Disassemble without displaying inline parameters
                             from address 0 to value of current marked
                             register, in 15 screen lines long pages
D'Aa'                        Disassemble from address 65 to address 97 (this
                             is silly usage of parameters, but it is possible)
D65000 ?                     Disassemble from address 65000 to 65535 (this is
                             unusual using of '?')


E[<word>]                                        EXIT/EXECUTE
---------                                        ------------

       Returns from the monitor to our program with updating changed
registers. You can put some values in registers including PC and then execute
E command. This will force jump at new PC. If you specify optional parameter
<word>, PC register will be set to <word> and then monitor will do ordinary E
command.

Examples:

E                            Continue executing emulator from the current
                             value of the program counter (e.g. exit monitor
                             if you not change registers during working in the
                             monitor)
E.                           Continue executing emulator from current value of
                             the memory pointer
E$                           Continue executing emulator from the value of
                             currently marked register
E30000                       Continue executing from address 30000


F[<byte1>|<word1> [<byte2>|<word2> ...]]         FIND BYTES/WORDS/STRINGS
----------------------------------------         ------------------------

       Searches sequence of bytes in memory, starting from the memory pointer.
You could use the value of bytes or wildcard '?' with meaning 'any byte'. If
any argument is greater than 255, it will be splitted to low and high byte, so
F10000 is same as F16 39. Due to internal coding of '?', command F65535 will
not be performed correctly (instead, use F255 255).

       F command without parameters, searches for a next occurrence of already
found sequence of bytes.

Examples:

F1 2 3                       Finds sequence 1,2,3 in the memory
F'Sinclair'                  Finds string 'Sinclair' in the memory
F10 1000 20                  Finds sequence 10,232,3,20 in the memory
                             (1000=232+256*3)
F30 25 ? #FD                 Finds sequence which have first and second byte
                             30 and 25, third byte is not significant, and
                             which have fourth byte #FD
F205 1366                    Find instruction CALL LD_BYTES in the memory
                             (instruction CALL has code 205, and routine
                             LD_BYTES has address 1366)
F2 4 'money'                 Finds sequence 2,4,'m','o','n','e','y' in the
                             memory
F? 63                        Finds sequence who have second byte 63


H                                                HEX/DEC TOGGLE
-                                                --------------

       Toggles between decimal and hexadecimal values on display. Parameters
are always by default in decimal system, and byte values of the memory are
always shown as hexadecimal, due to lack of space on the screen.

Example:

H                            Toggles hex/dec display on screen


I[<word>]                                        INSTRUCTION SINGLE STEP
---------                                        -----------------------

       Executes current instruction. If you give the parameter <word>, the
executing will be continued with updating the front panes, until the program
counter receives the value <word>, or breakpoint, or until you press the SPACE
key. Such single-stepping is much more powerful than on real Spectrum, you can
single-step through everything. For example, you can single step even through
non-standard load routine, and edge recognizer will still work without any
problems! The same is true for load routines which perform loading from the
samples. Sometimes, when you single step through load (or save) routine, and
through some restarts if you have /B command line option, the monitor performs
some unusual steps, but it is not a great problem. Also, monitor will execute
instruction after EI together with EI in one step.

Examples:

I                            Performs a instruction single step
I40000                       Performs a continous single stepping until the
                             program counter reaches 40000


J[<word>]                                        JUMP TO
---------                                        -------

       Puts breakpoint at address <word> and perform E command (e.g. leave
monitor, and return to monitor when PC reaches value <word>). If parameter
<word> is omitted, breakpoint will be put after current instruction, or after
inline parameters if current instruction is RST (for more informations about
inline parameters see description of D command). This is useful when you don't
wish single stepping through a subroutine, or if you want to execute a
complete loop without single stepping. Also, it is most efficient to use J
command instead of I when stepping over Z80 commands like LDIR (due to nature
of these instructions).

       You can normally use J with sequence RST 40; DW <address> in 128 Derby
ROM, because monitor knows that RST 40 in Derby ROM have one word inline
parameter. However, you must be carefully when use J command to execute
calculator restart (RST 40 in standard ROM), because breakpoint will not
always be put on correct place. It is better to specify parameter <word>
manually in this case.

Examples:

J                            Puts breakpoint after current instruction, then
                             leave monitor
J.                           Puts breakpoint at value of the memory pointer,
                             then leave monitor
J#C328                       Puts breakpoint at address #C328, then leave
                             monitor


K<word1> <word2> <byte>                          KILL MEMORY BLOCK
-----------------------                          -----------------

       Fills a memory block from address <word1> to <word2> (including
<word2>) with a value <byte>.

Example:

K16384 22527 0               Fills address from 16384 to 22527 with 0 (e.g.
                             clears video memory)


L[<word>]                                        LOAD BLOCK
---------                                        ----------

       Loads a next block from the tape at the address <word>. If parameter
<word> is omitted, the assumed value will be the memory pointer. A flag byte
will be ignored.

Examples:

L                            Loads block at current value of memory pointer
L16384                       Loads block at address 16384 (e.g. in the video
                             memory)


M[<word> [<byte1> [<byte2> ...]]]                SET MEMORY POINTER
---------------------------------                ------------------

       Sets the memory pointer to a value <word>. If the value is omitted, the
assumed value is value of the marked register.

       This instruction may have more than one parameter. In that case it acts
as a combination of M and P commands, e.g. sets a memory pointer and then
executes command P with a rest of parameters (see command P).

Examples:

M                            Sets memory pointer to value of currently marked
                             register
M24500                       Sets memory pointer to value 24500
M40000 5 3 200               Sets memory pointer to value 40000, then puts
                             bytes 5, 3 and 200 at address 40000, 40001 and
                             40002; memory pointer now have value 40003
M24220 3 ? ? 'Sinclair'      Sets memory pointer to value 24220, puts value 3
                             there, skips two bytes, and finally, puts string
                             'Sinclair' at address 24223; memory pointer now
                             have value 24231
M$ 'ZX'                      Sets memory pointer to value of currently marked
                             register, then put string 'ZX' there


N                                               INTERRUPT ROUTINE ADDRESS
_                                               -------------------------

       Using this useful command you can very easily discover address of
current Z80 interrupt handler. This is, in fact, always 56 if processor is not
in interrupt mode 2, else this address is given by formula DPEEK (256*I+255)
which is usually topic of our interest. So, this command eliminates need for
tedious calculations. Command N goes even one step further. When on such
calculated address lays jump instruction JP or JR (which is often case),
command N will automatically display destination of this jump instruction.
This command will display result in same form as command '?' (see below).

Example:

N                            Shows address of current Z80 interrupt handler


O                                                TOGGLES OUTPUT FILE ON/OFF
-                                                --------------------------

       This is one of the most powerful commands in the monitor. When you give
command O first time, this command will create file 'MONITOR.OUT' if this file
don't exist, or it will open this file for appending if it exists. After this,
any following actions in the monitor will send results of actions into this
file, until you close this file by giving command O again. When output file is
open, you will see double prompt '>>' instead of single prompt '>'.

       Any opening of the output file will cause sending content of the front
panel (in slightly modified format, and without memory bytes around register
values) to the output file. Commands which you give will be sent to the output
file (with prompt '>' to indicate that is a command) including eventually
error messages. After this, influence to the output file depends of the given
command:

- Commands D and T will send listing to the output file.
- Commands B, C, K, L, S, V and Z do not affect output file.
- Commands H, R, U, X and Y force sending of front panel after end of command.
- Commands A, E, J and Q leave monitor, and when you return to monitor (for
  example, by pressing F3), front panel will be send to the output file.
- Commands F, M, P and W will send new value of memory pointer to the output
  file.
- Commands N,?, +, -, *, /, &, | and ^ will send results of commands to the
  output file in same format as at the screen.
- Command ! will send new status of interrupt flip-flops and mode to the
  output file.
- Command I without parameter will send disassembled current instruction to
  the output file, but if you give I command with parameter, any instructions
  that monitor executes will be sent in disassembled format to the output
  file. So, you will get trace of program execution in similar form as a
  listing produced with D command.
- Command O temporary closes output file, and it is opened again when you type
  O again. So, two subsequently O commands will force sending of front panel
  too.

Example:

O                            Open or close monitor output file 'MONITOR.OUT'


P<byte1> [<byte2> [<byte3> ... ]]                POKE BYTES
---------------------------------                ----------

       Places a sequence of bytes in memory, from the memory pointer. The
memory pointer is incremented by one after each byte. If any of values is '?',
the original value at this address will not be changed.

Examples:

P10 100 ? 25                 Puts bytes 10 and 100 at current value of the
                             memory pointer, skips one byte, and finally, puts
                             value 25; the memory pointer will be incremented
                             by four
P'Help revival of Bosnia!'   Puts string 'Help revival of Bosnia!' at current
                             value of the memory pointer, and increments the
                             memory pointer by 22
P?                           Increments the memory pointer by one


Q                                                QUIT MONITOR
-                                                ------------

       Returns to the program, with restoring registers as they were when you
entered the monitor. You must make difference between Q and E commands. Q acts
like combination of U and E commands.

Example:

Q                            Quit the monitor


R[<word>]                                        REGISTER CHANGE
---------                                        ---------------

       Changes a value of a marked register to <word>. If this parameter is
omitted, register receives a value of the memory pointer. The marked register
can be changed using TAB key.

Examples:

R                            Sets currently marked register to current value
                             of the memory pointer
R5000                        Sets currently marked register to 5000


S<word1> <word2> [<byte1> [<byte2> ...]]           SAVE BLOCK (OR BYTES)
----------------------------------------           ---------------------

       Saves a part of the memory from address <word1> with a size <word2>. If
there are no extra parameters, the memory will be saved as headerless block,
with flag byte 255. Otherwise, the memory will be saved as 'Bytes' file (with
header). Extra parameters represents ASCII byte values of a file name.

Examples:

S16384 6912                  Save 6912 bytes from address 16384 (e.g. screen)
                             as a headerless file
S16384 6912 'Scr'            Save screen as a 'Bytes' file with filename 'Scr'


T[<word1> [<word2> [<byte>]]]                    TEXT LIST
-----------------------------                    ---------

       Displays content of the memory in hexadecimal and ASCII code form.
Characters with codes which is greater than 128 will be reduced to range
0-127, and they will be displayed in inverse video. Control codes will be
displayed as '.'.

Parameters are:

<word1>  Start address, if omitted, it will be the value of the memory
         pointer.
<word2>  End address, if omitted, the memory will be listed until you press
         the SPACE key.
<byte>   Number of rows on the screen, if omitted, the default value is 24.

Examples:

T40000 50000 10              Displays HEX and ASCII memory dump from address
                             40000 to 50000, in pages of 10 screen lines
T1000 2000                   Displays HEX and ASCII memory dump from address
                             1000 to 2000
T#C000                       Displays HEX and ASCII memory dump from address
                             #C000
T$                           Displays HEX and ASCII memory dump from value of
                             currently marked register (usually PC)
T                            Displays HEX and ASCII memory dump from current
                             value of the memory pointer


U                                                UNDO REGISTER CHANGES
-                                                ---------------------

       Returns a value of all registers to be as in the moment when you
entered the monitor.

Example:

U                            Undo all changes of registers


V                                                VIEW SCREEN
-                                                -----------

       Displays original contents of video memory (either standard or
alternative page on 128K version of the emulator, depending of V field on
front panel) on the screen until you pressed a key. On Timex version of the
emulator, all video modes will be displayed correctly.

Example:

V                            View the screen


W<word1> [<word2> [<word3> ...]]                 POKE WORDS
--------------------------------                 ----------

       Places a sequence of the words in memory from the memory pointer. After
every word, the memory pointer will be incremented by two.

Examples:

W40000 #C500 $ 44200         Poke words 40000, #C500, value of currently
                             marked register, and 44200 at current value of
                             the memory pointer; the memory pointer will be
                             incremented by 8
W50 ? 400                    Poke words 50 (e.g. bytes 50 and 0), 65535 ('?'
                             is not a wildcard in W command) and 400 at
                             current value of the memory pointer
W'ZX'                        Poke following sequence of bytes: 'Z',0,'X',0 at
                             value of memory pointer


X[<byte>]                                        SET XOR BYTE
---------                                        ------------

       Many programs are encrypted using XOR function. To see it, without
executing a decryption routine, you may use command X followed with <byte>.
After this, commands T, F, D will execute XOR function between every displayed
and checked byte and value <byte>. This also works with front panel display.
Next, the commands P, K, and W will execute XOR function between <byte> and
every byte which will be stored in memory.

       For example, for listing of texts in adventures written in 'The quill'
program, use X255 command. Command X without a parameter is the same as X0
(i.e. undo effect of command X).

Examples:

X30                          Set xor byte to 30
X                            Undo effect of X


Y                                                SWAP ROMS (48 version)
-                                                ----------------------

       Toggles active ROM between standard ROM and Interface 1 shadow ROM (if
Interface 1 is present). This command is very expanded on 128 version of the
emulator.

Example:

Y                            Switch on/off ZX Interface 1 shadow ROM

Y[<word>]                                        MEMORY PAGES (Timex version)
---------                                        ----------------------------

       Changes configuration of the memory on Timex computer. It is worth to
look at parameter <word> as 9-bit number. Bits B0 to B7 correspond to memory
chunks at addresses 0-8191, 8192-16383 etc. respectively. When a bit is equal
to zero, corresponding chunk will belong to HOME bank, else the chunk will
belong to DOCK or EXROM bank, depending of bit B8 (0 = DOCK, 1 = EXROM).
Command Y without parameters will reset memory configuration to be like when
you entered the monitor.

Examples:

Y                            Undo changes of memory configuration
Y0                           Put HOME bank in address space 0-64K
Y3                           Put DOCK bank in address space 0-16K, and HOME
                             bank in address space 16K-64K
Y257                         Put EXROM bank in address space 0-8K, and HOME
                             bank in address space 8K-64K
Y385                         Put EXROM bank in address space 0-8K and 56K-64K,
                             and HOME bank in address space 8K-56K

Y[<byte1> [<byte2> [<byte3> [<byte4>]]]]         MEMORY PAGES (128 version)
----------------------------------------         --------------------------

       Changes active memory banks on 128 version of the emulator. Parameters
are:

<byte1>  Active ROM (0 = Derby, 1 = Standard, 2 = Interface 1 shadow)
<byte2>  Active RAM bank at addresses from 49152 to 65535 (0-7)
<byte3>  Active video page (0 = Standard, 1 = Alternative)
<byte4>  Value of 48K lock bit (1 = MMU is locked)

       Command Y without parameters restores memory banks to be like when you
entered the monitor (e.g. undo changes of memory pages). Parameters <byte1>,
<byte2> and <byte3> may be '?' with meaning 'No changes', which is useful when
you want for example to change only active video page.

Examples:

Y                            Undo changes of memory pages
Y2                           Set Interface 1 ROM as active ROM
Y0 7                         Set Derby ROM as active ROM and select RAM page 7
Y? 4                         Set RAM page 4 as active RAM
Y1 ? 1                       Set Standard ROM as active ROM and set usage of
                             alternative video page
Y? ? 0                       Switch off alternative video page
Y1 0 0 1                     Set Standard ROM as active ROM, select RAM page
                             0, use standard video page, and then lock memory
                             management unit (e.g. acts nearly like a SPECTRUM
                             command in '128 Basic')
Y? ? ? 0                     Only reset 48K lock bit; this is impossible on
                             real ZX Spectrum 128, but in this emulator it is
                             possible, but only using Y command in the monitor


Z[<byte> [<word>]]                               DUMP SCREEN
------------------                               -----------

       Dumps screen on Epson or IBM compatible printer. The first parameter
has the following meaning:

0 - Make a big and a very nice shaded screen dump, with 36 dots per inch.
    Every screen pixel (set or reset) will be converted into 2x2 matrix onto
    printer, depending of attribute byte on screen. So, real printer
    resolution in this mode is 72 dots per inch, and dump size is 18 x 13.6
    cm. This is default value of <byte> parameter.
1 - Make a big bit-map screen dump, with 36 dots per inch. Every screen pixel
    which is set will be converted into 2x2 solid matrix onto printer, so real
    printer resolution in this mode is 72 dots per inch, and dump size is some
    as in previous option, 18 x 13.6 cm.
2 - Make a medium size bit-map screen dump, with 72 dots per inch. Every
    screen pixel which is set give one pixel on printer. Dump size in this
    mode is 9 x 6.8 cm.
3 - Make a small size bit-map screen dump, useful for making game maps, with
    144 dots per inch, and with two passes per every line. Dump size in this
    mode is 4.5 x 3.4 cm.
4 - Make a extremely small size bit-map screen dump, with 240 dots per inch,
    and with three passes per every line. Dump size is 2.7 x 2 cm.
5 - Like 0, but with a frame around printed picture.
6 - Like 1, but with a frame around printed picture.
7 - Like 2, but with a frame around printed picture.
8 - Like 3, but with a frame around printed picture.
9 - Like 4, but with a frame around printed picture.

       Dump is smart in meaning that every set pixel which have ink color same
as paper color will be treated as a reset pixel. This is implemented because
many programs use this method for hiding some strange data on screen, and this
need not be seen at screen dump.

       The parameter <word> sets a left margin for screen dump in screen
pixels (depending of dump mode). So, if <word> is 256, dump is moved right for
one full dump width in this dump mode. This is useful when you make game maps.
If you have A4 printer, maximum legal value of this parameter who does not
produce dump out of paper is 32, 320, 896 and 1664 for modes 0 (or 1), 2, 3
and 4 respectively. If you are skilful, in some cases you can make whole map
of a game on only one page of paper!

Examples:

Z                            Make a nice shadow dump of screen
Z2                           Make a medium size bit-map dump of screen
Z7                           Make a medium size bit-map dump of screen, with
                             frame around the picture
Z4                           Make a extremely small bit-map screen dump
Z4 256                       Make a extremely small bit-map screen dump from a
                             colon where previous command finish
Z4 512                       Make a extremely small bit-map screen dump from a
                             colon where previous command finish

!<byte1> [<byte2>]                               SET INTERUPT MODE AND IFFS
------------------                               --------------------------

       Sets interrupt flip-flops IFF1 and IFF2 to <byte1> and switch interrupt
mode to IM <byte2>, if <byte2> is present. Parameter <byte1> may be '?', with
meaning 'No change'.

Examples:

!0                           Disable interrupts
!1                           Enable interrupts
!0 2                         Disable interrupts and sets interrupt mode 2
!? 1                         Sets interrupt mode 1


?[<byte>|<word>]                                 PRINT NUMBER
----------------                                 ------------

       If an argument is byte value, it will be displayed in hexadecimal and
decimal form. If it is between 32 and 127, will be also displayed its ASCII
value. For arguments above 127 it will be displayed also as a negative number
in two's complement form.

       If an argument is word value (greater than 255), it will be displayed
in hexadecimal and decimal form, then will be eventually displayed as a
negative number (if greater than 32767), and finally its high and low bytes
will be displayed.

       In a case of missing argument, the default value is value of the marked
register. This is useful for examining high and low byte of 16-bit registers.

Examples:

?10                          Displays "#000A 10"
?40                          Displays "#0028 40 '('"
?#FF                         Displays "#00FF 255 -1"
?30000                       Displays "#7530 30000 117,48"
?45000                       Displays "#AFC8 45000 -20536 175,200"
?'a'                         Displays "#0061 97 'a'"
??                           Displays "#FFFF 65535 -1 255,255" (due to
                             internal coding of '?')
?                            Displays value of currently marked register in
                             many forms, depending of its value
?.                           Displays current value of memory pointers in many
                             forms, depending of its value


+<byte1>|<word1> <byte2>|<word2>                 ADDITION
--------------------------------                 --------

       Adds arguments and displays a result as in '?' command.

Example:

+7 8                         Adds 7 and 8 and displays the result (i.e.
                             "#000F 15")


-<byte1>|<word1> <byte2>|<word2>                 SUBTRACTION
--------------------------------                 -----------

       Subtracts arguments and displays a result as in '?' command.

Example:

-. $                         Subtracts value of currently marked register from
                             value of the memory pointer, and displays the
                             result


*<byte1>|<word1> <byte2>|<word2>                 MULTIPLICATION
--------------------------------                 --------------

       Multiples arguments and displays a result as in '?' command.

Example:

*7 3273                      Multiply 7 and 3273 and displays the result


/<byte1>|<word1> <byte2>|<word2>                 DIVISION
--------------------------------                 --------

       Divides arguments and displays a integer part of a result as in '?'
command.

Example:

/1200 14                     Divides 1200 by 14 and displays a integer part


%<byte1>|<word1> <byte2>|<word2>                 REMAINDER
--------------------------------                 ---------

       Divides arguments and displays a remainder of division as in '?'
command.

Example:

%1200 14                     Divides 1200 by 14 and displays a remainder


&<byte1>|<word1> <byte2>|<word2>                 BINARY AND
--------------------------------                 ----------

       Performs a binary AND between the arguments and displays a result as in
'?' command.

Example:

&3200 1500                   Performs a binary AND between 3200 and 1500 and
                             displays the result (which is 1152)


|<byte1>|<word1> <byte2>|<word2>                 BINARY OR
--------------------------------                 ---------

       Performs a binary OR between the arguments and displays a result as in
'?' command.

Example:

|4200 1700                   Performs a binary OR between 4200 and 1700 and
                             displays the result (which is 5868)


^<byte1>|<word1> <byte2>|<word2>                 BINARY XOR
--------------------------------                 ----------

       Performs a binary XOR between the arguments and displays a result as in
'?' command.

Example:

^$ #FFAA                     Performs a binary XOR between value of currently
                             marked register and #FFAA, then displays result


4.4.   MONITOR ERROR MESSAGES
       ======================

"Invalid command"

       The monitor doesn't understand the given command.

"Syntax error"

       The given command is correct, but there is an error in its syntax,
usually in some of the parameters.

"Too few parameters"

       The given command expects more parameters than you gave. However, any
excess parameters are ignored.

"Parameter too big"

       Some parameter has too large a value for the given command.

"Overflow"

       The result of multiplication exceeds 16 bits, or the given command
performs division by zero.

"RAMPTOP too low"

       The minimal legal value for RAMPTOP in the A (ABORT) command is 23900.

"String not found"

       The command F was not found in the given sequence (or the next
occurrence of previously given sequence).

"Warning: ROM"

       The breakpoint can be put into ROM, but sometimes it is dangerous.

"MMU is locked"

       The command Y (or A) tried to switch memory banks when the 48K lock
bit is switched on (128 version only).

"No ZX Interface 1"

       The command Y tried to set the Interface 1 shadow ROM, but the
emulator was not started with the /E option (i.e. the Interface 1 wasn't
present)

"Abort may be 48 or 128"

       The first parameter of the A command in the 128 version of the
emulator must be 48 or 128 to specify the abort in '48 Basic' or '128 Basic'.

"File output error"

       For some reason, the monitor log file (MONITOR.OUT) wasn't opened
correctly with command O, or there was some error during writing to the
monitor log file.

"Type Q to quit"

       This is only a short help message in case you entered the monitor
because you pressed F3 by mistake.


5.     EXPANDING THE EMULATOR FROM THE USER
       ====================================

       The Warajevo emulator has the facility to be expanded from the user
with some features which are not initially included in it. For this, some
knowledge of machine language is necessary, for both the Spectrum and the PC.
So, if you are not an advanced user, you may skip this chapter, except
section 5.3. if you want emulation of a parallel Spectrum interface for the
printer.


5.1.   ADDING EMULATION OF A NEW PERIPHERAL DEVICE
       ===========================================

       The emulator allows you to make drivers for peripheral devices which
are not supported by the emulator in form of resident PC programs. For
example, it is possible to implement emulation of an AMX mouse using the PC
mouse, emulation of the Kempston parallel interface for the printer through
LPT1 port, emulation of several RAM and ROM expansions which were made for
the Spectrum, etc. The principle of expandion is in fact that if the emulator
doesn't recognize some OUT or IN instruction, it calls the handlers for the
80x86 interrupts INT 248 or INT 249 respectively, but only if there is a
signature 'USER' before the start of the handler code. Using a signature is
necessary because this prevent calling these interrupts if there were no
installed handlers (else this would cause a system crash). On entry to the
handler the CX register contains the address of the unrecognized I/O port.
The handler must check this address, and if it is not the address of the
wanted device to be added, the handler must perform only a IRET. If the
device address is recognized, after the necessary processing the handler must
perform STC and RETF 2. For expanding the IN instruction, on exit the AH
register must contain a number which will be returned through the IN
instruction, and for expanding OUT instruction the handler is called with the
AH register containng a number which will be sent to the port. On input, the
DS register points to the emulated Spectrum memory, and the registers need
not be saved. The stack size is limited to about 1000 bytes. For example, a
handler for emulating some memory expansion for the Spectrum from 48K to 80K
with two paging banks in the upper 32K of RAM, where instructions OUT 31,0 and
OUT 31,1 perform paging, may look like this:

           DB      'USER'              ; Signature

USEROUT:   CMP     CL,31               ; Address checking
           JZ      OUTOK
           IRET                        ; Exit if the address is not recognized

OUTOK:     MOV     AL,AH               ; Update variable which tells which
           XOR     AL,OLDBANK          ; bank is active, and finish if bank
           MOV     OLDBANK,AH          ; is not changed
           TEST    AL,1
           JZ      DONE
           MOV     SI,32768            ; Load SI with address of upper 32K RAM
           MOV     CX,SI               ; Length of bank is the same value
           LEA     DI,ALTBANK          ; Load DI with offset and ES with
           MOV     AX,SEG ALTBANK      ;  segment address of alternate bank
           MOV     ES,AX
EXC:       MOV     AL,ES:[DI]          ; Swap bytes into both banks
           XCHG    AL,[SI]
           STOSB
           INC     SI
           LOOP    EXC
DONE:      STC                         ; Signal 'OK'
           RETF    2

OLDBANK    DB      0                   ; Initially bank 0 is active

ALTBANK    DB      32768 DUP (?)       ; Space for the alternate bank

       Do not use U/I addresses which are in any way covered with some other
I/O devices (for example, the ULA chip covers all even I/O addresses) if you
don't want unwanted side effects. The ports for the joystick and ZX
Interface 1 are free for expanding if the options for emulation of these
devices (options /J and /E) are not active.

       The handler for additional devices may call all DOS and BIOS functions
without any limitations, but you must not overrun the stack size limit. The
handler may perform direct changing of memory content (even ROM content, so
it allows implementation of ROM expansions), but these "side effects" are not
recommended if they are not really necessary.

       In the emulator package there is a driver for emulation of the
parallel printer interface (see section 5.3.) in form of the source file
(PARALLEL.ASM) and the executable file (PARALLEL.COM). The driver is very
short (executable file is 92 bytes long) and the source file has very
detailed comments, so by analysing this file you may learn much more about
making external drivers for additional peripheral devices. Also, some
additional drivers may be found on the Warajevo home page:

http://www.void.demon.nl/warajevo/index.html


5.2.   USING 'ESCAPE' SEQUENCES
       ========================

       Sometimes it may be useful to patch into a Spectrum program something
which is not directly implementable into the emulator (for example, if you
want to add into a game the possibility of saving the High Score table
directly to the disc, etc.). That's why we've supported so-called Escape
sequences which allow temporarily breaking emulation of the Z80 processor and
patching sequences of instructions which will be executed under full control
of the 80x86 processor. This is one of the most powerful options in the
emulator, for anybody who knows to use it, because by taking full control
over the system it is possible to perform anything that a PC computer can do!
This feature is especially useful in compiled snapshot files (see chapter 6.).

       The emulator switches into direct mode when it finds, during
emulation, the sequence of bytes with codes #ED #00 (on a real Z80 processor
such instructions do nothing) with the ASCII signature '8086' which must
follow immediately after. The signature is necessary because we noticed that
some Spectrum programs (for example, The Train) for some mysterious reasons
contain sequences like #ED #00 etc. Therefore, after sequence #ED #00 '8086'
(e.g. #ED #00 #38 #30 #38 #36), which is called the Escape sequence, the
emulator treats any bytes which follow after this sequence like 80x86
instructions. Returning to normal mode (Z80 emulation mode) may be performed
by executing the 80x86 instruction INT 250.

       After switching to 80x86 mode, the AL, CX, DX and DI registers will
contain the values of the Z80 registers A, BC, DE and HL respectively. After
returning to Z80 mode, the registers AL, CX, DX, DI and BP will be copied into
the Z80 registers A, BC, DE, HL and SP. The registers AH, BX and SI on input
don't contain any usable values, nor will their contents have any meaning
after returning to Z80 emulation mode. The register DS points to the emulated
Spectrum memory (ROM and RAM, ROM in the direct 80x86 mode may also be
modified), as does the CS register. The registers SS and SP point to the
internal stack 1000 bytes long (you may change SS and SP if this space is not
sufficient, but this is not good practice). The register ES on the 48K
version of the emulator has no meaning, but on the 128K version of the
emulator it points to the parallel memory bank (see chapter 7.2.). The
emulator automatically recovers values of the segment registers (including
SS:SP) after returning to Z80 mode, so you need not save these registers.
However, the user must preserve value of ES segment register in 48K version of
the emulator. Also, returning to Z80 mode must be performed in the same
segment as the segment in which switching to 80x86 mode occurred, e.g. the CS
register must not be changed. In 80x86 mode all DOS and BIOS functions are
allowed.

       We will illustrate all these things by one example. Using an
assembler (for example, GENS) enter the following program on the (emulated)
Spectrum:

           ORG     40000
           LD      DE,NAME             ; This will load DX with address of
           JR      SAVE                ;  label NAME
NAME       DEFM    'SCREEN.DAT'
SAVE       DEFB    #ED,#00             ; Switch to 80x86 assembler
           DEFM    '8086'
           DEFB    #33,#C9             ;  XOR CX,CX     (Open file)
           DEFB    #B4,#3C             ;  MOV AH,3CH
           DEFB    #CD,#21             ;  INT 21H
           DEFB    #89,#C3             ;  MOV BX,AX
           DEFB    #BA,#00,#40         ;  MOV DX,16384  (Save block)
           DEFB    #B9,#00,#1B         ;  MOV CX,6912
           DEFB    #B4,#40             ;  MOV AH,40H
           DEFB    #CD,#21             ;  INT 21H
           DEFB    #B4,#3E             ;  MOV AH,3EH    (Close file)
           DEFB    #CD,#21             ;  INT 21H
           DEFB    #CD,#FA             ; Return to Z80 assembler (INT 250)
           RET

If don't have a assembler, enter this program using the following BASIC
program. After running this program, RANDOMIZE USR 40000 will save the
content of the screen directly onto the disc in file named SCREEN.DAT.

  10 FOR f=40000 TO 40045: READ a: POKE f,a: NEXT f
  20 DATA 17,69,156,24,10,83,67,82
  30 DATA 69,69,78,46,68,65,84,237
  40 DATA 0,56,48,56,54,51,201,180
  50 DATA 60,205,33,137,195,186,0,64
  60 DATA 185,0,27,180,64,205,33,180
  70 DATA 62,205,33,205,250,201

       If the program written in the 80x86 code changes the content of the
video memory, it is possible that this change will not be visible until the
first legal change of the video memory (using regular Z80 instructions),
because the emulator does not know that the video memory content is changed.
To solve this problem, you may, after returning to Z80 mode, force the
signal of changing the video memory by using:

           LD      A,(16384)
           LD      (16384),A

       The system variables of the emulator, and many tables and vectors, are
addressable using the SS: prefix. We will not describe such things, because
they may take too much space, and it is not of interest to most users. If
somebody wants to make something usable, and these informations are not
adequate, you may ask us for the necessary instructions.

       Implementing Escape sequences unfortunately opens up the possibility
of patching various 'Trojan horses' and 'Viruses' into Z80 snapshot files
(we were warned about this problem by some users of the emulator). To protect
your computer against the various dangers, we have included the command line
option /?86 which prohibits the use of Escape sequences, and causes an error
message if such a sequence appears in the code. So, if you do not trust some
snapshot file, activate this option, which guarantee absolute security.


5.3.   EMULATION OF THE PARALLEL PRINTER INTERFACE
       ===========================================

       The program PARALLEL.COM which comes in the package with the emulator
(only 92 bytes long) is the best illustration of expanding the emulator.
Start this program before starting the emulator for first time (virtually
nothing happens, but the driver will be loaded and activated). After this,
the emulator will support the emulation of Kempston parallel Centronics
printer interface (more precisely, the variant Kempston S of this interface)
using LPT1, although this device is not initially supported. You can try this
emulation with any program which supports this interface (for example, better
word processors like 'The Writer'). This driver is delivered also as an
assembly listing (PARALLEL.ASM) for you to analyse.


6.     PROGRAM 'ZXCOMP'
       ================

       Using the program ZXCOMP you can compile snapshot files into
standalone EXE programs which may be executed indepedently of the emulator
and the ROM files, and which has an execution speed which is independent of
the speed of the computer on which it is executed (except when the computer
is very slow). However, this compiling has the following limitations:

- Snapshot files which are saved while Interface 1 emulation was active can't
  be compiled. The emulation of the Spectrum +2 is not supported in compiled
  programs. Also, the emulation of Timex Sinclair is not supported nor is
  compiling of Timex snapshot files.
- You can not call the Tape Manager, monitor or the environment from the
  compiled program (because these are not included in the compiled program),
  so F2 and F3 have no functions. Also, F7, F8 and F9 will not work either.
- Any jumps to address 0 in a source program will cause the program to exit
  to DOS instead resetting the emulator. F10 does the same thing. When you
  exit a compiled program a small copyright message will be printed instead
  of the break address.
- F1 acts as a 'pause' key, not as HELP. Compiled programs will not draw the
  title screen.
- A compiled program does not support RS232, microdrive, Sinclair Network,
  Timex-specific peripherals, ZX printer and MIDI emulation, emulations of
  the user-defined I/O devices, tape system emulation, or the MLT loading
  system (MultiLevel Load Trap, see chapter 7.1.). However, loading and
  saving blocks is possible in two ways, using two special instructions with
  the codes #ED #FF and #ED #FE, or two the special instructions with codes
  #ED #FD and #ED #FC (see sections 6.2. and 6.3.).
- The command switches /2, /A, /B, /C, /D, /E, /F, /K, /L, /N, /O, /P, /R,
  /T, /Y, /#, /&, /%LMAX, /?128, /?86 and /@ make no sense in a compiled
  program. The command switch /! must not have a parameter.
- The sound options /SO, /SX and /SB are not supported (only AdLib FM
  synthesis and emulation through beeper are supported). Also, multicolor
  emulation and the option /QX are not supported.
- Only 'Warajevo' and Lunter's version 2.0. snapshot files can be compiled
  (not Lunter's snapshot files version 3.0.). This is not a problem because
  you can load Lunter's snapshot file version 3.0. into the 'Warajevo'
  emulator, and save it in 'Warajevo' format.

The main reason for not supporting something is that we don't want to fill
the compiled program with lot of routines which are needed only in a very
limited number of cases. Otherwise, nearly all the emulator code would be
embedded into a compiled program...


6.1.   COMPILING
       =========

       You can start the compiler from the DOS command line. ZXCOMP without
parameters will display a short message about compiling syntax. The syntax
is:

ZXCOMP <z80_file> [<exe_file> [<initial_switches>]]

where the parameters have the following meaning:

<z80_file>          Source snapshot file
<exe_file>          Target executable file
<initial_switches>  Command options which will be embedded into the compiled
                    program

If you omit the extension for the file <z80_file>, 'Z80' will be assumed. If
you omit the extension for the file <exe_file>, 'EXE' is assumed. If you omit
<exe_file>, the same name as in the file <z80_file> will be assumed.

       As command options you can use the options /!, /%, /J, /M, /Q, /S, /U
and /V with the same meaning as in the emulator (/SB is not allowed - use
/SA instead). There is one new option /Z which has the following meaning:

/Z0 - Keys F4, F5 and F6 will work in the compiled program (this is the
      default if you omit this option).
/Z1 - Key F4 will not work in the compiled program, but F5 and F6 will work.
/Z2 - Key F5 will not work in the compiled program, but F4 and F6 will work.
/Z3 - Keys F4 and F5 will not work in the compiled program, but F6 will work.
/Z4 - Key F6 will not work in the compiled program, but F4 and F5 will work.
/Z5 - Keys F4 and F6 will not work in the compiled program, but F5 will work.
/Z6 - Keys F5 and F6 will not work in the compiled program, but F4 will work.
/Z7 - Keys F4, F5 and F6 will not work in the compiled program.

If you type ZXCOMP /?, you will get some quick help about the allowed command
switches.

       We will illustrate these things with some examples:

ZXCOMP ATICATAC.Z80 ATICATAC.EXE /JM /JC /! /Z7 /%80

compiles the snapshot file ATICATAC.Z80 into the executable program
ATICATAC.EXE. In the compiled program the Kempston joystick will be emulated
using the mouse, and the cursor joystick will be emulated using the cursor
keys. A warning message will not be displayed if the processor is in 'Virtual
8086' mode. Only the F1 and F10 function keys will work. The execution speed
will be 80% of full Spectrum speed. Next,

ZXCOMP MONTY128 MONTY128 /SA

compiles the snapshot file MONTY128.Z80 (the game 'Aufwidersen Monty 128')
into the executable program MONTY128.EXE in which the AY sound chip will be
emulated using the AdLib compatible sound card.

       The command option /V acts like in the emulator, except that the
suboption /VX which activates the extended Hercules mode works only if a
real Hercules card is detected. For example, if you use

ZXCOMP MMINER MMINER /VX

then it will create an executable program MMINER.EXE which, on Hercules card
systems, works in extended Hercules mode, but it not force Hercules card,
e.g. this program will normally work on a VGA card.

       When compiling, you can see some data on screen. The field 'Length:'
contains the length of the source file. The field 'Compiling:' shows how many
bytes have been compiled. After compiling, the field 'Code:' contains the
length of the compiled program. It will typically be about 10-25 Kb longer
than a source file for 48K snapshot files and about 15-40 Kb for 128K
snapshot files. We must say that a compiled program is totally independent of
any file in this emulator package, and may be distributed without the
emulator.

       A compiled program may be started with the command options /%, /J, /S
and /V. These options will have override any options which are embedded in
the compiled program. For example,

ATICATAC /JA /%100

will start the earlier compiled program ATICATAC, with the Kempston joystick
emulated using the PC analogue joystick, and the program will run at full
speed (without slowing down). Similarly,

MMINER /VH

will start MMINER.EXE in the normal Hercules mode. Also, if you want to run
the program MONTY128.EXE from the above example on a computer without a
sound card, and if you want to instead use AY sound on the beeper, run it
using:

MONTY128 /S0

If you start a compiled program with the switch /?, you will get a short list
of all command line options which you may use with a compiled program.


6.2.   SUPPORTING OF SAVING AND LOADING BLOCKS
       =======================================

       Compiled program does not support emulation of tape system. However,
we want to enable possibility of status saving and loading from games which
have these options (for example, all adventure games), and possibility of
compiling games which load levels from the tape. So, we implemented two new
instructions, for saving and loading blocks directly from the disc. You must
put these instructions in the program (using our internal monitor) at
appropriate places before you save a snapshot file (this needs elementary
knowledge of machine code). These instructions have a following form:

DB #ED,#FE,'<filename>',0      Saves a block from address in register IX with
                               length in register DE on the disc with filename
                               <filename>.
DB #ED,#FF,'<filename>',0      Loads a block from the disc with filename
                               <filename> at address in register IX, with
                               length in register DE. If DE=0, the whole block
                               will be loaded regardless of its actual length
                               (this is a new feature of release 2.51.).

All registers will be unchanged. Flag C will be set if loading was correct. In
both cases error will cause warning sound.

       Here we will give two examples. If the game saves or loads status in
only one block, using standard routines at address 1218 and 1366 (or some
near addresses), you must replace CALL 1218 and CALL 1366 with CALL SAVE and
CALL LOAD, and put these routines at some free space in memory:

       SAVE   DB   #ED,#FE
              DB   'STATUS.DAT',0
              RET

       LOAD   DB   #ED,#FF
              DB   'STATUS.DAT',0
              RET

We can not say any special if game don't use ROM routines for loading and
saving. If game saves status in more than one block, or with header, situation
is a bit complex, but if you understand this example, this will not be a great
problem for you.

       If the game loads levels from a tape, you must extract levels using the
environment in separate files named for example LEVEL1.OVL, LEVEL2.OVL, etc.
For example, suppose that we have a game which loads levels using a subroutine
at address 40000, that register A before calling contains level number, and
that levels starts at address 49152 with length 16384. Then you must replace
CALL 50000 with CALL LLEVEL, and put following subroutine somewhere:

       LLEVEL LD   IX,49152
              LD   DE,16384
              ADD  A,'0'
              LD   (LNAME+5),A
              DB   #ED,#FF
       LNAME  DB   'LEVEL0.OVL',0
              RET

Similarly, you can easily solve many harder cases too, of course, if you have
elementary knowledge about machine code programming and load routines.

       Except these two instructions, we also support two instructions with
codes #ED #FC and #ED #FD which save and load block described by IX and DE
registers too, but they have not block filename as inline parameter. Instead,
filename will be automatically created depending of IX and DE values (more
precisely, filename will represent hexadecimal values of IX and DE registers).
Extension will always be '.DAT'. This may be practical if you have not enough
space to insert appropriate subroutines for saving and loading. For example,
you may replace instruction CALL 1218 with DB #ED,#FC and one NOP insctuction
(to fills one-byte free space).

       Escape sequences described in chapter 5.2. works into compiled programs
too, which may be very useful. So, if all described features will not help to
solving some problem, you can patch into program (if you know) a sequence of
80x86 instructions which will solve your problem!


6.3.   AUTOMATIZATION OF SAVE & LOAD SUPPORTING
       ========================================

       The support which is described in the section 6.2. has a great power,
but it is too hard for inexperienced users. So, we implemented option /TAPE in
ZXCOMP program which in many cases can automatically solve problem of game
status saving and loading. If game saves and loads status in only one block
using ROM subroutines, compiling with /TAPE option tries to automatically
accomplish inserting which is described in previous section. Block will have
same name as the name of EXE program, with extension '.DAT'. For example,

ZXCOMP KTYME KTYME /TAPE

compiles snapshot file KTYME.Z80 (game 'Knight time') into a executable
program with name KTYME.EXE which can save and load status into a block with
name KTYME.DAT. If you are not happy with this convention of names, you may
use expanded form of /TAPE option in format /TAPE:<filename>. For example,

ZXCOMP KTYME KTYME /TAPE:POSITION.STS /JM

performs some thing as a previous example but the block will have name
POSITION.STS (and with Kempston joystick emulation using mouse). If you omit
extension in name <filename>, '.DAT' will be assumed.

       In the case when game saves (loads) status in more than one block, you
can try option /TAPE!. This option acts as replacing calls to save and load
routines with #ED #FC and #ED #FD instructions. So, blocks which will be saved
will have unusual names, but very often this will work correctly. For example,
the game 'Hobbit' saves status into four blocks. If you compile this program
with:

ZXCOMP HOBBIT HOBBIT /TAPE!

compiled program will save (load) status into (from) four files with filenames
B5DC001C.DAT, C00B0614.DAT, C97300BF.DAT and B97A05D9.DAT. Of course, this
names are not beautiful, nor descriptive, but this is price of automatization.

       Option /TAPE supports automatization in many cases, but surely it can
not be all-powerful. The best is to try it. If compiled program using this
option correctly saves (loads) status, it is good. Else, if compiled program
don't work correctly, you must do manual modifications. Of course, if you know
how to do it. For loading levels from tape, automatization is usually not
possible, because levels loading is in different programs implemented on quite
different ways. On the Warajevo home page, you can find a lot of programs
turned into PC executables, which uses various tricks described above, and
escape sequences. Each program has the documentation which describe which
patches are made to produce an executable program. If you want to use ZXCOMP
seriously, these examples may be useful for you.


7.     TECHNICAL INFORMATIONS
       ======================


7.1.   Z80 PROCESSOR EMULATION
       ========================

       We emulate the Z80 processor very well. All standard instructions and
registers are emulated. There are even some instructions which are not listed
in the official Z80 manuals, which behave as on the original machine. Our
internal monitor will disassemble these instructions:

       The instruction NOPD is like the instruction NOP, but it is two bytes
long, and changes the R register differently (for example, the program
'The Train' uses it).

       The instruction 'IN F,(C)' reads a value from a port at the address
shown with register pair BC, throws away the result, but updates flags (in
some Z80 manuals this instruction is documented). There is yet another new I/O
instruction: 'OUT (C),0'.

       Many Z80 instructions have more than one code, for example: IM 0, IM 1,
IM 2, NEG, RETI, RETN. For example, NEG have even eight different codes.

       Instructions with codes #FC, #FD, #FE and #FF after #ED prefix have no
effect in the emulator (NOPD), but they have special meaning in ZXCOMP program
(see section 6.2.).

       There is instruction SLL that shifts one to the zero bit of argument.
All bits are shifted to the left. The most significant bit is shifted to C
flag.

       If you have the prefix #DD before an instruction which works with
register H or register L, this instruction will work with a higher or lower
byte of IX. Similarly, if the prefix byte is #FD, it will work with a higher
or lower byte of IY. These instructions have the mnemonic like LD XH,5. By the
way, these instructions are the most frequently used undocumented (synthetic)
instructions. If you have the prefix #DD (or #FD) before an instruction which
not affect registers H or L, this prefix will be ignored. Monitor will display
these pseudo prefixes as NOP IX and NOP IY.

       There are also new instructions with a double prefix (we discovered
them when analysing program '3D Labyrinth'). We called them using mnemonics
like RRP (IX+nn),r etc. These instructions rotate or shift the indexed
argument and then put a result in a register, which is second argument. For
example:

RRP (IX+5),B

will do:

LD B,(IX+5)
RR B
LD (IX+5),B

Similarly, we have RLP, RRCP, RLCP, SLAP, SLLP, SRAP and SRLP. We have also
the instructions like this:

SETP n,(IX+nn),r

For example:

SETP 5,(IY+6),H

will do:

LD H,(IY+6)
SET 5,H
LD (IY+6),H

We have RESP too, but instructions BITP do not exist, so instructions BIT with
indexed arguments in fact have eight different codes.

       In recent time, many emulators consider sequence of bytes #ED #FB or
#ED #F6 (earlier standard) as so-called 'MultiLevel load trap' for supporting
games which load levels from a tape (this is firstly implemented in XZX
emulator, and Lunter's Z80 emulator also supports this feature). Since
Warajevo emulator has indirect support of .SLT snapshot format (which needs
such treatment of additional levels), we implemented this feature too, but in
our emulator instructions #ED #FB and #ED #F6 (the monitor will display them
as MLT) load from the active TAP file block which ordinal number is determined
using A register on the address which is determined using HL register. This
behaviour is slightly different than in other emulators, but this is adapted
to our treatment of .SLT files. It is important that .SLT files after
conversion into Warajevo format will work. In other cases, when multi-level
program is not in SLT format, but in mixture of Z80 and DAT files (some
snapshots for XZX emulator uses such mixture), it is only needed to include
all DAT blocks into a TAP file using the environment, and such program will
work.

       While we emulated some instructions, we had to implement some specific
behaviour (trapping) for internal use into the emulator if these instructions
are on specific address. Specific instructions and addresses are listed in
this table (this is mainly transparent for the user):

Address    Instruction  With option      Purpose

    8      LD HL,(nn)   /E               Switch to Interface 1 ROM
  602      #ED #01      /A               Emulate pressing of ENTER key (128)
 1974      #ED #01      /A               Restore changed ROM after loading of
                                         first header (48, 128)
 1378      #ED #01      /A               Restore changed ROM after loading of
                                         first header (TS - Timex)
 4692      #ED #01      /A               Put LOAD "" in the editor buffer (48)
 2433      #ED #01      /A               Put LOAD "" in the editor buffer (TS)
 1232      EX AF,AF'    FAST,AUTO (Tape) Fast save block
  118      EX AF,AF'    FAST,AUTO (Tape) Fast save block (Timex)
 1388      CALL nnnn    FAST,AUTO (Tape) Fast load block
  274      CALL nnnn    FAST,AUTO (Tape) Fast load block (Timex)
 1792      RET          /E               Return to standard ROM
 5867      INC HL       /E               Switch to Interface 1 ROM
 xxxx      RST 0        Bxxxx (Monitor)  Jump to monitor it is a break point
                                         on this address
 xxxx      #ED #00      With signature   Escape sequence
 xxxx      #ED #F6      Always           Multilevel load trap
 xxxx      #ED #FB      Always           Multilevel load trap

       Instruction with codes #ED #00 followed by signature '8086' into the
emulator acts as Escape sequence. For details, see chapter 5.2.

       With option /B, RST 24 and RST 32 instructions, and RST 40 instructions
in Derby ROM (128 version only) are executed in one step. This accelerates
BASIC for about 10% (in 128 BASIC sometimes even 50%) but R register will not
be correctly changed by these instructions. However, R register is really
totally unimportant in BASIC programs.

       R register is incremented after every instruction by number of bytes
before first argument of the instruction, and it will always be fully emulated
because many programs for ZX Spectrum need correct emulation of this register.

       Instructions LDIR, LDDR, INIT etc. always work correctly, even in case
of self-modification. Namely, while many Z80 manuals declare that instruction
LDIR acts as

repeat
  (DE) <- (HL)
  DE <- DE + 1
  HL <- HL + 1
  BC <- BC - 1
until BC = 0

its real effect is:

(DE) <- (HL)
DE <- DE + 1
HL <- HL + 1
BC <- BC - 1
if BC <> 0 then
  PC <- PC -2
endif

This effect is fully emulated, because some Spectrum programs (like 'Rolling
Thunder') rely on this fact.

       Instruction CALL also may be self-modified. Instruction CALL nnnn acts
as sequence (assuming that PC is increased by three):

TEMP <- (PC-2)
SP <- SP - 2
(SP) <- PC
PC <- TEMP

but not as more obvious sequence:

SP <- SP - 2
(SP) <- PC
PC <- (PC-2)

The difference may be noticed only when SP points to the location immediately
after CALL instruction. In other words, argument nnnn before self-modification
is used, not after self-modification. One Spectrum program ('Batman') rely on
such behaviour.

       In a Z80 manual, influence to some flags with some instructions is
marked as '?' (unknown), like S flag after BIT instruction. We discovered
their meaning:

- S flag after BIT instruction is set only if 7-th bit is tested, and this bit
  is set. In all other cases S flag will be reset (program 'Sabre Wulf' uses
  this feature). P/V flag after BIT is equal to Z flag;
- H flag after 16-bit arithmetical instructions keeps carry from 11-th to
  12-th bit;
- After instruction CCF flag H is complement of the C flag;
- After instructions INI, IND, OUTI and OUTD state of the flags is like after
  instruction DEC B;
- After instructions INIR, INDR, OTIR and OTDR we have S=H=P/V=0, Z=N=1.

All these effects are implemented.

       Instructions OUTI, OUTD, OTIR and OTDR don't work as described in a Z80
manual. For example, OUTI inscruction don't acts like this:

Port [BC] <- (HL)
HL <- HL - 1
B <- B - 1

but like this:

B <- B - 1
Port [BC] <- (HL)
HL <- HL - 1

This is mostly unessential, because with these instructions high byte of I/O
address will be nearly always ignored (else these instructions will not be
usable). However, there is one hardware device (TurboDrive disc interface)
which control routines are based just on this anomaly! As we implement user
IN/OUT ports, due to such reason we implemented this feature too. Also,
Vaggelis Kapartzianis (author of ZX32 emulator) say that ZX Spectrum +3 disc
ROM routines needs emulation of this anomaly too.

       The processor Z80 after arithmetical and logical instructions copies
third and fifth byte of the result into bits 3 and 5 of the F register. The
complete emulation of this effect would increase minimal computer speed on
which Warajevo emulator is usable, but as we know only one program which uses
this effect (Ghost'n Goblins), this effect is partially implemented on such
way that PUSH AF instruction copies bits 3 and 5 of the A register into the F
register if after last POP AF instruction was performed some arithmetical
instruction. Instruction pair POP AF and PUSH AF will update these flags
correctly, like as EX AF,AF' instruction. Of course, this is not exact
emulation, but satisfies, and it is implemented without slowing down other
instructions, which would not be possible with full emulation of these bits.

       Unlike the original machine IM 2 will not make problems with the
Kempston joystick. Register I may points to anywhere, without problems,
although one program exists which uses problems with I register to make a
original effect of collision (Vectron). However, we decide to not implement
this effect (it is complicated for implementation, but not very useful).

       Nonmascable (NMI) interrupt is implemented only for users who want to
replace ZX48.ROM with his own, so key F8 is mostly useless.


7.2.   THE ROMS AND RAMS
       =================

       The ROMs are not changed. The user could change them (for example by
PCTOOLS) but if you make changes on addresses shown on table of the previous
paragraph, some things (like Interface 1 paging, etc.) will not work. Any POKE
to ROM is ignored, but these things change the contest of ROMs:

- Option /K (an inverse cursor) changes value at address 6355 from 0 to 12. On
  Timex version of the emulator address is 5663, not 6355.

- The break point may be in ROM.

- Escape sequences described into chapter 5.2. and drivers for user-defined
  IN/OUT instructions may write data into ROM.

- The option /A on 48 version of the emulator does following: It puts auto-run
  escape code #ED #01 at addresses 1974 and 4692. The initial attribute is
  changed from 56 to 7 or to value set by option /Y (at address 4710). The
  escape code at address 4692 stuffs LOAD "" and ENTER in the editor's buffer.
  Address 4769 is increased by 11 for skipping call of SET_MIN routine (see
  ROM disassembly). The beginning of PRINT_OUT routine (address 16) is changed
  to RET (to forbid 'Program: ...' message on screen). The emulator begins
  working at address 4591 (label RAM_DONE), not at 0. Finally, after loading
  of the first header, the escape code #ED #01 at address 1974 restores all
  changes in ROM.

- The option /A on 128 version of the emulator does following: It puts
  auto-run escape code #ED #01 at addresses 1974 in standard ROM and 602 in
  Derby ROM. The initial attribute is changed from 56 to 7 or to value set by
  option /Y (at address 520 in Derby ROM), and initial border is set
  accordingly (at address 535 in Derby ROM). The escape code at address 602
  emulates pressing of ENTER key by putting 13 in LAST_KEY variable and by
  setting bit 5 in FLAGS variable. The beginning of PRINT_OUT routine (address
  16 in both ROMs) is changed to RET (to forbid 'Program: ...' message on
  screen). Similar thing is done in PLOT subroutine (RET at address 8937 in
  standard ROM), to suppress menu drawing. If some of addresses 14307, 14345,
  14437 or 14470 in Derby ROM contains instructions LD (HL),A and INC HL,
  instruction LD (HL),A will be changed to NOP. This modification suppress
  some minor modification of screen (testing for these instructions is done
  because ordinary Spectrum 128 and +2 have different ROMs, and those
  instructions are not on same addresses). The emulator begins working at
  address 0 in Derby ROM (as usual). Finally, after loading of the first
  header, the escape code #ED #01 at address 1974 restores all changes in
  ROMs. This is quite complicate, but this works fine.

- The option /A on Timex version of the emulator does following: It puts
  auto-run escape code #ED #01 at addresses 1378 and 2433 in EXROM bank (or at
  addresses 1974 and 4692 if presence of ZX Spectrum ROM is noticed). The
  initial attribute is changed from 56 to 7 or to value set by option /Y (at
  address 3504 in HOME bank, or at address 4710 with ZX Spectrum ROM). The
  escape code at address 2433 (or 4692) stuffs LOAD "" and ENTER in the editor
  buffer. Jump at address 2463 in EXROM bank (or 4768 in HOME bank) is
  increased by 11 for skiping call of SET_MIN routine (see ROM disassembly).
  The beginning of PRINT_OUT routine (address 16, HOME bank) is changed to RET
  (to forbid 'Program: ...' message on screen). The emulator begins working at
  address 3413 in HOME bank, or at address 4591 in presence of ZX Spectrum ROM
  (label RAM_DONE), not at 0. Finally, after loading of the first header, the
  escape code #ED #01 at address 1378 (or 1974) restores all changes in ROM.

       RAM is so simple in 48 version of the emulator, and we cannot say any
special thing about it. But in 128 version of the emulator, RAMs paging is
important. We fully emulate paging of RAM addresses above 49152 (including
special treatment of pages 2 and 5 which are in fact copies of memory blocks
32768-49151 and 16384-32767 respectively). Unfortunately, RAM paging in the
emulator is very slow. But, ROM paging is extremely fast (this is not case in
other emulators)! Our emulator (version 128) in '128 Basic' on slow computers without EMS memory works many
times faster than Lunter's emulator (see menu drawing for example, or try to
use screen editor)! We use two parallel memory buffers, with identical RAM
images, but first buffer contains standard ROM, and second buffer contains
Derby ROM. So, ROM paging is implemented by swapping of some segment registers
which is extremely fast, but this method slows down RAM paging. However, we
detect presence of 80386 processor, and if it is present, we use some 80386
instructions (MOVSD instead of MOVSW) for speed up RAM paging twice. Slow RAM
paging may sometimes cause problems in programs which intensively swaps memory
pages. The worst case is like in following case, which sometimes appears into
128K programs, like in game 'Robocop':

          LD   HL,49152     ; Base address of memory banks
          LD   BC,32765     ; MMU port
          EXX
          LD   BC,16384     ; Bank length
          EXX
          LD   DE,4113      ; D = 16 (bank 0), E = 17 (bank 1)
 LOOP     OUT  (C),D        ; Activate bank 0 and get byte from it
          LD   A,(HL)
          OUT  (C),E        ; Activate bank 1 and put byte into it
          LD   (HL),A
          INC  HL           ; Increase pointer
          EXX
          DEC  BC           ; Repeat until whole bank is copied
          LD   A,B
          OR   C
          EXX
          JR   NZ,LOOP

In this case, there is no help, you must wait until routine finish (or use
faster computer). This routine will take about 20 seconds even on 133 MHz
Pentium (but on original Spectrum it is nearly instantaneous). Keep in mind
that the poor emulator in this routine must transfer even 1610612736 bytes
(1.5 Gb)! Some multicolor programs for Spectrum 128 (for example Echologia,
MDA demo and loader of Songs In Line 5) intensively swaps memory pages
continously, so they works much slower than on real Spectrum, except on
extremely fast computers. We want to say that recently we discovered a method
for solving this problem without EMS memory or DOS extenders, but its
implementation needs complete reorganization of whole emulator, so we prolong
solving of this problem for next release.

       Interface 1 ROM paging is also slow, but this is not a great problem
(only BASIC command MOVE is sometimes noticeable slow).

       On Timex version of the emulator, three 64-Kbyte memory banks are
implemented (HOME, EXROM and DOCK) which are divided into eight 8-Kbyte
chunks. Every chunk may behave like ROM or RAM, depending of settings. For
more details, see chapters 2.8. and 7.9.4.


7.3.   EMULATION OF I/O PORTS
       ======================


7.3.1. 'ULA' PORTS
       ===========

       Every port with address bit A0=0 acts on ULA chip (usually port 254).
We implemented this ports on the following way:

Output:   bits D0-D2: change border
          bit  D3:    tape output bit (works only in LPT1 mode)
          bit  D4:    toggle speaker for making BEEP

Input:    bits D0-D4: read keyboard halfrows, related with bits A8-A15
          bits D5,D7: always 1, as on real Spectrum
          bit  D6:    tape input bit, random value which solves problems with
                      some programs that requires exactly 'Issue 2' or
                      'Issue 3' release of the Spectrum, except when current
                      tape block contains samples of tone record or during
                      loading from real tape (modes LPT1 and SBST); in that
                      cases, value of bit D6 will be read from emulated tape
                      in according to the counter of T states (see chapter
                      7.4.) and sampling frequency, or from real tape

Every IN A,(254) instruction is checked for a part of loading routine, except
during loading from the samples. This will be explained later (chapter 7.15.).

       The emulator switches into sample loading mode when one of following
events happen:

- The emulator comes across the trap in LD_BYTES, but the current tape block
  is EAR Sample block;
- The emulator recognizes EDGE subroutine, but the current tape block is EAR
  Sample block;
- The last loaded block was normal (not EAR Sample) block, the current block
  is EAR Sample block, the EDGE subroutine is not active, and the emulator
  detects at least 100 reading from port 254;
- User leaves the Tape Manager with an EAR Sample block as the current block.

When the emulator switches into sample loading mode, the current EAR Sample
block is loaded into the buffer. Note that each continous sequence of EAR
Sample blocks need be observed as one logical unit, which is splitted to
chunks only due to limited (64K) buffer size. So, the pointer which emulator
uses to access data in the buffer is virtually 32-bit pointer. The pointer is
recalculated on each reading from port 254 in according to passed time from
the last reading from this port; when the pointer points out of buffer, a new
data will be read from the tape, and the pointer will be adjusted accordingly.

       The emulator switches off sample loading mode when one of following
events happen:

- The sample buffer pointer points out of buffer, but there is no new sample
  data (e.g. end of tape is reached, or next block on the tape is not EAR
  Sample block);
- User leaves the Tape Manager with a normal block as the current block.

So, we hope that you now understand why 'Infinite pause' TZX block is
converted to dummy normal block with zero size. This will switch off sample
reading.

       Our experience shows that described algorithm works fine even when the
TAP file is mixture of EAR Sample and normal blocks in any order, e.g.
automatic mode switching works correctly.


7.3.2. 'ZX PRINTER' PORTS
       ==================

       Every port with address bit A2=0 acts on the printer (usually 251). We
implemented following features:

Output:   bit  D1:    motor speed
          bit  D2:    motor on/off
          bit  D7:    styli on/off

Input:    bit  D0:    encoder bit
          bits D1-D5: always 1
          bit  D6:    printer present
          bit  D7:    out of paper

       Brief description of implementation of the ZX printer emulation: When
D2=1 (motor off), writing to this port is ignored. When D2=1, the state of bit
D7 sent to this port is buffered. When the buffer fills itself, or when the
motor is again off, the buffer is sent to the printer. One pixel on ZX printer
is emulated with a one pixel (or with a square of four pixels, depending of /P
option) on the Epson or HP Laser Jet printer. If D1=0 (motor works fast), the
buffer takes four rows of pixels. When D1=1, buffer takes only one row of
pixels. For input, the bit D0 is connected to READY of the printer, bit D6 to
ACK and bit D7 to 'Out of paper' signal. The latching of the bits D0 and D7 is
not emulated, but this is not important.

       All routines for the ZX printer which use standard protocol (reading
the encoder bit) will be correctly emulated, including ROM routines. There is
a small problem with ROM routines that will wait forever if the printer is
switched on, but off-line. Then switch off the printer, or change it to
ONLINE state.


7.3.3. 'KEMPSTON JOYSTICK' PORTS
       =========================

       Every port with A5=0 acts to the joystick while reading (usually 31),
depending on /J options. This port is read only:

Input:    bit  D0:    joystick moving to right (1=active)
          bit  D1:    joystick moving to left
          bit  D2:    joystick moving to down
          bit  D3:    joystick moving to right
          bit  D4:    status of joystick fire button (1=pressed)
          bits D5-D7: always 0, as on real Kempston interface

The option /JK will read this port from cursor keys and the grey '+' or '~'
key. The option /JA will read this port from the PC analogue joystick. The
option /JM will read this port from the mouse. The MOUSE.SYS or similar driver
must be installed in this case.

       If no /J option is present, this port will return 255 always, with
meaning 'Kempston interface not present'. Timex version of the emulator does
not support this port.


7.3.4. 'ZX INTERFACE 1' PORTS
       ======================

       Every port with A3=0 or A4=0 acts to the Interface 1 (typically ports
247, 239 and 231). These ports will be emulated only with option /E:

PORT 247 (INTERFACE 1 DATA REGISTER):
-------------------------------------

Output:   Acts as on real ZX Interface 1, e.g. bit D0 is RS232 output. We
          emulated RS232 output by buffering 8 bits after a start bit, and by
          sending to LPT1 when whole byte is received. Other bits are ignored,
          like on real Interface 1. If D0=0 in the Interface Control register,
          sending will be redirected to network instead to RS232. For more
          details, see description of the network emulation.

Input:    Bit D7 is RS232 input, and D0 is network input. Bits D1-D4 on real
          ZX Interface 1 are always 1, and bits D5 and D6 have random values,
          which are always 0 in this emulator. As this emulator don't emulate
          RS232 input, IN from this port will always return 30 or 31. For more
          details, see description of the network emulation.

PORT 239 (INTERFACE 1 CONTROL/STATUS REGISTER):
-----------------------------------------------

Output:   bit  D0:    COMMS DATA bit; 0 = output to network, 1 = output to
                      RS232; this bit is used also for indirect writing into
                      MICRODRIVE MOTOR register
          bit  D1:    COMMS CLK bit; every transition 1->0 cause copying old
                      value of COMMS DATA bit into MOTOR shift register, in
                      which every bit equals zero means that motor assigned to
                      this bit works
          bit  D2:    R/W' bit; 0 = writing to the microdrive, 1 = reading
          bit  D3:    ERASE bit; D3=0 means cartridge erasing is activated,
                      and this is used for creating GAPs between sectors; if
                      you retain D3=0 for a long time (with active motor)
                      without any writing to cartridge, complete content of
                      the cartridge will be erased
          bit  D4:    WAIT bit; D4=0 performs necessary synchronization before
                      serial receiving of one byte from the network

Input:    bit  D0:    0 means the cartridge is protected or the motor is not
                      active
          bit  D1:    Sync bit which will be zero when end of lead-in signal
                      is detected (emulated as always zero to remarkable speed
                      up ROM routines, except when sector is not formatted)
          bit  D2:    1 means a space without any data on it (called GAP) is
                      detected; the emulator treats as GAP every sector with
                      bad header checksum; some artificial GAP will be
                      inserted before every header and data block to satisfy
                      routines from ZX Interface 1 ROM
          bit  D3:    RS232 DTR bit (e.g. printer is ready)
          bits D4-D7: Always 1 (somebody tells that D4 has some meaning, and
                      calls it BUSY, but its meaning is unknown to us, and
                      ROM routines don't use it)

PORT 231 (MICRODRIVE DATA REGISTER):
------------------------------------

Output:   The bytes will be buffered, and will be flushed on the cartridge
          when changing of the control register occur or when occur such
          command from the timer.

Input:    Bytes will be read from the buffer, and buffer will be loaded from
          the cartridge file after the GAP which is emulated between sectors
          into routine for emulating status register, or when occur such
          command from the timer.

       Reading or writing to this port will cause ZX Spectrum crash if the
microdrive motor is not active. This effect is implemented too (only F9 will
help, or using the monitor to skip critical I/O instruction).


7.3.5. 'ZX SPECTRUM 128' PORTS
       =======================

       Every port with A1=0 acts to the Spectrum 128 peripherals (AY sound
chip, memory management, RS232, KEYPAD and MIDI ports). True meaning of this
ports depend of other address bits.

       Every port with A1=0 and A15=0 (usually 32765) acts to the memory
management unit. This port is write only:

Output:   bits D0-D2: select RAM bank at addresses above 49152
          bit  D3:    select active video page (0 = normal, 1 = alternative)
          bit  D4:    select active ROM (0 = Derby, 1 = Standard)
          bit  D5:    48K lock bit (1 = MMU is locked)

Due to hardware bug, reading this port is same as writing 255 at this port, so
IN 32765 will cause crash, as on real Spectrum 128. This effect is implemented
only at Warajevo emulator (that's why program Insane, which on most emulators
may be loaded either in 48 or 128 Basic, on Warajevo emulator must be loaded
into 48 Basic, like on real Spectrum).

       Every port with A1=0 and A15=1 acts to AY sound chip (and RS232, KEYPAD
and MIDI which work through register R14 of sound chip). When A14=1 (usually
port 65533) writing to this port selects active sound chip register, and
reading from this port returns value of active sound chip register. When A14=0
(usually 49149) writing to this port stores value in active AY sound chip
register, and reading from this port will always return 255. Some of the sound
chip registers have length smaller than 8 bits (extra bits is always zero).
This is brief table of sound chip registers:

Register  Length  Description

  R0        8     Fine control of channel A frequency
  R1        4     Coarse control of channel A frequency
  R2        8     Fine control of channel B frequency
  R3        4     Coarse control of channel B frequency
  R4        8     Fine control of channel B frequency
  R5        4     Coarse control of channel B frequency
  R6        6     Noise pseudofrequency (implemented only with options /SX and
                  /SB)
  R7        7     Mixer control:
                      D0 - if D0=0, channel A produce tone
                      D1 - if D1=0, channel B produce tone
                      D2 - if D2=0, channel C produce tone
                      D3 - if D3=0, channel A produce noise (not implemented
                           with options /S0-7)
                      D4 - if D4=0, channel B produce noise (not implemented
                           with options /S0-7)
                      D5 - if D5=0, channel C produce noise (not implemented
                           with options /S0-7)
                      D6 - if D6=0, register R14 is input port, else it is
                           output port
  R8        5     Channel A volume, if D4=1 envelope generator is used
  R9        5     Channel B volume, if D4=1 envelope generator is used
  R10       5     Channel C volume, if D4=1 envelope generator is used
  R11       8     Fine control of envelope period
  R12       8     Coarse control of envelope period
  R13       4     Envelope control register
                      D0 - HOLD bit
                      D1 - ALTERNATE bit
                      D2 - ATTACK bit
                      D3 - CONTINUE bit
  R14       8     Controls RS232, KEYPAD and MIDI (see text below)
  R15       8     Exists, but not in use (game OutRun tests presence of this
                  register)

Detailed description of exact behaviour of sound chip may be found in the
documentation given with Lunter's Z80 emulator release 3.5. When you try to
select register above R15, it seems that most significant 4 bits will be
ignored (can anybody confirm this to us)?

       When register R14 acts as output port (bit D6=1 in register R7), bits
in register R14 have following meanings:

Output:   bit  D0:    KEYPAD clock (see KEYPAD emulation)
          bit  D1,D4: have no meaning
          bit  D2:    CTS and MIDI output signal (CTS is not implemented,
                      MIDI output is implemented using analogous method like
                      RS232 output on ZX Interface 1, except that collected
                      byte will be sent to Sound Blaster MIDI output register)
          bit  D3:    RS232 output bit (implemented as on ZX Interface 1)
          bits D5-D7: masks for reading bits D5-D7 (see text below)

Input:    bits D0-D4: last values sent to these bits
          bit  D5:    KEYPAD response bit
          bit  D6:    DTR bit (i.e. printer is ready)
          bit  D7:    RS232 input bit (not implemented, always one)

The bits D5-D7 when reading return valid values only if they are not masked,
i.e. if corresponding mask bits is one, else they will return zeroes.

       When register R14 acts as input port (bit D6=0 in register R7, Spectrum
128 software never make this setting), bits in register R14 have following
meaning:

Output:   Ignored!

Input:    bits D0-D4: always one
          bit  D5:    KEYPAD response bit
          bit  D6:    DTR bit (i.e. printer is ready)
          bit  D7:    RS232 input bit (not implemented, always one)

In this case, bits D5-D7 could not be masked.

7.3.6. 'TIMEX SINCLAIR 2068' PORTS
       ===========================

       Timex Sinclair 2068 has additional I/O ports. It seems that low byte of
these I/O addresses are fully decodes, so we implement these ports using this
assumption. We have no informations whether other ports (like ULA port) is
decoded fully, or partial like ordinary Spectrum.

PORT 255 (TIMEX CONTROL REGISTER):
----------------------------------

Output:   bit  D0:    When D0=0, main video data (data about pixels on the
                      screen) is located in block at address 16384 (like on
                      ordinary Spectrum), else it is located in block at
                      address 24576
          bit  D1:    When D1=0, color attributes are 8x8 pixels in size, they
                      occupies 768 bytes, and they are located just after main
                      video memory (address 22528 like on ordinary Spectrum if
                      D0=0, or 30720 when D0=1); when D1=1, color attributes
                      are 8x1 pixels in size, occupies 6144 bytes, and they
                      are located at address 24576 (more precise, when D1=0,
                      every 8x1 attribute is multiplicated eight times to make
                      one 8x8 attribute)
          bit  D2:    When D2=0, main video data and attributes are used as
                      described above; D2=1 activates extended resolution of
                      512x192 pixels (64x24 text), where main video data (from
                      address determined by D0) will be inserted in even
                      columns (0, 2, 4...), and in odd columns (1, 3, 5...)
                      will be inserted values which normally would be color
                      attributes data, determined by D1 (this usually has
                      sense only with D1=1, when odd columns will be inserted
                      from block at address 24576); color attributes does not
                      exist when D2=1 (then only two colors exist: unique ink
                      color and unique paper color)
          bits D3-D5: Selection of ink and paper color in extended screen
                      resolution mode (000=black/white, 001=blue/yellow,
                      010=red/cyan, 011=magenta/green, 100=green/magenta,
                      101=cyan/red, 110=yellow/blue, 111=white/black); these
                      bits are ignored when D2=0
          bit  D6:    D6=1 forbid generation of the timer interrupt
          bit  D7:    Selection of alternate memory bank which will be
                      activated using horizontal MMU register (0 = DOCK,
                      1 = EXROM)

From the description above, one can conclude that only four combinations of
bits D0-D2 may be useful:

  000 - Video data at address 16384 and 8x8 color attributes at address 22528
        (like on ordinary Spectrum);
  001 - Video data at address 24576 and 8x8 color attributes at address 30720;
  010 - Multicolor mode: video data at address 16384 and 8x1 color attributes
        at address 24576;
  110 - Extended resolution: without color attributes, even columns of video
        data are taken from address 16384, and odd columns of video data are
        taken from address 24576

Combinations 011, 100, 101 and 111 are possible, but they will not give usable
results. However, all 8 combinations is fully implemented in the emulator,
giving four 'silly' video modes.

Input:    Returns last value sent to this port.

PORT 244 (HORIZONTAL MMU REGISTER):
-----------------------------------

Output:   Every bit in this register is linked with one 8-Kbyte chunk of
          64-Kbyte Z80 address space (bit D0 corresponds to addresses 0-8191,
          D1 to addresses 8192-16383 and so on). When a bit is reset, linked
          chunk belongs to HOME bank, and when a bit is set, linked chunk
          belongs to one of alternative banks (DOCK or EXROM, depending of bit
          D7 in port 255). Notice that DOCK and EXROM chunks never can be
          simultaneously present in the address space.

Input:    Returns last value sent to this port.

PORT 245 (SOUND CHIP REGISTER SELECTION):
-----------------------------------------

Output:   Selects active sound chip register, like port 65533 on Spectrum 128.

Input:    Always 255.

PORT 246 (SOUND CHIP REGISTERS):
--------------------------------

Output:   Writes sent value to active sound chip register, like port 49149 on
          Spectrum 128.

Input:    Reads a value from active sound chip register.

Everything is here similar like on Spectrum 128, except usage of register R14
is different, mainly for joystick reading. Then address bits A8 and A9
determines whether left or right joystick will be read (01=left, 10=right,
11=both reading are OR-ed). So, for left joystick reading mainly port 502 is
used, and for right joystick reading port 758 is used (of course, with R14 as
active register). When R14 acts as output port (bit D6=1 in register R7), bits
in register R14 have following meaning:

Output:   bits D0-D4: 'masks' for bits D0-D4 reading (see text below); also
                      these bits may be used in various independent
                      peripherals
          bit  D5:    D5=0 enables access to 16 MB bus expansion unit which
                      seems to never have been released (not implemented)
          bits D6-D7: usable in various independent peripherals

Input:    bit  D0:    joystick moving to up (0=active)
          bit  D1:    joystick moving to down
          bit  D2:    joystick moving to left
          bit  D3:    joystick moving to right
          bit  D4:    status of joystick fire button (0=active)
          bits D5-D7: last values sent to these bits

The bits D0-D4 when reading return valid values only if they are not masked,
i.e. if corresponding mask bits is one, else they will return zeroes. When
register R14 acts as input port (bit D6=0 in register R7, this is the only
reliable way for joystick reading), bits in register R14 have following
meaning:

Output:   Ignored!

Input:    bit  D0:    joystick moving to up (0=active)
          bit  D1:    joystick moving to down
          bit  D2:    joystick moving to left
          bit  D3:    joystick moving to right
          bit  D4:    status of joystick fire button (0=active)
          bits D5-D7: always one

In this case, bits D0-D4 could not be masked.

PORT 127 (AERCO PRINTER INTERFACE):
-----------------------------------

Output:   Sends byte to the printer.

Input:    bit  D0:    not used, probably always 1 (not confirmed)
          bit  D1:    0 = printer present, 1 = printer not present
          bit  D2:    not used, probably always 1 (not confirmed)
          bit  D3:    must be 0 for correct working in the emulator (exact
                      meaning is not known to us)
          bit  D4:    0 = printer ready, 1 = printer not ready
          bits D5-D7: not used, probably always 1 (not confirmed)

Alternate reading and writing from this port generates 'strobe' signal for the
printer.


7.3.7. 'BUS IDLE' PORT
       ===============

       Every port which does not affect any peripheral device, for example
port who has all bits from A0 to A7 identical to 1 (most frequently, port 255)
is a 'bus idle' port. This port keeps (unintentionally) the current value that
ULA reads from the screen memory and sends it to the video device. We emulated
(quite good) this undocumented effect, so programs which use this port (like
'Arkanoid', 'Stalone Cobra', 'Galactic Gunners', 'Renegate' etc.) will work.
It seems that Timex Sinclair does not support this effect, so on Timex version
of the emulator this effect is not implemented.


7.4.   THE EMULATION OF THE ACCURATE TIMING
       ====================================

       In Warajevo emulator every emulated instruction updates counter of T
states, and every 224 T states which is duration of one screen SCAN line (or
228 T states on 128 version) a routine will be called which checks how many
time is passed until previous call of this routine (using PC timer), and, if
this time is shorter than a time which would flow on real ZX Spectrum (0.064
ms) a time compensation will be performed. On the other side, if passed time
is greater than on real machine (for example, due to performing some
instruction which is very slow on the emulator), time excess will be
subtracted from duration of time compensation in further calls of the
compensation routine. Using this method, we realized very stable time
compensation, and good equality with speed of the real Spectrum, which allows
working of such time dependent routines like loading from the real tape and
digital sound. Routine which performs this task is very dirty and efficient,
so range of machines on which this emulator can work on normal speed is very
broad for today criteria. Unfortunately, timing of collisions between ULA chip
and Z80 processor is not emulated exactly, but only estimated (by the way,
this is top topic of authors of many Spectrum emulators, and their wounded
point). So, don't use Warajevo emulator for developing of multicolor demos
(for this purpose, we recommend ZX32 emulator by Vaggelis Kapartzianis).
Spectrum interrupt will be called after 312 scan lines, e.g. after 69888 T
states (311 scan lines or 70908 T states on 128 version, and 262 scan lines or
58688 T states on Timex version).


7.5.   THE EMULATION OF THE VIDEO MEMORY
       =================================

       Border on Hercules, CGA and EGA Mono cards is realized as a thin frame
around the displayed picture. On VGA and EGA cards, it is realized using
palette changing of one pseudo color which makes a frame around the screen.
Unfortunately, emulated border above and below paper is too thin to allow
displaying of border effects which are located on topmost part of the screen
(it is worth to look program MDA demo on ZX32 emulator).

       Attributes on CGA, Hercules and EGA Mono are emulated with shading. VGA
and EGA cards use a special mode. It is text mode with one (or two at EGA)
pixel height of chars redefined to look like high resolution graphic. Such
mode allows very fast updating of video memory, which allows implementation of
multicolor effects even on medium fast computers.

       Warajevo 2.51. has two method of screen updating. Using first method
(like in release 2.0.) the screen is updated periodically, synchronized with
timer interrupt, like on real Spectrum. Using this method, we removed in most
of the games problems with flickering and 'ghosting'. However, real Spectrum
draws picture gradually, line by line, and this process take 60% of interrupt
frame. The emulator in this mode draws the picture in a one time. So, programs
which are strongly dependent of precise video timing (for example, multicolor
effects) will not work quite good. Also, flickering is still possible in this
mode (although it is not frequent occurrence). The emulator updates screen
when counter of scan lines (see previous chapter) reaches a value set using /Q
parameter. In opposite to Lunter's emulator, our emulator will not update
screen if the emulator notice that there is no changed bytes into the video
memory after the last screen updating. This feature allows very high quality
of emulated sound.

       Using second method of screen updating (which is implemented only on
VGA card), the screen is updating in a small chunks at the moments which
correspond to the time when the real Spectrum update this segment of the
screen. This enables working of very time-dependent graphic routines, like
multicolor effects. Unfortunately, such routines are extremely dependent of
exact timing of interaction between Z80 processor and Spectrum ULA chip. This
timing on Warajevo emulator is not implemented exactly. Instead, it is only
estimated, so some programs still will not work quite perfect. However,
Warajevo emulator recognizes well-known multicolor routines and it adapt
itself to them, so a lot of multicolor programs will work correctly.

       Warajevo 2.0. emulator on VGA card also emulates hires border effects,
although not completely. Namely, on real Spectrum is possible that one scan
line on border has many different colors, but on Warajevo 2.0. emulator one
scan line on border will always has one color. More precisely, during calling
routine for time compensation (see previous chapter), the emulator paints
current scan line on border with the last value sent to ULA port. This works
fine in majority of programs with hires border effects (like 'Vectron', 'GU!',
'Treasure Island', '4D Terror Daktil' etc.). When hires border emulation is
active, the emulator also performs some estimations of timing of interaction
between processor and ULA chip, to allow correct generating of border effects
in programs which access video memory during making hires border effects (for
example 'Aquaplane').

       FLASH exists on all cards, except on CGA, on which FLASH will be
converted to inverse character. This is because we realized FLASH by changing
the graphic pages (this method allows high sound quality). CGA has only one.
BRIGHT is implemented only on EGA and VGA. As EGA card has no two levels of
yellow color, dark yellow is replaced with brown, but on VGA card all colors
are like on real ZX Spectrum.

       Timex Sinclair 2068 extra video modes are not yet emulated absolute
perfectly. Namely, on real Timex it is possible using very dirty interrupt
based routines to make more than two colors in 512x192 mode. As extremely
simplified example, BASIC program

10 OUT 255,6: OUT 255,14: PAUSE 1: GO TO 10

will produce blue_on_yellow stripe across black_on_white screen, in hires
mode. This will not work correctly on Warajevo. Also, it is possible (using
similar method) that one part of the screen has one video mode, other part
other video mode, etc. For example, BASIC program

10 OUT 255,0: OUT 255,6: PAUSE 1: GO TO 10

will produce one hires (512x192) stripe in medres (256x192) surrounding on
real Timex. This program on Warajevo emulator produces something extremely
ugly (try these effects on Multimachine emulator, it seems that MultiMachine
emulates these effects correctly). Implementation of such effects needs more
informations about video timing on Timex, so if you have such infos (and
informations does the Timex has contended RAM), please send it to us!
Fortunately, it seems that nobody produces a software which uses described
effects, although such effects was very popular on Commodore 64.


7.6.   THE EMULATION OF THE BEEPER AND THE AY CHIP
       ===========================================

       The Spectrum beeper sound looks very well and clear. Due to precise
timing, even very time-depended sound routines (for example, 'Wham the music
box') work quite good. Many other polyphonic tones sounds excellently, for
example in 'Four soccer simulator', 'Vectron' and 'Top gun'.

       128 version of the emulator starting from release 2.5. emulates AY
sound using four different methods. Using first method, emulation is performed
through PC beeper using interlacing of sound channels. Using second method, FM
synthesis is used on AdLib compatible sound card. Third method uses exact AY
emulation where AY behaviour is fully emulated by software, and calculated
emulated AY output is redirected to the speaker with help of Sound Blaster
card. Fourth method is similar like third, but emulated AY output is truncated
to 1 bit and redirected to PC beeper, where the clipping threshold is adapted
to the signal.

       With AY emulation using interlacing, every channel have 20 ms, then the
emulator gives a chance to next active channel. So, if it is only one active
channel, sound is totally clear, else you can hear interlacing. Very often,
this sounds quite good, usually better than in other emulators on beeper. If
the sound is bad, you may use /S option. The emulator treats as active channel
every channel which has volume greater than 7 (including envelope effects),
and which has corresponding bit in register R7 with value 0. Beeper will still
work during AY is emulated, because AY is emulated using PC timer chip, and
beeper is emulated toggling the 'enable' bit of PC speaker, so AY and beeper
sound are ANDed. In this mode of AY chip emulation, noise generator is not
implemented.

       With AY emulation using FM synthesis, such AdLib register settings are
used which achieves nearly equal tone color as on real AY chip. Majority of
effects are implemented, except changing of noise pseudofrequency, digital
sound effects and speech synthesis, which is impossible with FM synthesis.

       With exact AY emulation, every 228 T states (224 on Timex release) a
subroutine is called which calculates what would be output signal of real AY
chip at this moment. We thought that it would be enough to sent calculated
value to the speaker using direct writing to Sound Blaster DSP processor.
Unfortunately, DSP have too slow response for this purpose. That's why we use
DMA transfer, but our DMA buffer is only one byte long (calculated value is
stored in this buffer, and DSP picks it periodically from time to time). Using
this method we need not to allocate big DMA buffers, and we prevent great
lossing of time needed to update big buffers (this is the biggest lossing of
time in X128 emulator). Drawback in our method is fact that it is extremely
sensitive to requirement that emulated 228 T states must have duration which
is not longer that duration of 228 T states on real Spectrum. If this
requirement is not satisfied, sound degradation will occur. That's why the
sound in this mode is a bit unclear under Windows. Great problem appears in
programs which frequently perform memory paging on Spectrum 128 (extremely
slow operation). Slow paging causes disturbing of precise timing, so it will
result in noticeable degradation of sound quality. This problem will be solved
when we solve problem of slow memory paging (see chapter 7.2.).

       Fourth method of AY emulation is similar like third method, but
calculated AY output is truncated to 1 bit and redirected to PC beeper, where
the clipping threshold will be adapted to average magnitude of the calculated
output signal. This mode was introduced purely experimentally, but we noticed
that it often sounds quite good...

       In all four modes of AY emulation, the envelope generator is emulated
too, using timer interrupt.


7.7.   THE EMULATION OF THE KEYBOARD AND THE KEYPAD
       ============================================

       Keyboard emulation is simple: the emulator installs a new handler for
keyboard interrupt, which keeps keyboard state in similar way as on real
Spectrum. Later, when the program reads keyboard ports, emulator reads this
state, so keyboard reading is smooth and extremely fast. However, 'matrix'
effect is not emulated, so CAPS SHIFT + SYMBOL SHIFT + Z will not generate
BREAK. We think that this is really not very important, although some
emulators include this effect too.

       KEYPAD (at Spectrum 128) is a quite complex device, but it is not
obvious at a first look (this is a reason why it was so expensive). KEYPAD
controller is a (hardware) finite automate with time-outs, which changes state
on every transient of a KEYPAD clock pulse. It is implemented on the emulator
as a software finite automate. KEYPAD controller communicate with Spectrum 128
using very unusual serial protocol. When we first time connect KEYPAD on the
Spectrum, KEYPAD controller goes through following sequence of states (this is
initial test sequence, states is grouped in groups of four states for more
readability):

1011 0111 0111 0111 0111

After this, KEYPAD controller enters a working loop. It scans rows of KEYPAD.
If we numerate rows from 1 to 5 (1 is a top row), the controller scans rows in
following order: 5, 4, 1, 2, 3. If controller detects that keys positions
(non-press or press) in current row is not changed since last scanning,
controller goes through following sequence of states:

0011

Otherwise (if some key in current row changes its position), controller goes
through following sequence of states:

0111 0A11 0B11 0C11 0D11

Letters A, B, C, D have meaning 'state of first, second etc. key in current
row' (1 = pressed, 0 = released). After first row, KEYPAD controller scans a
next row, and so on. If clock pulse is set for a long time, KEYPAD controller
will go out of working loop, e.g. it will reset, and next time, responds with
initial test sequence.

       As you see, KEYPAD protocol is very complex, and ROM routine which
reads KEYPAD is long (and slow, that is reason why KEYPAD emulation slows down
BASIC programs). The system variables ROW01, ROW23 and ROW45 (addresses 23432,
23433 and 23434) keeps bit images of KEYPAD keys, and ROM routine decode this
bits differently, depending of active mode ('128 Basic' or 'Calculator'), more
precisely, depending of bit 0 in system variable FLAGS3 (address 23398).
INKEY$ function in BASIC will read KEYPAD too and for KEYPAD keys it will
return codes as with ordinary number keys (except if you give command like
POKE 23398,0 within BASIC program). Variable ROW01 contains some flags for
KEYPAD reading too:

D7=0 & D6=0 => ROM routine waits for reset of KEYPAD controller and responding
               with initial sequence (during this, bit D0=1 means waiting for
               reset, and then ROW23 acts as waiting counter);
D7=1 & D6=0 => ROM routine detects that something is wrong with KEYPAD and
               stops any following scanning;
D7=1 & D6=1 => KEYPAD controller is into working loop.

So, if you execute POKE 23432,128 from BASIC, ROM routine will not scan the
KEYPAD, and this will speed up BASIC program (even when KEYPAD emulation is
active).

       On a real Spectrum 128, when KEYPAD is not connect, bit D5 in register
R14 will be always 1. However, in the emulator, this bit is 0 when the KEYPAD
emulation is not active. This is done because with this bit as zero ROM
routine which scans the KEYPAD will fail (and exit with NOTDONE status)
earlier, and this trick slightly speeds up interrupt routine when KEYPAD
emulation is not active).


7.8.   THE EMULATION OF SINCLAIR NETWORK
       =================================

       To understand the network emulation, an explanation about principles
of real Sinclair Network is necessary. On real ZX Spectrum, the network uses
connection using simple pair of wires: the signal wire (0/+5V) and the ground
wire. If two computers do transmission at the same time, the state +5V has
precedence over the 0 state. So, when a station wants to send data package
(which may have from 1 to 255 bytes), it first monitors the state of the net
line long enough to detect whether some other station already transmits data
in this moment. If no pulses are detected, the station transmits a single byte
containing the station number (bit by bit, and slowly). During transmitting
this byte, it monitors the net (by reading the state of the line) to check
whether a collision happens, which would mean that some other station tries
the same action in the same moment. If a collision happens, the station stops
transmitting, waits a random time, and after this tries to claim the net all
over again.

       Once the net is claimed, a short package is sent (serial, bit by bit),
which contains 8-byte header, in the following format:

Byte    Length  Name     Meaning

  1       1     NCIRIS   The destination station number
  2       1     NCSELF   The number of the station which performs transmission
  3       2     NCNUM    Data package number
  5       1     NCTYPE   Type of the package (0 = data, 1 = EOF)
  6       1     NCOBL    Number of data bytes in the package (0 - 255)
  7       1     NCDCS    Data checksum
  8       1     NCHCS    The header checksum

For this time, the receiving station waits appearance of a signal on the line
after certain line idle period. When the signal is detected, after some time
delay (which allows sender station to finish claiming the net) the station
starts receiving of the package, bit by bit. Due to internal synchronization
(with little help of Interface 1 hardware), before receiving of each byte bit
D4 (wait) in ZX Interface 1 is set down to 0. Of course, receiving station
firstly expects package which contains a header. If it conclude that received
package is like what it expects, it then sends to sender acknowledge signal in
form of short one-byte ACK package (this is simply byte 1), using the same
method (including claiming, etc.). If the sender does not receive ACK in
expected time, it repeats whole operation (of course, including net claiming).
Else, it sends data package to the receiving station, which receives it, and
sends ACK again. If the sender does not receive ACK, whole procedure will also
be repeated. Pure sending of data package is incredibly fast (above 80 Kbit/s)
regardless of silly hardware realization, but claiming protocol, various
synchronizations, and transfer protocol itself makes effective transfer speed
much slower.

       This principle can not be implemented on the emulator, due to we
obviously can not have net control on such low level. Therefore, the sender
during claiming the net simply returns with IN values which are sent to "net
line" using OUT (more precisely, negated values, because receiving and sending
use mutually complementary values due to inversion which performs the ZX
Interface 1 hardware due to rather unclear reasons). So, claiming successes
always, regardless of what really happens on the net (this is not reality, but
we really have not any method to determine state of PC net on data-link
level). After "claiming", IN from the net returns 0 (free), except when shared
interface net file is locked or changed, which means that sender writes (or
wrote) data in it. In such case, IN from the net returns 1 (busy). To prevent
too frequent access to the shared file, after IN from the net detects signal
"busy" or "free", the same value will be returned during next <busy_len> or
<free_len> reading the net port respectively.

       The emulator signal WAIT=0 in control register of ZX Interface 1
considers as the signal that it is time for package reading. In such case, the
net file is read in a buffer, and it will be read from the buffer (using IN)
bit by bit.

       We want to tell about writing to network port that collected bits are
buffered, and when whole package is collected, it will be written in the net
file (during writing this file is locked). Just here is the greatest problem
with the network emulation. On real Spectrum, sending and reading of each
byte will be performed in same moment, but this is impossible on the emulator.
Since interface file is updated only when a package is collected, the emulator
after every updating of the net file stops working for about <block_delay>/18
seconds (with default value 30 this is about 2 seconds), which gives chance to
receiving station to receive content of sent package (the receiving station
will get information about appearance of the "signal" on the net not earlier
than the shared file is updated, which is just right moment) before the sender
requests ACK from it.

       The main problem with our implementation of the net protocol is in the
fact that net claiming always success fictively, but this will not always
realize necessary synchronity between sender and receiver station. Of course,
the consequence is frequent retransmissions of packages. The special problem
is when the receiver expects data package, but the sender sent a header
package, and so on. Often, package interchanging in a right moment is more a
incident than planed action. This is a reason why broadcasting don't work yet.
Namely, in this mode of transmission, full transfer protocol is not used (ACK
will not be sent, nor received), so every package which is not received in a
right time will simply be lost (retransmissions will not be performed). As our
protocol has no correct synchronization, the probability that such sent
package will be correctly received is not great. But, any attempt to improve
the protocol on such way which guarantee "meeting of sent and received
package" and which retain I/O level of the emulation, always causes a
deadlock. This is situation in which for example both stations sent packages
simultaneously, and waits (simultaneously) for a another station receives this
package (e.g. waits forever). This problem is still open, and maybe will be
solved in a new release of the emulator. Maybe, a idea for successful solving
of network emulation problems will come from some of users of Warajevo
emulator...


7.9.   THE FORMATS OF THE FILES
       ========================


7.9.1. TAPE FILES
       ==========

       TAP files (tapes) in native Warajevo format have following structure:

       At the beginning of the file there are four bytes which contain the
pointer to the first block. Then follow four bytes with pointer to the last
block. The next four bytes contain #FFFFFFFF, which is characteristic of
native Warajevo format. So, empty tape have a format:

#04 #00 #00 #00 #00 #00 #00 #00 #FF #FF #FF #FF

       Sequence #00 #00 #00 #00 #FF #FF #FF #FF is, in fact, a EOF (end of
file) marker. Every block contains following:

- 4 bytes, a pointer to the previous block, which is 0 for first block;
- 4 bytes, a pointer to the next block or to the EOF marker for last block;
- 2 bytes, block size without a flag byte;
- 1 byte, a flag byte;
- the data bytes.

       This is, in fact, double-linked list. The native Warajevo format don't
keep control bytes (parity bytes) of the blocks, but the emulator calculates
them using a flag byte and data bytes.

       If the block size is 65535, it is a compressed block. Its structure is
a bit different and looks like:

- 4 bytes, a pointer to the previous block, which is 0 for first block;
- 4 bytes, pointer to the next block, or to the EOF marker for last block;
- 2 bytes, value 65535;
- 1 byte, a flag byte;
- 2 bytes, decompressed (logical) block size;
- 2 bytes, compressed (psychical) block size;
- 2 bytes, signature length (internal);
- the data bytes (compressed).

       Signatures are data which are important for the imploding algorithm
used in the Warajevo emulator. This algorithm, when decompressing, copies
bytes from the source file, or returns back for a few bytes, and copies some
bytes from a destination file. Used algorithm is described at the end of this
chapter.

       If the block size is 65534, it is a block which contains tone record
samples. Its structure is like:

- 4 bytes, a pointer to the previous block, which is 0 for first block;
- 4 bytes, pointer to the next block, or to the EOF marker for last block;
- 2 bytes, value 65534;
- 1 byte, a status byte; bits B0-B2 in this byte contain informations which
  tell how many bits in the last byte in the block are used (number of used
  bits is, in fact, number stored in B0-B2 increased by one), bits B3-B4
  contain informations about sampling frequency (with meaning 00 - 15000 Hz,
  01 - 22050 Hz, 10 - 30303 Hz, 11 - 44100 Hz), and bits B5-B7 are not used;
- 2 bytes, decompressed (logical) block size;
- 2 bytes, compressed (psychical) block size; if these 2 lengths are equal,
  the block is not compressed;
- 2 bytes, signature length (internal, for compressed blocks);
- the samples (binary), 8 samples are packed into one byte (starting from B7
  to B0); whole package of such sample bytes may be either compressed or
  uncompressed (the last byte need not contain all 8 bits).

       If bytes 9, 10, 11 and 12 into a TAP file are not equal to #FF, this is
TAP file which is not in native Warajevo TAP format. The emulator in this case
assumes Lunter's TAP format which is simply linear sequence of blocks which
contain the following:

- 2 bytes, block size including a flag byte and a parity byte;
- 1 byte, a flag byte;
- the data bytes;
- 1 byte, a parity byte.

       The explanation of compressed data bytes is rather complex. We used
format similar to format used in PKLITE, but unlike PKLITE where signature
bytes are mixed with data bytes, we divided them in two parts, for easier
debugging. So, compressed data bytes starts with signature bytes, then follows
actual data bytes, immediately after signature bytes. Remember basic elements
of Imploding (LZ77) algorithm. It depends on copying of some byte sequences.
For example, sequence

#3D #18 #2E #42 #3D #18 #2E #15 #42 #3D #19

will be encoded as:

#3D #18 #2E #42
<Return for 4 bytes and copy 3 bytes>
#15
<Return for 5 bytes and copy 2 bytes>
#19

The different archivers (PKZIP, LHARC, ARJ etc.) differs on way of encoding of
this special 'Return for...' code. We already told that in Warajevo compressed
format, there are two parts: signatures and data. In our example coding of
signatures will be (binary):

00001001 010100xx                 (xx - not used, so don't care)

while data bytes will be:

#3D #18 #2E #42 #04 #15 #05 #19

The signatures are bits which describe what to do with data bytes. When the
signature bit is 0, corresponding data byte is simple data byte (it may be
simply copied from input to output file). When the signature bit is 1, this is
code for returning. In our example, four zeros in signatures means that four
bytes can be simply copied (#3D, #18, #2E, #42) to output buffer. The next bit
is 1. This means "Return for xxxx bytes and copy yyyy". Now, we will explain
this case in detail.

       The value of yyyy (size of string to be copied) is embedded in
signatures if yyyy is less than 10, or in both signatures and data bytes if
yyyy greater of equal 10 (used principle is, in fact, Huffman statistical
coding). So, the size yyyy depends on next 2-4 signature bits:

Bits    Size (yyyy)

010     2
00      3
100     4
101     5
011     >= 10
1100    6
1101    7
1110    8
1111    9

If size yyyy is greater or equal than 10 (code 011 in signatures), the next
data byte contains yyyy-10. That means: maximal string size is 265 (255+10).

       The next data byte determine lower byte of distance of string to be
copied (e.g. lower byte of xxxx). If yyyy=2, higher bit is always zero (so,
for this size distance can be maximally 255). If yyyy differs from 2, the next
1-6 signature bits determine higher byte:

Bits    Higher byte of xxxx

1       0
0000    1
0001    2
00100   3
00101   4
00110   5
00111   6
01bbbb  7+bbbb

Obviously, higher byte is maximal 23, so maximal distance is 6143 bytes. To
understand algorithm, experiment with some compressed ASCII text. Complex?
Yes, it is. Samir spent more than 30 days in developing algorithm, analysing
of some archivers, optimizing compression speed (it is still slow, but
acceptable, although decompression speed is very high), and he worked mostly
on paper, because it was in hardest days of summer 1993, without electric
power, water and food (in this time we loosed 1 kg weekly), when only miracle
saved Sarajevo of fall. In this time we had not leave the army building, and
while we waited for a new battle tasks, Samir developed the compression
algorithm...


7.9.2. SNAPSHOT FILES
       ==============

       This format is compatible with the format of the emulator 'Z80' written
by Gerton Lunter. While loading, the emulator keeps compatibility with
releases up to 3.03. (including), but our emulator always saves snapshot files
as release 2.0. of Lunter's emulator. This format is as follows (be aware of
some Timex specificity):

Byte    Length  Description

  0       1     A register
  1       1     F register
  2       2     BC register pair (LSB, i.e. C, first)
  4       2     HL register pair
  6       2     Always 0 (the emulator creates snapshoot files like release
                2.0 of Lunter's 'Z80' emulator)
  8       2     Stack pointer (SP)
 10       1     Interrupt register (I)
 11       1     Refresh register (R), bit 7 is not significant!
 12       1         Bit  D0:    bit 7 of the R-register
                    Bits D1-D3: border color
                    Bit  D4:    always 0
                    Bit  D5:    always 1 (e.g. blocks are always compressed)
                    Bits D6-D7: not used
 13       2     DE register pair
 15       2     BC' register pair
 17       2     DE' register pair
 19       2     HL' register pair
 21       1     A' register
 22       1     F' register
 23       2     IY register (Again LSB first)
 25       2     IX register
 27       1     Interrupt flip-flop IFF1 (0 = DI, otherwise EI)
 28       1     IFF2 (not particularly important...)
 29       1     Interrupt mode (0, 1 or 2)
 30       2     Length of additional header block (contains 23)
 32       2     Program counter (PC)
 34       1     Hardware mode: 0 = Spectrum 48K, 1 = Spectrum 48K with ZX
                Interface 1, 3 = Spectrum 128K, 4 = Spectrum 128K with ZX
                Interface 1, 128 = Timex Sinclair 2068
 35       1     In version 128, contains last OUT to 32765; in Timex version
                contains last OUT to port 244
 36       1     Contains 255 if Interface 1 ROM paged in, except on Timex
                version; on Timex version contains last OUT to port 255
 37       1     Some flags
                    Bit  D0:    Always 1 (e.g. active R register emulation)
                    Bit  D1:    Always 1 (e.g. always full LDIR emulation)
 38       1     Last OUT to port 65533 (AY register number, 128 version) or
                to port 245 (Timex version)
 39      16     Contents of the AY chip registers (128 or Timex version)

       Hereafter a number of memory blocks follow, each containing the
compressed data of a 16K block. The structure of a memory block is:

Byte    Length  Description

  0       2     Length of data (without this 3-byte header)
  2       1     Page number of block
  3       ?     Compressed data

       The pages are numbered, depending on the hardware mode, in the
following way:

Page:   In 48 or Timex version:     In 128 version:

   0    Standard 48 ROM             Standard 128 ROM
   1    Interface 1 shadow ROM      Interface 1 shadow ROM
   2    -                           Derby 128 ROM
   3    -                           RAM, page 0 (49152-65535)
   4    RAM, 32768-49151            RAM, page 1 (49152-65535)
   5    RAM, 49152-65535            RAM, page 2 (49152-65535 or 32768-49151)
   6    -                           RAM, page 3 (49152-65535)
   7    -                           RAM, page 4 (49152-65535)
   8    RAM, 16384-32767            RAM, page 5 (49152-65535 or 16384-32767)
   9    -                           RAM, page 6 (49152-65535)
  10    -                           RAM, page 7 (49152-65535)

In 48 version, pages 4, 5 and 8 are saved. In 128 version, all pages from 3 to
10 are saved. Pages will be saved in numerical order. On Timex version of the
emulator, content of all eventual memory expansions (DOCK etc.) are not kept
in snapshot files, but in separate DCK files due to necessary flexibility.

       The compression method is very simple: it replaces repetitions of at
least five equal bytes by a 4-byte code #ED #ED #xx #yy, which stands for
'byte #yy repeated #xx times'. Only sequences of length at least 5 are coded.
The only exception is sequences consisting of #ED's; if they are encountered,
even two #ED's are encoded into #ED #ED #02 #ED. Finally, every byte directly
following a single #ED is not taken into a block, for example #ED #00 #00 #00
#00 #00 #00 is not encoded into #ED #ED #ED #06 #00 but into #ED #00 #ED #ED
#05 #00.

       Important: because we want to be compatible with Lunter's snapshot
format, we do not put in snapshot file some things that are important for
'edge recognizer', ZX Printer emulation, and RS232 emulation. So if you create
snapshot file (by pressing F7 key) during loading program with unusual loading
routine, or during writing on ZX Printer, when you load snapshot file back
into the emulator, program will not be continued correctly in all cases. We
perform saving of snapshot files exactly in the moment when Z80 interrupt
starts (e.g. after 'vertical retrace' signal), to eliminate problems about
keeping timing data in a snapshot file.


7.9.3. MDR FILES
       =========

       MDR files consists of several number (from 10 to 254) of sectors, where
every sector is 543 bytes long. If the file length is not divisible by 543,
the extra bytes will be simply ignored. In the Lunter's emulator, number of
the sectors is always 254, and on the end of the file there is always one
extra byte. If you create MDR file from the environment of the Warajevo
emulator, created file will always have one extra byte, so if you select 254
sectors file length, the file format will be compatible with Lunter's format
(the same format uses emulator Spectator for the QL by Carlo Delhez and XZX
for XWindows by Erik Kunze and Des Harriot). This extra byte on Lunter's
emulator determines whether the cartridge is write-protected, but in our
emulator this byte has no meaning. Our emulator determines write-protect
status using the read-only attribute of the MDR file.

       On the real cartridge, structure of one sector is following. After a
little gap, 12 bytes follows (10 zeros and 2 #FF bytes) which represents
lead-in signal, then 15 bytes of the sector header, last byte of the header is
the checksum (by modulo 255, not 256). After this, follows a new gap, new
lead-in signal, then a 528 bytes long data block. First 15 bytes of the data
block are block descriptor (with structure similar like sector header), next
512 bytes are actual data, and finally, the last byte is data checksum (also
by modulo 255). The lead-in signal is used only for synchronization (with real
hardware) so we will not keep it into MDR file. That's why, sector length is
15+528=543 bytes.

       Psychical structure of the sector is not important for the emulator
itself (it is important only for ROM routines), because emulator only buffers
values sent to port 231 (or from port 231) and updates it when it is right time
(see chapter 7.3.4.). The buffer alternatively changes maximal length from 15
to 528 bytes and vice versa, because on real microdrive we always have
sequence header/block/header/block etc. However, the environment has commands
for viewing and changing a whole sector area (see chapter 3.4.2), so the
description of meaning of all bytes into a sector may be useful:

Byte    Length  Name     Description

  0       1     HDFLAG   Header flag byte, bit D0 is 1 to mark header, other
                         bits are not used
  1       1     HDNUMB   Logical number of the sector
  2       2     HDEMPTY  Not used
  4      10     HDNAME   Cartridge name (e.g. the name given by FORMAT) padded
                         with blanks
 14       1     HDCHK    Header checksum by modulo 255 (checksum of the first
                         14 bytes)
 15       1     RECFLG   Data block flag byte:
                             Bit  D0:    Always 0, to mark data block
                             Bit  D1:    EOF bit, set if this sector is the
                                         last sector assigned to some file
                             Bit  D2:    Clear if block belongs to file
                                         created using PRINT#
                             Bits D3-D7: Not used (always 0)
 16       1     RECNUM   Determines which part of file allocated in this
                         sector lays in this sector (counting starts from 0)
 17       2     RECLEN   Actual data length into the block (Û512), if the
                         block is not a EOF block, RECLEN must be 512;
                         unallocated sector has RECLEN=0 with clear EOF bit,
                         and a bad sector has also RECLEN=0 with set EOF bit
 19      10     RECNAM   Name of the file allocated into the sector (padded
                         with blanks)
 29       1     DESCHK   Checksum of the descriptor (e.g. of the last 14
                         bytes) by modulo 255
 30     512     DATA     Actual data
542       1     DCHK     Checksum of the actual data (of whole 512 bytes, even
                         if RECLEN<512) by modulo 255

       The first 9 bytes in the actual data of the sector which has RECNUM=0
for a files created using SAVE* command, not using PRINT# (so-called non-PRINT
files) contain additional informations about the file:

Byte    Length  Description

  0       1     File type (0-BASIC, 1/2-DATA, 3-CODE)
  1       2     Number of bytes into the file
  3       2     Start address of the file
  5       2     Length of program zone (only for BASIC)
  7       2     Autorun line (only for BASIC)

       The emulator every sector with wrong header checksum treats like a gap.
Also, during emulation of IN 239 instruction (reading of the status register),
a artificial gap will be "added" between sectors, and between header and data
block.

7.9.4. DCK FILES
       =========

       DCK files keeps information about memory content of various Timex
memory expansions, and information which chunks of extra memory are RAM chunks
and which chunks are ROM chunks. Such files have relatively simple format. At
the beginning of a DCK file, a nine-byte header is located. First byte is bank
ID with following meaning:

0:     DOCK bank (the most frequent variant)
1-253: Reserved for expansions which allow more than three 64 Kb banks (not
       implemented at this moment)
254:   EXROM bank (using this ID you may insert RAM or ROM chunks into EXROM
       bank, such hardware units exist on real Timex Sinclair)
255:   HOME bank (mainly useless, HOME content is typically stored in a Z80
       file); however, using this bank ID you may replace content of Timex
       HOME ROM, or turn Timex HOME ROM into RAM

This numbering of banks is in according to convention used in various routines
from Timex ROM.

       After the first byte, following eight bytes corresponds to eight 8K
chunks in the bank. Organization of each byte is as follows:

bit  D0:    0 = read-only chunk, 1 = read/write chunk
bit  D1:    0 = memory image for corresponding chunk is not present in DCK
            file, 1 = memory image is present in DCK file
bits D2-D7: reserved (all zeros)

To be more clear, these bytes will have following values:

- 0, for non-existent chunks (reading from such chunks must return default
     values for given bank; for example, #FF in DOCK bank, and ghost images of
     8K Timex EXROM in EXROM bank)
- 1, for RAM chunks, where initial RAM content is not given (in the emulator
     such chunks will be initially filled with zeros)
- 2, for ROM chunks
- 3, for RAM chunks where initial RAM content is given (this is need to allow
     saving content of expanded RAM; also this is useful for emulating
     non-volatile battery-protected RAM expansions)

       After the header, a pure image of each presented chunk is stored in DCK
file. Some examples will help understanding of such organization. 16 Kb long
LROS program needs header 0,2,2,0,0,0,0,0,0 in front of pure binary image of
this program. 24 Kb long AROS program needs header 255,0,0,0,0,2,2,2,0 in
front of binary image of it to become a valid DCK file. 64 Kb DOCK RAM disc
cartridge (64K of empty RAM) may be described as only 9-byte long DCK file
with content 0,1,1,1,1,1,1,1,1. 32 Kb EXROM RAM disc cartridge mapped at
address 32768 may be described also using 9-byte long DCK file with content
254,0,0,0,0,1,1,1,1. If you put a 9-byte header 255,2,2,0,0,0,0,0,0 in front
of binary image of standard ZX Spectrum ROM, you will get DCK file which will
replace Timex HOME ROM with ordinary Spectrum ROM (e.g. you will achieve Timex
Sinclair 2048). At the last, if you put a header 255,3,3,0,0,0,0,0,0 in front
of binary image of Timex HOME ROM, you will allow writing in the HOME ROM!

       That's all if only one bank is stored in DCK file. Else, after the
memory image, a new 9-byte header for next bank follows, and so on.


7.9.5. NET FILES
       =========

       The organization of the net files is very simple. They have 260 bytes
(or more, but excess bytes will not be used), with following structure:

Byte    Length  Description

  0       2     Package ID (used for fast checking whether content of the Net
                file is changed)
  2       2     Reserved; not yet used
  4     256     Content of the package


7.9.6. PALETTE FILES
       =============

Palette file WARAJEVO.PAL is simple 48-byte long binary file, in which first
three bytes correspond to R, G and B value for color 0, next three bytes
correspond to RGB for color 1, etc. First 24 bytes are related to BRIGHT 0
colors, and next 24 bytes are related to BRIGHT 1 colors. All values are in
range 0-63. Why this file is binary instead of ASCII file? Because it is very
tedious to read ASCII file format from a pure assembler...


7.9.7. DATABASE FILES
       ==============

       We use the classic database DBF format. Here will be explained only the
meaning of the fields. These fields maybe have strange names, because names
are acronyms or words in Bosnian language.

File: SOFTWARE.DBF
------------------

Field Name    Description                      Type  Width  Dcp

DODATNI       For future expansion              AN     10
GODISTE       Year of production                AN      4
KOMPJUTER     Computer type                     AN      4
MATERJEZIK    Messages language                 AN      4
OPIS          Program description (descriptor)  MO     10
POZICIJA      Block position in the tape        NU      3     0
PRIORITET     Marking sign                      AN      1
PROBLEMI      Problems (coded)                  NU      5     0
PROIZVODJ     Producer                          AN      4
PUNOIME       Full name of the program          AN     30
SIMULOPC      Startup options                   AN     50
SKRACENO      Short name                        AN     10
TRAKA         Tape (or snapshot etc.) name      AN     10
VRSTA         Category of the program           AN      4

Record length: 149

Fields MATERJEZIK, PROIZVODJ and VRSTA don't contain full text, but only the
internal code (due to space saving). The full text which correspond to the
code is stored in the file ADDITION.DBF. In the field TRAKA last 2 characters
represent identification cone which allows you to have more files with same
name if they are in different directories.

File: ADDITION.DBF
------------------

Field Name    Description                   Type  Width  Dcp

REDPODAT      See below                      AN     60

The first letter of REDPODAT is P, V, J, T, S, M or O, for producer, category,
language, tape file, snapshot file, cartridge file, or other-type file
respectively. If it is P, V or J then follows four letters for a code and
then 55 letters for the corresponding name. In other cases, a file name with a
file descriptor follows.


7.10.  'WRAPPING' PROBLEM
       ==================

       Processors I80286 and later ones generate INT 0DH when reading word
from the address 65535. We wrote the handler for this interrupt routine.
However, QEMM, EMM386, MS Windows etc. have also the same handler, which has a
greater priority than our handler if processor is 80386 (or better), because
these programs turns processor in so-called 'Virtual 8086 mode' and so the
emulator has no full control of situation. The consequence is conflict with
these programs, and a possibility of crashing some Spectrum programs, which
else should not crash (on MS Windows it mainly results with message like 'This
program has performed an illegal operation and will be shut down', and under
QEMM the consequence is mainly hanging up the computer). So, be very careful
if you use the emulator with these programs. Probability of this problem is
greatly reduced starting from release 2.0.

       The emulator will display warning message if processor is in 'virtual'
mode. See description of the command option /!.


7.11.  COMMUNICATION PROTOCOLS
       =======================

      This is communication procedure for sending to Spectrum in pseudo Pascal
which is used in the environment (if you want to write own communication
program on Spectrum, e.g. on Spectrum 48K). Surely, corresponding program on
Spectrum is complementary:

procedure SendToSpectrum(Addr,Size:word; Flag:byte);

begin
   Modem_DTR(0);
   Bytes:=Size+3;
   Send(Lo(Bytes));                    {Send the size with complement}
   Send(255-Lo(Bytes));
   Send(Hi(Bytes));
   Send(255-Hi(Bytes));
   Send(Flag);                         {Send the flag byte with complement}
   Send(255-Flag);
   Parity:=Flag;
   for j:=0 to Size-1 do begin         {Do like classic save routine}
      Byte:=GetFromMemory(Address);
      inc(Address);
      Parity:=Parity xor Byte;
      Send(Byte)
   end;
   Send(Parity)
end;

       This is communication procedure for receiveing from Spectrum in pseudo
Pascal which is used in the environment (different protocol is used from some
practical reasons):

procedure ReceiveFromSpectrum(Address:word; var Size:word; var Flag:byte);

begin
   Modem_DTR(1);
   repeat
      Receive(Byte1);                  {Read signature bytes}
      Receive(Byte2);
      Receive(Byte3);
      Receive(Byte4);
      Receive(Byte5);
      Receive(Byte6);
      if (Byte1+Byte2=255) and (Byte3+Byte4=255) and (Byte5+Byte6=255) then
         SignsOK:=true
      else begin
         SignsOK:=false;
         AbortTransfer
      end
   until SignsOK;
   Counter:=Byte1+256*Byte3;
   Size:=Counter-3;
   Flag:=Byte5;
   Address:=0;
   repeat
      CheckSum:=0;
      repeat
         Receive(Byte);
         PutIntoMemory(Address,Byte);
         CheckSum:=CheckSum+Byte;
         Inc(Address);
         Dec(Counter)
      until Lo(Counter)=0;
      Receive(Byte);                   {Checksum is sent every 256 bytes}
      if Byte=CheckSum then
         DisplayOK
      else begin
         Modem_DTR(0);
         AbortTransfer
      end
   until Counter=0;
   Modem_DTR(0)
end;

       The communication program is 6000 bytes long Z80 binary file. It may
also have different size (if you wrote own communication program), but in that
case transferring instructions for users will not be fully correct.


7.12.  INFORMATIONS FOR USERS OF NEWER OPERATING SYSTEMS (MS WINDOWS ETC.)
       ===================================================================

       This emulator is not specially designed to be used with MS Windows.
However, Windows can also run DOS applications. Here are the informations
which are necessary if you want to use the emulator on MS Windows or other
modern operating systems (the file WARAJEVO.ICO with MS Windows icon is also
supported in the emulator package).

       On MS Windows 3.11. and on earlier releases, you must create a PIF file
for the emulator. Then, you must to know that the applications SPEC48.EXE and
SPEC128.EXE work in text or graphic mode. The required memory is about 550K or
more. These programs are very dirty written, to be as many efficient as
possible, and intensively access internal resources of the computer (like
controllers) directly on I/O level. So, executing of these programs under MS
Windows may cause some problems. Sometimes a problems like non-continous
working, bad sound quality, worse keyboard reading etc. may appear. A problems
with "wrapping" (see chapter 7.10.) may appear too. Sometimes program may
crash without clear reason. If you however use the emulator under MS Windows,
use full screen mode, not windowed mode.

       Warajevo emulator can work under MS Windows even in window and in
parallel with other applications (although not absolutely clear, there are
sometimes some messages written after finishing the job and sometimes some
keys locks up). However, there is a limit that (on VGA card) the emulator must
be started with option /VC or /VW (see chapter 2.1.) to initialize CGA graphic
mode. The picture is not in color (/VC) or with very strange colors (/VW), it
is not painted smoothly, sound is distorted, the system is relatively slow -
but it works! The Hercules, EGA and VGA mode MS Windows does not emulate
(more precisely, does not emulate modes which we are used). If you have not
enough fast computer, do not think about executing of Spectrum programs in a
window.

       If you execute emulator under Windows in EGA or VGA mode, do not try
switching into a windowed mode during working. If you do it, a strange picture
will appear on screen, and it will not be corrected even after returning into
full screen mode, except if you install task switch handler using option /!1.
However, this handler will not work on all machines.

       For working under Windows 95, the same remarks as with Windows 3.11.
are valid, although using experience we notice that Warajevo emulator works
quite stable on Windows 95 (much more stable than under Windows 3.11.). In
'full screen' mode, often nothing bad will happen, even the sound is rather
clear if no other application execute in the background. The only severe
problem may sometimes be "wrapping problem" (see chapter 7.10.). If you have
problems, execute option 'Restart the computer in MS-DOS mode' in Windows 95.
Using it, you will force Windows to work like DOS, so you will not have any
problems with the emulator.

       Avoid task switching using Alt+Tab when you are in the emulator,
especially if you don't install task switch handler (without handler it will
cause trash on the screen)! Even if you install such handler and if it works,
don't make task switches except when it is really necessary. Archive file
ICO&PIFS.ZIP contains PIF files which are made with settings which are the
best solution for the Warajevo emulator, so unpack this file to achieve the
best working under Windows 95.

       On Windows 95, you can easy register Spectrum files (Z80, TAP, SNA, TZX
etc.) to program WARAJEVO.EXE using utility MAKEREG.EXE. First, unpack file
ICO&PIFS.ZIP which contains set of icons for Spectrum file types. Then, run
MAKEREG utility in the directory in which Warajevo emulator is located. Select
file types which you want to register (default is all, but you maybe don't
want to register SCR files because Windows screen savers have same extension
etc.). After this, file WARAJEVO.REG which contains registration entries for
updating Windows registry files is created. Then, the program will ask you
do you want automatically updating the registry file. If your answer is no,
you may edit this file to change something in it (not recommended if you are
not experienced Windows user) and update it later. When updating is finished,
double clicking on Spectrum related files will automatically load them into
the emulator and run. Also, right mouse clicking on Warajevo files will open
popup menu with following additions:

- 'Compile' for Z80 files: Invoke compiler ZXCOMP to compile this snapshot.

- 'Quick run' for Z80 files: Allows fast start of Z80 snapshots bypassing the
  environment and configuration file, passing the snapshot directly to the
  SPEC128.EXE only with parameters /! and /N.

- 'Edit' for Z80, TAP and MDR files: Loads file in the environment, so the
  file will be ready for working (inspecting, editing, running etc.), but
  don't start it automatically.

       About working on Windows NT, the working is possible only into full
screen mode, and in windowed mode screen is frozen. The beeper sound is really
terrible, you can hear only continual buzz which is mostly independent on real
melody. Emulation of AY chip using beeper works (except with /SX), but using
AdLib or Sound Blaster don't work. Some Spectrum programs may cause crash.
Speed measuring is incorrect under NT, so use /%200 for nearly real Spectrum
speed. Turn the CAPS LOCK off before running the Warajevo on NT, because it
seems that the code for turning off CAPS LOCK which is built into the Warajevo
does not work on NT, so the keyboard will be locked...

       We have informations from users that Warajevo works better under OS/2
than other Spectrum emulators, precisely there are no problems with keyboard.
We were not able to check it.

       The environment and program ZXCOMP may be in window and in multitasking
mode without any problems. Ensure for them about 500K of memory or more. The
environment directly modifies one COM port, if you used 'Communication'
options (which are not recommended under Windows). Any working with real tape
is impossible under any version of MS Windows.


7.13.  ASSIGNMENT OF THE NET DRIVE
       ===========================

      Skip this chapter if you don't want to use Sinclair Network emulation,
or if you don't know anything about modern operating systems. This chapter is
not related with the emulator itself, but with operating systems.

      For the emulation of the Sinclair Network, a drive which is accessible
to all emulators which takes part in the session is necessary. Warajevo is DOS
emulator, so Microsoft UNC convention about names is not supported. So, you
must map net drive to be accessible by a letter, like ordinary local drive.
To achieve this, perform following steps:

1) Determine the computer which will contain the net file. Let it have name
   MYSERVER, and let it have TCP/IP address 150.142.18.95. Let the user which
   has access rights to the directory which interface net file has name John,
   with password GOPLEASE. Suppose that this user has full control over the
   directory ZXCHANGE. Define this directory as shared directory using
   Explorer, File Manager, or from command prompt using command:

   NET SHARE ZXCHANGE=C:\ZXCHANGE

2) If you are into local network or onto the Internet, every client machine
   must be set to have access to MYSERVER computer. There are various
   possibilities:

   a) Inside the same NT domain or workgroup, if you are connected as user
      John on the client, connect yourself as drive Q: on MYSERVER directory
      ZXCHANGE. This may be performed using Explorer, File Manager, or using
      DOS prompt command:

      NET USE Q: \\MYSERVER\ZXCHANGE

      This process is similar on MS DOS with Network Client for WFW, Windows
      3.11 for WorkGroups, Windows 95 and Windows NT.

   b) Inside the same local network but different NT domain, a problems with
      access rights are possible. The best solution is logging as concrete
      user using command

      NET USE Q: \\MYSERVER\ZXCHANGE GOPLEASE /USER:JOHN

      if you are local user, or using command

      NET USE Q: \\MYSERVER\ZXCHANGE GOPLEASE /USER:MYDOMAIN\JOHN

      if you are user from NT domain on which MYSERVER is located.

   c) If MYSERVER is on the other side of the Internet, and the client is NT
      3.51, it must be registered in LMHOSTS file. Select the Network icon
      from the Control Panel. In the Installed Network Software listbox,
      select TCP/IP protocol, and click on Configure in TCP/IP Configuration
      window. Select option Advanced and check field Enable LMHOSTS Lookup.
      Click on OK to exit from this option. Now, create the file

      C:\WINNT35\DRIVERS\ETC\LMHOSTS

      with content

      MYSERVER 150.142.18.95 #PRE

      or

      MYSERVER 150.142.18.95 #PRE #DOM:MYDOMAIN

      if MYSERVER is member of NT domain. After this, perform NBTSTAT -R and
      continue as in variant b). If the connection is still not possible, and
      you are sure that NT or WIN95 computer is set up correctly, maybe
      Internet disk access is totally forbidden or reduced, using FIREWALL.

   d) If MYSERVER is on the other side of the Internet, and the client is
      WIN95, edit the file C:\WINDOWS\LMHOSTS and put into it content similar
      as in variant c), perform NBTSTAT -R, and continue as in variant b)

   e) If MYSERVER is on the other side of the Internet, and the client is NT
      4.0, you can make direct connection using command

      NET USE Q: \\150.142.18.95\ZXCHANGE GOPLEASE /USER:JOHN

      or, for example, using command

      NET USE Q: \\MYSERVER.PROVIDER.COM\ZXCHANGE /USER:MYDOMAIN\JOHN

If you perform described task correctly, you should have access to drive Q: as
the net drive.


7.14.  TIME CONSTANTS FOR LOADING
       ==========================

       As you seen earlier (chapter 3.2.4.) it is possible to modify 7 time
constants, which are important for tape loading process. Psychical tape format
is frequency modulated signal, and it contains of a lead-in signal, a sync
bit, and a data bits, where bits 0 and 1 are represented as square pulses with
different periods:

                              :      :           :     :
                              :      :           :     :
         ⁄ƒƒƒƒƒƒø      ⁄ƒƒƒƒƒƒø  ⁄ƒƒƒø     ⁄ƒƒƒƒƒø  ⁄ƒƒø
  ƒƒƒƒƒƒƒŸ      ¿ƒƒƒƒƒƒŸ      ¿ƒƒŸ   ¿ƒƒƒƒƒŸ     ¿ƒƒŸ  ¿ ƒ ƒ
              lead-in         : sync :    bit    : bit :
               signal         :  bit :     1     :  0  :

       Constants 'Leader const 1' and 'Leader const 2' determine allowed
duration limits of the pulses of leader tone. Negated values of these
constants (in two's complement sense) determine respectively minimal and
maximal allowed pulse width (e.g. these constants are proportional with these
widths).

       Negated values of constants 'Sync total' and 'First part' respectively
determine maximal allowed duration of the sync bit and the first part (low
level part) of the sync bit.

       Even in protected programs, lead-in tone and sync bit are usually
standard, so you need to change these constants very rarely. But next 3
constants are very important, because they determine duration of the bits 1
and 0, e.g. they determine effective loading speed. Most of protected loaders
have these constants modified. Constant 'Const delay' determines minimal
allowed width (duration) of the bit 0. Negated value of constant 'Const max
impuls' determines maximal allowed width of the bit 1. Maybe the most
important constant is 'Const threshold'. Negated value of this constant
determines a threshold value. Pulses shorter than the threshold will be
treated as bit 0, and longer pulses will be treated as bit 1. On other words,
it is minimal allowed width of the bit 1.

       If you have elementary knowledge on machine language, in following text
you will found listing of the original loading ROM routine, with marked places
where mentioned constants are located in this routine. If you using the
monitor find a loader of some protected program, it will probably look like
described loader. So, by comparing original and protected loader, you can easy
read which values of the time constants are needed for successful loading of
this protected program.

 LD_BYTES  INC  D
           EX   AF,AF'
           DEC  D
           DI
           LD   A,#0F
           OUT  (#FE),A
           LD   HL,SA_LD_RET    ; This is #053F in original routine
           PUSH HL
           IN   A,(#FE)
           RRA
           AND  #20
           OR   #02
           LD   C,A
           CP   A
 LD_BREAK  RET  NZ
 LD_START  CALL LD_EDGE_1
           JR   NC,LD_BREAK
           LD   HL,#0415
 LD_WAIT   DJNZ LD_WAIT
           DEC  HL
           LD   A,H
           OR   L              ⁄ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒø
           JR   NZ,LD_WAIT     ≥ This is 'Leader const 1' ≥
           CALL LD_EDGE_2      ¿ƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒƒŸ
           JR   NC,LD_BREAK                 ≥    ⁄ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒø
 LD_LEADER LD   B,#9C         <<<ƒƒƒƒƒƒƒƒƒƒƒŸ    ≥ This is 'Leader const 2' ≥
           CALL LD_EDGE_2                        ¿ƒƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒŸ
           JR   NC,LD_BREAK                                    ≥
           LD   A,#C6         <<<ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ
           CP   B                   ⁄ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒø
           JR   NC,LD_START         ≥ This is 'Sync total' ≥
           INC  H                   ¿ƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒŸ
           JR   NZ,LD_LEADER                   ≥
 LD_SYNC   LD   B,#C9         <<<ƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ    ⁄ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒø
           CALL LD_EDGE_1                           ≥ This is 'First part' ≥
           JR   NC,LD_BREAK                         ¿ƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒŸ
           LD   A,B                                             ≥
           CP   #D4           <<<ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ
           JR   NC,LD_SYNC
           CALL LD_EDGE_1
           RET  NC
           LD   A,C            ⁄ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒø
           XOR  #03            ≥ This is 'Const max impuls' ≥
           LD   C,A            ¿ƒƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ
           LD   H,#00                        ≥
           LD   B,#B0         <<<ƒƒƒƒƒƒƒƒƒƒƒƒŸ
           JR   LD_MARKER
 LD_LOOP   EX   AF,AF'
           JR   NZ,LD_FLAG
           JR   NC,LD_VERIFY
           LD   (IX+#00),L
           JR   LD_NEXT
 LD_FLAG   RL   C
           XOR  L
           RET  NZ
           LD   A,C
           RRA
           LD   C,A
           INC  DE
           JR   LD_DEC
 LD_VERIFY LD   A,(IX+#00)
           XOR  L
           RET  NZ             ⁄ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒø
 LD_NEXT   INC  IX             ≥ This is 'Const max impuls' increased by 2 ≥
 LD_DEC    DEC  DE             ¿ƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ
           EX   AF,AF'                ≥
           LD   B,#B2         <<<ƒƒƒƒƒŸ  ⁄ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒø
 LD_MARKER LD   L,#01                    ≥ This is 'Const treshold' ≥
 LD_8_BITS CALL LD_EDGE_2                ¿ƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ
           RET  NC                           ≥  ⁄ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒø
           LD   A,#CB         <<<ƒƒƒƒƒƒƒƒƒƒƒƒŸ  ≥ This is 'Const max impuls' ≥
           CP   B                               ¿ƒƒƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ
           RL   L                                             ≥
           LD   B,#B0         <<<ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒŸ
           JP   NC,LD_8_BITS
           LD   A,H
           XOR  L
           LD   H,A
           LD   A,D
           OR   E
           JR   NZ,LD_LOOP
           LD   A,H
           CP   #01            ⁄ƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒƒø
           RET                 ≥ This is 'Const delay' ≥
 LD_EDGE_2 CALL LD_EDGE_1      ¿ƒƒƒƒƒƒƒƒƒƒƒ¬ƒƒƒƒƒƒƒƒƒƒƒŸ
           RET  NC                         ≥
 LD_EDGE_1 LD   A,#16         <<<ƒƒƒƒƒƒƒƒƒƒŸ
 LD_DELAY  DEC  A
           JR   NZ,LD_DELAY
           AND  A
 LD_SAMPLE INC  B
           RET  Z
           LD   A,#7F
           IN   A,(#FE)
           RRA
           RET  NC
           XOR  C
           AND  #20
           JR   Z,LD_SAMPLE
           LD   A,C
           CPL
           LD   C,A
           AND  #07
           OR   #08
           OUT  (#FE),A
           SCF
           RET


7.15.  EDGE RECOGNIZER
       ===============

       If you are not familiar with LOAD routines, skip this and the next
chapter.

       The most of load routines have the LD_EDGE routines. In the AUTO or
SLOW tape emulation mode, when executing IN A,(254) instruction, the emulator
checks its surroundings and contents of the stack, and if all looks like this:

             .
             .
             .
 LD_EDGE_2 CALL LD_EDGE_1
           RET  NC
 LD_EDGE_1   .
             .
             .
             .
           IN   A,(254)
           RRA
           RET  NC        ; This instruction may be omitted or changed!
           XOR  C
           AND  32
             .
             .
             .

this will be recognized as a part of LD_EDGE routine. Then the program will:

- Load a next block from the tape file to a memory buffer.
- Set the trap on the first instruction (at LD_EDGE_1) to return the values of
  registers as in ordinary LD_EDGE routine, reading bit by bit the values from
  the memory buffer. This includes emulating of leader tone (with 260 pulses)
  and the sync pulse. Returned register values are chosen very intelligently
  (B register is unchanged after zero pulse, and it is set on 255 after one
  pulse), so these will satisfy loaders at any speed! If you are familiar with
  LD_BYTES, you can understand this.
- After the program would completely be read from the memory buffer, the first
  instruction of LD_EDGE_1 will be restored. The emulator does same thing if
  one second is passed after last access to the tape.

       Of course, this was only a very brief description of complex recognizer
algorithm. We tested about 100 loaders. We had problems with some self
modified loaders, and surely, with absolutely non-standard loaders. There is
no more problems with loaders which have more than one LD_EDGE routine.

       It is recommended, if loading routine is visible, to change its first
bytes, usually like:

           INC D
           EX AF,AF'
           DEC D
           DI

to JP 1366 for faster loading, but this will not work always.


7.16.  PROTECTED PROGRAMS
       ==================

       Earlier releases of the emulator have extensive descriptions in the
documentation files how to crack protected programs and transfer them to the
emulator. Release 2.51. allows direct loading from tape of practically all
possible types of programs, so such informations are now superfluous. If you
however want to know principles of such cracking, search for a documentation
from some of earlier releases of the emulator.


8.     REMARKED PROBLEMS, AND HINTS FOR PROBLEMS SOLVING
       =================================================

       This release of the emulator is tested with about 1000 programs on
following machines: 25 MHz Laptop 486, 33 MHz 386, 66 MHz 486, 100 MHz
Pentium, 133 MHz Pentium, 200 MHz Pentium under NT, and 8 MHz AT, all using
VGA card (the last computer is included more due to curiosity). On this place
we will give description of possible (or remarked) problems, with codes as the
environment creates in a report files. During testing we don't found all
mentioned problems. Some of them must not occur anytime, because they
represent bug into the emulator. Also, some of them are obsolete.

F - Flickering
--------------

       In Warajevo 2.51. emulator flickering is no more frequent problem. Many
games erase the sprites and repaint them synchronously with interrupt which
on real Spectrum appears when the jet of electrons is on the top of the
screen. Warajevo emulator starting from release 2.0. has synchronity between
emulation of the video system and interrupt system. However, except in
multicolor emulation mode, the emulator paints a picture simultaneously, not
gradually line by line, so programs which don't flicker on real Spectrum still
may flicker when multicolor mode is not enabled (although rarely). In this
problem, we also included appearance of 'ghosts', the parts of the screen that
must not be visible, and a case when some parts of the sprite is not visible
on screen. All eventual problems which belong to this category may be removed
(or considerably reduced) using option /Q (see chapter 2.1.). And, the best
solution is, if you have fast computer, to turn on multicolor emulation mode
(switch /QX). In this mode, all flickering except in programs which cause
flickering on real Spectrum (like Spectres) will be removed.

S - Too slow on Herc/CGA/EGAmono
--------------------------------

       We hope that time of a machines on which problems like 'Too slow'
appear belongs to the past. However, screen updating on Hercules, CGA and
EGAMono cards in some programs takes a lot of time, and this on slower
computers may cause slower working than natural speed. Sometimes switching
attribute emulation off (using F5) help, but true solution is only usage of a
faster computer.

V - Too slow on EGA/VGA
-----------------------

       If some program is too slow on EGA/WGA although your computer has
quite satisfactory speed, this means that the program already was slow on the
real Spectrum too (in this case use option /% to increase emulator speed), or
that the program uses a lot of extremely slow instructions (for example, RAM
bank switching, see chapter 7.2.). Such cases are however a rarity. Our
experience shows that on all machines with clock frequency above 33 MHz most
programs work on natural speed. If you have very slow computer, search for
Warajevo release 1.5.

H - Bad Herc/CGA/EGAmono shades
-------------------------------

       Sometimes, picture on Hercules, CGA or EGAMono is badly readable,
because selected shades for color emulating are not mutually compatible.
Started from release 1.5. this is not frequent problem, and it is reduced only
to some indistinct detail or some bad readable text from time to time. If you
use Hercules, this problem will be solved using option /VX (see chapter 2.1.).
On CGA and EGAMono it will not help, instead switch off attributes using F5
(it will help on Hercules too). In case of BASIC programs, simply change INK,
PAPER and border commands in the program. Principally, there is one unsolvable
problem, when colors of 2 square-like object differ only in brightness which
is not emulated on these cards. We founded such problem on some places into
programs 'Strip Poker 2' and 'Killed until dead'.

N - Sound unrecognizable
------------------------

       As you know, one of the advantages of our emulator is clean sound (but
not always on MS Windows and never on NT), and many melodies, simple or
polyphonic, sounds very well. Starting from release 2.0, accurate timing is
implemented, so even very time-dependent routines (like in 'WHAM the music
box') sounds quite good too. Problems with the sound are now a rarity if you
have a computer on which the emulator works at the natural speed.

       Sometimes AY sound using Sound Blaster is harsh in some programs. This
is due to interaction between sound generation and switching of 128K memory
pages (see technical part of the manual). In such cases, use AdLib FM
synthesis (or PC speaker) for AY sound emulation.

       We must say that sound quality is subjective thing which depends on
your taste and hearing. Determine by yourself whether the sound in some
program is good or no. If the sound disturbs you, simply switch off it using
F4 key.

I - Hangs up or resets without /I
---------------------------------

       This problem belongs to the past. Starting from release 2.0, Warajevo
emulator generates the interrupts using quite different method than release
1.5, so interrupt congesting is not possible even on the slowest computers.
Hanging up or resetting the emulator is now possible only due to bug into the
emulator, or due to some not implemented feature (which is unknown to us) in
the emulator.

R - Hangs up or resets even with /I
-----------------------------------

       Look the description of previous problem, the switch /I no more exists.

L - If hangs, can not help F9, F10
----------------------------------

       Locks up the emulator: Program crashes and even F9 or F10 cannot help.
This can be due to bug in the emulator, or due to interference with 386 memory
managers (QEMM, EMM386, 386MAX, especially MS Windows). Also, very intensive
usage of the analogue joystick in the very short loop may cause similar
problem. In case of such problems, first try to remove all 386 memory
managers. Read about 'Virtual 8086' drivers in chapter 7.10. and description
of option /! in chapter 2.1.

       We tested programs without 'Virtual 8086' drivers (we recommended same
thing to you), but with tested programs there are such programs which are in
collision with these drivers ('Elite', 'Rocky horror show' etc.).

B - Border flickers too much
----------------------------

       This problem means that the program makes time dependent border
effects, and the result is ugly border flickering. Since starting from release
2.0. Warajevo emulator on VGA card supports most of hires border effects, try
to switch on hires border emulation (using the F6 key). If this will not help,
then switch off totally border emulation (using also F6 key).

T - Tape emulation problems
---------------------------

       With tested programs, more than 100 programs load themselves using
non-standard routine, and most of them work. However, our 'EDGE RECOGNIZER'
unfortunately cannot recognize everything. Some loaders don't work correctly
due to the reasons mentioned in the manual. In such cases, try to convert TAP
file into TZX, turn on checkbox 'Sample normal blocks rather than copy them'
in 'TZX conversion setup' dialog, then load created TZX from 'Start' button.

       Some programs saves blocks using non-standard routines (we founded such
case in programs '3D Game maker', 'Neverending story', 'TT racer', 'Copy de
Luxe', 'Trans Express', 'Fire Copy V1.0', 'Adventure quest' and 'Boulder Dash
construction kit'), and our emulator unfortunately will not recognize such
routines. This problem is coded as 'T' too. However, you can save such
programs on real tape using 'B G Services' interface on LPT1 port. If you want
saving to TAP file from such programs, you must hack using built-in monitor.

A - Interface emulation problems
--------------------------------

       Problems with additional devices: Means that additional device (for
example, ZX printer) is not emulated good, due to bug into emulator or due to
some not implemented feature. We don't yet emulate completely RS232 etc. We
know that our implementation of Sinclair Network don't work in the program
'TT racer' (but of course the game works fine even without it). We did not
test all devices in all programs, so we don't know does this problem appear
with emulated devices.

M - Exits with message
----------------------

       If this problem occurs during emulation, and you didn't use /?128
option ('Test for 128K programs'), nor 'Escape' sequences and drivers for
user-defined peripheral devices (see chapter 5.), it means that there is a bug
into our emulator.

O - Problems not listed here
----------------------------

       Other problems: Means a problem that is not mentioned above. In
previous releases of the emulator, a frequent problem which users place into
this category is 'Too fast'. Starting from release 2.0, Warajevo is a
real-time emulator, so this problem no longer exists.

! - Cannot work theoretically
-----------------------------

       Now, we don't think that there exists any software which can not work
even theoretically on some Spectrum emulator (if we exclude quite morbid
programs like the music synthesizer where the ZX printer styli is used as
the source of sound.  Yes, we saw such a program). The only question is how
fast must the computer be on which the emulator is run to achieve 100%
compatibility...
